import le from"cross-fetch";var l={MAYAN_FORWARDER_CONTRACT:"0x337685fdaB40D39bd02028545a4FfA7D287cC3E2",MAYAN_PROGRAM_ID:"FC4eXxkyrMPTjiYUpp4EAnkmwMbQyZ6NDCh1kfLn6vsf",AUCTION_PROGRAM_ID:"8QJmxZcEzwuYmCPy6XqgN2sHcYCcFq6AEfBMJZZuLo5a",MCTP_PROGRAM_ID:"dkpZqrxHFrhziEMQ931GLtfy11nFkCsfMftH9u6QwBU",FAST_MCTP_PROGRAM_ID:"Gx9rivpS3YR8pBFwMuP6omYqVxunpLvLkNn7ubNyuZZ5",SWIFT_PROGRAM_ID:"BLZRi6frs4X4DNLw56V4EXai1b6QVESN1BhHBTYM9VcY",SWIFT_V2_PROGRAM_ID:"92peaC8g5ANAxpK2aCfLTC12JgPncRKCGULQNB2DMvRH",FEE_MANAGER_PROGRAM_ID:"5VtQHnhs2pfVEr68qQsbTRwKh4JV5GTu9mBHgHFxpHeQ",WORMHOLE_PROGRAM_ID:"worm2ZoG2kUd4vFXhvjh93UUH596ayRfgQ2MgjNMTth",WORMHOLE_PROGRAM_ID_FOGO:"worm2mrQkG1B1KTz37erMfWN8anHkSK24nzca7UD8BB",WORMHOLE_SHIM_POST_MESSAGE_PROGRAM_ID:"EtZMZM22ViKMo4r5y4Anovs3wKQ2owUmDpjygnMMcdEX",CCTP_CORE_PROGRAM_ID:"CCTPmbSD7gX1bxKPAmg77w8oFzNFpaQiQUWD43TKaecd",CCTPV2_CORE_PROGRAM_ID:"CCTPV2Sm4AdWt5296sk4P66VBZ7bEhcARwFaaS9YPbeC",CCTP_TOKEN_PROGRAM_ID:"CCTPiPYPc6AsJuwueEnWgSgucamXDZwBd53dQ11YiKX3",CCTPV2_TOKEN_PROGRAM_ID:"CCTPV2vPZJS2u2BBsUoscuikbYjnpFmbFsvVuJdgUMQe",TOKEN_PROGRAM_ID:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",TOKEN_2022_PROGRAM_ID:"TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb",ASSOCIATED_TOKEN_PROGRAM_ID:"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",SPL_UTILS_PROGRAM_ID:"B96dV3Luxzo6SokJx3xt8i5y8Mb7HRR6Eec8hCjJDT69",LOOKUP_TABLE_SOLANA:"Ff3yi1meWQQ19VPZMzGg6H8JQQeRudiV7QtVtyzJyoht",LOOKUP_TABLE_FOGO:"ZnLmtY5qckPcBQfdD4uKh9GtiQTrzQfQXEX86U3aLq7",SUI_MCTP_STATE:"0xb787fe0f7530b4fd2162fa0cc92f4f6c5a97c54b4c5c55eb04ab29f4b803ac9c",SUI_MCTP_FEE_MANAGER_STATE:"0xa1b4a96ce93d36dd0bbce0adc39533a07d2f32928918c80cd6fe7868320978f2",SUI_SWIFT_STATE:"0x7ac01a7c14c53098a41593c7623823bb677b5201fb3ee35b75b47cfc6c6c6f40",SUI_SWIFT_FEE_MANAGER_STATE:"0xe42174b6d742f40bd2b67b967542b21e6d7433f2d277a80bb59866ac73ff3f52",SUI_CCTP_CORE_PACKAGE_ID:"0x08d87d37ba49e785dde270a83f8e979605b03dc552b5548f26fdf2f49bf7ed1b",SUI_CCTP_CORE_STATE:"0xf68268c3d9b1df3215f2439400c1c4ea08ac4ef4bb7d6f3ca6a2a239e17510af",SUI_CCTP_TOKEN_PACKAGE_ID:"0x2aa6c5d56376c371f88a6cc42e852824994993cb9bab8d3e6450cbe3cb32b94e",SUI_CCTP_TOKEN_STATE:"0x45993eecc0382f37419864992c12faee2238f5cfe22b98ad3bf455baf65c8a2f",SUI_WORMHOLE_PACKAGE_ID:"0x5306f64e312b581766351c07af79c72fcb1cd25147157fdc2f8ad76de9a3fb6a",SUI_WORMHOLE_STATE:"0xaeab97f96cf9877fee2883315d459552b2b921edc16d7ceac6eab944dd88919c",SUI_LOGGER_PACKAGE_ID:"0x05680e9030c147b413a489f7891273acc221d49bd061c433e5771bc170fc37ac",EXPLORER_URL:"https://explorer-api.mayan.finance/v3",PRICE_URL:"https://price-api.mayan.finance/v3",RELAYER_URL:"https://relayer-api.mayan.finance/v3",SWIFT_RELAYER_URL:"https://swift-relayer-api.mayan.finance/v3",GAS_ESTIMATE_URL:"https://gas-estimate.mayan.finance/v2",HC_ARBITRUM_BRIDGE:"0x2df1c51e09aecf9cacb7bc98cb1742757f163df7",HC_ARBITRUM_DEPOSIT_PROCESSOR:"0xdDd77e62C848C3334f1148d4F1457FC59ede4E4B",ARBITRUM_USDC_CONTRACT:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",PAYLOAD_WRITER_PROGRAM_ID:"DwMLtdtJqJQkHzNcrdTBuWHJByJfgpKBnvFvzyKdy3cU",CPI_PROXY_PROGRAM_ID:"D8C8iW6zmoKg5TRr8nQ7h14TMWqQX8FiBdj2ju5MF3wa"};import{ethers as j,zeroPadValue as Ut,parseUnits as ia,formatUnits as sa,TypedDataEncoder as oa,ZeroAddress as fn}from"ethers";import{Keypair as gn,PublicKey as Xe,SystemProgram as gt}from"@solana/web3.js";import{Buffer as Ee}from"buffer";var Wt={_format:"hh-sol-artifact-1",contractName:"ERC20Permit",sourceName:"contracts/token/ERC20/extensions/ERC20Permit.sol",abi:[{inputs:[],name:"ECDSAInvalidSignature",type:"error"},{inputs:[{internalType:"uint256",name:"length",type:"uint256"}],name:"ECDSAInvalidSignatureLength",type:"error"},{inputs:[{internalType:"bytes32",name:"s",type:"bytes32"}],name:"ECDSAInvalidSignatureS",type:"error"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"allowance",type:"uint256"},{internalType:"uint256",name:"needed",type:"uint256"}],name:"ERC20InsufficientAllowance",type:"error"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"uint256",name:"balance",type:"uint256"},{internalType:"uint256",name:"needed",type:"uint256"}],name:"ERC20InsufficientBalance",type:"error"},{inputs:[{internalType:"address",name:"approver",type:"address"}],name:"ERC20InvalidApprover",type:"error"},{inputs:[{internalType:"address",name:"receiver",type:"address"}],name:"ERC20InvalidReceiver",type:"error"},{inputs:[{internalType:"address",name:"sender",type:"address"}],name:"ERC20InvalidSender",type:"error"},{inputs:[{internalType:"address",name:"spender",type:"address"}],name:"ERC20InvalidSpender",type:"error"},{inputs:[{internalType:"uint256",name:"deadline",type:"uint256"}],name:"ERC2612ExpiredSignature",type:"error"},{inputs:[{internalType:"address",name:"signer",type:"address"},{internalType:"address",name:"owner",type:"address"}],name:"ERC2612InvalidSigner",type:"error"},{inputs:[{internalType:"address",name:"account",type:"address"},{internalType:"uint256",name:"currentNonce",type:"uint256"}],name:"InvalidAccountNonce",type:"error"},{inputs:[],name:"InvalidShortString",type:"error"},{inputs:[{internalType:"string",name:"str",type:"string"}],name:"StringTooLong",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[],name:"EIP712DomainChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"eip712Domain",outputs:[{internalType:"bytes1",name:"fields",type:"bytes1"},{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"version",type:"string"},{internalType:"uint256",name:"chainId",type:"uint256"},{internalType:"address",name:"verifyingContract",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"uint256[]",name:"extensions",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}],bytecode:"0x",deployedBytecode:"0x",linkReferences:{},deployedLinkReferences:{}};import*as bn from"js-sha3";var ua=bn.sha3_256,pa=e=>/^(0x)?[0-9a-fA-F]+::\w+::\w+$/.test(e);function h(e,t){if(t===q.solana||t===q.fogo)return Ut(new Xe(e).toBytes(),32);if(t===q.ethereum||t===q.bsc||t===q.polygon||t===q.avalanche||t===q.arbitrum||t===q.optimism||t===q.base||t===q.unichain||t===q.linea||t===q.sonic||t===q.hyperevm||t===q.monad)return Ut(e,32);if(t===q.aptos&&pa(e))return`0x${ua(e)}`;if(t===q.sui||t===q.ton){let n=e.startsWith("0x")?e.substring(2):e;if(Ee.from(n,"hex").length!==32)throw new Error("Invalid address: "+e);return Ut(e,32)}else throw console.log(`Unsupported chain id: ${t}`,e),new Error("Unsupported token chain")}function K(e){return new Uint8Array(Ee.from(e.startsWith("0x")?e.substring(2):e,"hex"))}function B(e,t,n=!1,r=new Xe(l.TOKEN_PROGRAM_ID),i=new Xe(l.ASSOCIATED_TOKEN_PROGRAM_ID)){if(!n&&!Xe.isOnCurve(t.toBuffer()))throw new Error("TokenOwnerOffCurveError");let[a]=Xe.findProgramAddressSync([t.toBuffer(),r.toBuffer(),e.toBuffer()],i);return a}function ca(e){return(typeof e=="string"||typeof e=="number")&&e!==""&&e!==null&&!isNaN(Number(e))&&Number.isFinite(Number(e))}function w(e,t){if(e==null)throw new Error("getAmountOfFractionalAmount: Amount is null or undefined");if(typeof e!="string"&&typeof e!="number")throw new Error("getAmountOfFractionalAmount: Amount is not a string or number");if(typeof e=="string"&&e.length===0)throw new Error("getAmountOfFractionalAmount: Amount is empty");if(!Number.isFinite(Number(e)))throw new Error("getAmountOfFractionalAmount: Amount is not a number");if(!ca(t))throw new Error("getAmountOfFractionalAmount: decimals is not a number");let n=Math.min(8,Number(t)),r=Number(e).toFixed(n+1),i=new RegExp(`^-?\\d+(?:\\.\\d{0,${n}})?`),a=r.match(i);if(!a)throw new Error("getAmountOfFractionalAmount: fixedAmount is null");let p=a[0];return ia(p,Number(t))}function Tn(e,t){return Number(sa(e,t))}var q={solana:1,ethereum:2,bsc:4,polygon:5,avalanche:6,arbitrum:23,optimism:24,base:30,aptos:22,sui:21,ton:13,unichain:44,linea:38,hypercore:65e3,sonic:52,hyperevm:47,fogo:51,monad:48};function P(e){let t=q[e];if(!t)throw new Error(`Chain Id not found for chain: ${e}`);return t}var Kt={[1]:2,[56]:4,[137]:5,[43114]:6,[42161]:23,[10]:24,[8453]:30,[130]:44,[59144]:38,[146]:52,[999]:47,[143]:48};function Lt(e){let t=q[e],n=Object.keys(Kt);for(let r of n)if(Kt[r]===t)return Number(r);throw new Error(`Unsupported chain: ${e}`)}function ie(e){return Kt[e]}var Qe=[12,2,5];function Oe(){return Qe.join("_")}function wn(e){return Qe[0]<e[0]?!1:Qe[0]>e[0]?!0:Qe[1]<e[1]?!1:Qe[1]>e[1]||Qe[2]>=e[2]}function L(e){return e==="solana"||e==="sui"||e==="ton"?9:18}function In(e){return e==="solana"?9:8}var la=BigInt(2)**BigInt(64)-BigInt(1);function v(e){if(e<BigInt(0)||e>la)throw new Error(`Invalid u64: ${e}`);let t=Ee.alloc(8);return t.writeBigUInt64LE(e),t}var me={value:BigInt(0),deadline:0,v:0,r:`0x${gt.programId.toBuffer().toString("hex")}`,s:`0x${gt.programId.toBuffer().toString("hex")}`};function bt(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}function Ke(e,t){if(!e||!t)return null;if(e.type==="WH")return t?.solana||null;if(e.type==="MCTP")return e.toChain==="solana"?t?.solana||null:e.toChain==="sui"?t?.sui||null:t?.evm||null;if(e.type==="SWIFT"){if(e.swiftVersion==="V2")return e.fromChain==="solana"||e.fromChain==="fogo"?t?.solana||null:e.fromChain==="sui"?t?.sui||null:t?.evm||null;if(e.toChain==="solana")return t?.solana||null;if(e.toChain==="sui")throw new Error("Swift V1 does not support SUI");return t?.evm||null}if(e.type==="FAST_MCTP"){if(e.toChain==="solana")return t?.solana||null;if(e.toChain!=="sui")return t?.evm||null}return e.type==="MONO_CHAIN"?e.fromChain==="solana"?t?.solana||null:e.fromChain==="sui"?t?.sui||null:t?.evm||null:null}var Tt=1,wt=2,hn=1,An=1,Cn=2,Sn=3,Ye=1,je=2;async function da(e,t){let n=new j.Contract(e.contract,Wt.abi,t),r,i;try{let[s,c]=await Promise.all([n.DOMAIN_SEPARATOR(),n.name()]);r=s,i=c}catch{throw{mayanError:{permitIssue:!0}}}let a={name:i,version:"1",chainId:e.chainId,verifyingContract:e.contract};for(let s=1;s<11;s++)if(a.version=String(s),oa.hashDomain(a).toLowerCase()===r.toLowerCase())return a;let p=j.zeroPadValue(j.toBeHex(e.chainId),32),o=j.keccak256(j.toUtf8Bytes("EIP712Domain(string name,string version,address verifyingContract,bytes32 salt)"));if(e.realOriginChainId&&e.realOriginContractAddress&&e.wChainId!==e.realOriginChainId){let s=new Uint8Array(2);s[0]=e.realOriginChainId>>8&255,s[1]=e.realOriginChainId&255;let c=new Uint8Array(2+32);c.set(s,0),c.set(j.getBytes(j.zeroPadValue(e.realOriginContractAddress,32)),2);let u=j.keccak256(c),d=j.keccak256(j.toUtf8Bytes("EIP712Domain(string name,string version,uint256 chainId,address verifyingContract,bytes32 salt)"));for(let f=0;f<11;f++)if(j.keccak256(new j.AbiCoder().encode(["bytes32","bytes32","bytes32","uint256","address","bytes32"],[d,j.keccak256(j.toUtf8Bytes(i)),j.keccak256(j.toUtf8Bytes(String(f))),e.chainId,e.contract,u])).toLowerCase()===r.toLowerCase())return a.version=String(f),a.salt=u,a}for(let s=0;s<11;s++)if(j.keccak256(new j.AbiCoder().encode(["bytes32","bytes32","bytes32","address","bytes32"],[o,j.keccak256(j.toUtf8Bytes(i)),j.keccak256(j.toUtf8Bytes(String(s))),e.contract,p])).toLowerCase()===r.toLowerCase())return delete a.chainId,a.version=String(s),a.salt=p,a;throw{mayanError:{permitIssue:!0}}}var ma={Permit:[{name:"owner",type:"address"},{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}]};async function ya(e,t,n,r,i,a){if(e.standard!=="erc20"&&e.standard!=="hypertoken")throw new Error("Token is not ERC20");if(!e.supportsPermit)throw new Error("Token does not support permit");let p=new j.Contract(e.contract,Wt.abi,i),[o,s]=await Promise.all([da(e,i),p.nonces(t)]);return{domain:o,types:ma,value:{owner:t,spender:n,nonce:String(s),value:String(r),deadline:String(a)}}}async function vi(e,t,n){if(!e.hyperCoreParams)throw new Error("Quote does not have hyperCoreParams");if(e.toChain!=="hypercore")throw new Error("Quote toChain is not hypercore");if(e.toToken.contract.toLowerCase()!==l.ARBITRUM_USDC_CONTRACT.toLowerCase())throw new Error("Quote toToken is not USDC on Arbitrum");let r={name:"USDC",standard:"erc20",symbol:"USDC",mint:"CR4xnGrhsu1fWNPoX4KbTUUtqGMF3mzRLfj4S6YEs1Yo",verified:!0,contract:"0xaf88d065e77c8cc2239327c5edb3a432268e5831",chainId:42161,wChainId:23,decimals:6,logoURI:"http://assets.coingecko.com/coins/images/6319/small/usdc.png?1696506694",coingeckoId:"usd-coin",realOriginContractAddress:"0xaf88d065e77c8cc2239327c5edb3a432268e5831",realOriginChainId:23,supportsPermit:!0,verifiedAddress:"0xaf88d065e77c8cc2239327c5edb3a432268e5831"},[i,a]=await Promise.all([ya(r,t,l.HC_ARBITRUM_BRIDGE,BigInt(e.hyperCoreParams.depositAmountUSDC64),n,BigInt(e.deadline64)),Pn(t,e.toToken.contract)]);if(!a)throw new Error("Because of concurrency, deposit is not possible at the moment, please try again later");return i}function It(e,t,n){let r=Ee.alloc(109),i=Ee.from(K(t));if(i.length!==20)throw new Error("Invalid destination address length, expected 20 bytes");let a=Ee.from(K(n));if(a.length!==65)throw new Error("Invalid USDC permit signature length, expected 65 bytes");if(!e.redeemRelayerFee64||!e.hyperCoreParams)throw new Error("Invalid quote for HyperCore USDC deposit custom payload");return r.writeBigUInt64BE(BigInt(e.redeemRelayerFee64),0),r.set(i,8),r.writeBigUInt64BE(BigInt(e.hyperCoreParams.depositAmountUSDC64),28),r.writeBigUInt64BE(BigInt(e.deadline64),36),r.set(a,44),r}function qe(e){if(e.toChain==="sui"){if(!e.toToken.verifiedAddress)throw new Error("To token verified address is required for SUI");return h(e.toToken.verifiedAddress,P("sui"))}else if(e.toChain==="ton"){if(e.toToken.contract===fn)return h(gt.programId.toString(),P("solana"));if(!e.toToken.verifiedAddress)throw new Error("To token verified address is required for Ton chain");return e.toToken.verifiedAddress}else return e.toToken.contract===fn?h(gt.programId.toString(),P("solana")):h(e.toToken.contract,P(e.toChain))}function Fe(e,t){if(e==="ton"){if(t!=="SWIFT")throw new Error("Unsupported quote type for Tonchain destination");return 1/0}return 8}function ht(e){try{let t=Ee.from(e.quoteId.startsWith("0x")?e.quoteId.substring(2):e.quoteId,"hex");if(t.length<32){let n=gn.generate().publicKey.toBytes();return Ee.concat([t,n.slice(0,32-t.length)])}return t.subarray(0,32)}catch{}return gn.generate().publicKey.toBuffer()}function et(e){return Object.entries(e).filter(([t,n])=>n!=null&&!Array.isArray(n)).map(([t,n])=>`${encodeURIComponent(t)}=${encodeURIComponent(n)}`).join("&")}async function de(e){if(e.status.toString().startsWith("5")){let t=new Error("Internal server error");try{let n=await e.json();(n?.code||n?.statusCode)&&(n?.message||n?.msg)&&(t={code:n?.code||n?.statusCode,message:n?.message||n?.msg})}catch{t=new Error("Internal server error")}throw t}}async function Ui(e){let t=e?`?standard=${e.join(",")}`:"",n=await le(`${l.PRICE_URL}/tokens${t}`,{method:"GET",redirect:"follow"});if(await de(n),n.status===200)return await n.json();throw new Error("Cannot fetch Mayan tokens!")}async function Ki(e,t=!1,n){let r={chain:e,nonPortal:t,standard:n?n?.join(","):void 0},i=await le(`${l.PRICE_URL}/tokens?${et(r)}`);if(await de(i),i.status===200)return(await i.json())[e];throw new Error("Cannot fetch Mayan tokens!")}function fa(e,t={wormhole:!0,swift:!0,mctp:!0,shuttle:!0,gasless:!1,onlyDirect:!1,fastMctp:!0,fullList:!1,payload:void 0,monoChain:!0}){let{gasDrop:n,referrerBps:r}=e,i=e.slippageBps;if(i!=="auto"&&!Number.isFinite(i)){if(e.slippage===void 0||e.slippage===null||!Number.isFinite(e.slippage))throw new Error("Either slippageBps or slippage must be provided");i=e.slippage*100}let p={...{wormhole:t.wormhole!==!1,swift:t.swift!==!1,mctp:t.mctp!==!1,shuttle:t.shuttle===!0,fastMctp:t.fastMctp!==!1,gasless:t.gasless===!0,onlyDirect:t.onlyDirect===!0,fullList:t.fullList===!0,payload:typeof t.payload=="string"?t.payload:void 0,monoChain:t.monoChain!==!1},solanaProgram:l.MAYAN_PROGRAM_ID,forwarderAddress:l.MAYAN_FORWARDER_CONTRACT,amountIn:!e.amountIn64&&Number.isFinite(e.amount)?e.amount:void 0,amountIn64:e.amountIn64,fromToken:e.fromToken,fromChain:e.fromChain,toToken:e.toToken,toChain:e.toChain,slippageBps:i,referrer:e.referrer,referrerBps:Number.isFinite(r)?r:void 0,gasDrop:Number.isFinite(n)?n:void 0,destinationAddress:e.destinationAddress??void 0,sdkVersion:Oe()},o=`${l.PRICE_URL}/quote?`,s=et(p);return o+s}async function Li(e,t={swift:!0,mctp:!0,gasless:!1,onlyDirect:!1}){let n=fa(e,t),r=await le(n,{method:"GET",redirect:"follow"});await de(r);let i=await r.json();if(r.status!==200&&r.status!==201)throw{code:i?.code||0,message:i?.msg||i?.message||"Route not found",data:i?.data};if(!wn(i.minimumSdkVersion))throw{code:9999,message:"Swap SDK is outdated!"};return i.quotes}async function Gi(e){let t=await le(`${l.PRICE_URL}/clock/${e}`,{method:"GET",redirect:"follow"});await de(t);let n=await t.json();if(t.status!==200&&t.status!==201)throw n;return n.clock}async function Mn(){let e=await le(`${l.RELAYER_URL}/active-relayers?solanaProgram=${l.MAYAN_PROGRAM_ID}`,{method:"GET",redirect:"follow"});await de(e);let t=await e.json();if(e.status!==200&&e.status!==201)throw t;return t.suggested}async function he(e){let t=et({...e,sdkVersion:Oe()}),n=await le(`${l.PRICE_URL}/get-swap/solana?${t}`,{method:"GET",redirect:"follow"});await de(n);let r=await n.json();if(n.status!==200&&n.status!==201)throw r;return r}async function $e(e){let t=JSON.stringify({...e,sdkVersion:Oe()}),n=`${l.PRICE_URL}/get-swap/sui`,r=await le(n,{method:"POST",redirect:"follow",body:t,headers:{"Content-Type":"application/json"}});await de(r);let i=await r.json();if(r.status!==200&&r.status!==201)throw i;return i}async function De(e){let t=et({...e,sdkVersion:Oe()}),n=await le(`${l.PRICE_URL}/get-swap/evm?${t}`,{method:"GET",redirect:"follow"});await de(n);let r=await n.json();if(n.status!==200&&n.status!==201)throw r;return r}async function _n(e,t){let n=await le(`${l.EXPLORER_URL}/submit/evm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,signature:t},(r,i)=>typeof i=="bigint"?i.toString():i)});await de(n)}async function kn(e,t){let n=await le(`${l.EXPLORER_URL}/submit/v2/svm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signedTx:e,chainName:t})});await de(n);let r=await n.json();if(n.status!==200&&n.status!==201)throw r;return r}async function Pn(e,t){let n=et({destWallet:e,destToken:t,sdkVersion:Oe()}),r=await le(`${l.EXPLORER_URL}/hypercore/is-allowed?${n}`,{method:"GET",redirect:"follow"});await de(r);let i=await r.json();if(r.status!==200&&r.status!==201)throw i;return i.allowed===!0}async function Rn(e){let t=await le(`${l.GAS_ESTIMATE_URL}/evm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,sdkVersion:Oe()})});await de(t);let n=await t.json();if(t.status!==200&&t.status!==201)throw n;return{estimatedGas:BigInt(n.estimatedGas),gasPrice:BigInt(n.gasPrice)}}async function En(e,t){let n=await le(`${l.SWIFT_RELAYER_URL}/nonces/assign`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chainName:e,swapperAddress:t,sdkVersion:Oe()})});await de(n);let r=await n.json();if(n.status!==200&&n.status!==201)throw r;return r}import{Contract as Gr,toBeHex as Vr,ZeroAddress as Qr}from"ethers";import{PublicKey as on,SystemProgram as di}from"@solana/web3.js";var On={_format:"hh-sol-artifact-1",contractName:"MayanSwap",sourceName:"src/MayanSwap.sol",abi:[{inputs:[{internalType:"address",name:"_tokenBridge",type:"address"},{internalType:"address",name:"_weth",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint16",name:"emitterChainId",type:"uint16"},{indexed:!0,internalType:"bytes32",name:"emitterAddress",type:"bytes32"},{indexed:!0,internalType:"uint64",name:"sequence",type:"uint64"}],name:"Redeemed",type:"event"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint8",name:"payloadId",type:"uint8"},{internalType:"bytes32",name:"tokenAddr",type:"bytes32"},{internalType:"uint16",name:"tokenChainId",type:"uint16"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"sourceAddr",type:"bytes32"},{internalType:"uint16",name:"sourceChainId",type:"uint16"},{internalType:"uint64",name:"sequence",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bool",name:"unwrapRedeem",type:"bool"},{internalType:"bool",name:"unwrapRefund",type:"bool"}],internalType:"struct MayanStructs.Swap",name:"s",type:"tuple"}],name:"encodeSwap",outputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],stateMutability:"pure",type:"function"},{inputs:[],name:"getWeth",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isPaused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseRedeemPayload",outputs:[{components:[{internalType:"uint8",name:"payloadId",type:"uint8"},{internalType:"bytes32",name:"recipient",type:"bytes32"},{internalType:"uint64",name:"relayerFee",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanStructs.Redeem",name:"r",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"redeem",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"redeemAndUnwrap",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwap.RelayerFees",name:"relayerFees",type:"tuple"},{components:[{internalType:"bytes32",name:"mayanAddr",type:"bytes32"},{internalType:"uint16",name:"mayanChainId",type:"uint16"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrer",type:"bytes32"},{internalType:"bytes32",name:"refundAddr",type:"bytes32"}],internalType:"struct MayanSwap.Recepient",name:"recipient",type:"tuple"},{internalType:"bytes32",name:"tokenOutAddr",type:"bytes32"},{internalType:"uint16",name:"tokenOutChainId",type:"uint16"},{components:[{internalType:"uint256",name:"transferDeadline",type:"uint256"},{internalType:"uint64",name:"swapDeadline",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanSwap.Criteria",name:"criteria",type:"tuple"},{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"}],name:"swap",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"sweepEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"sweepToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwap.RelayerFees",name:"relayerFees",type:"tuple"},{components:[{internalType:"bytes32",name:"mayanAddr",type:"bytes32"},{internalType:"uint16",name:"mayanChainId",type:"uint16"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrer",type:"bytes32"},{internalType:"bytes32",name:"refundAddr",type:"bytes32"}],internalType:"struct MayanSwap.Recepient",name:"recipient",type:"tuple"},{internalType:"bytes32",name:"tokenOutAddr",type:"bytes32"},{internalType:"uint16",name:"tokenOutChainId",type:"uint16"},{components:[{internalType:"uint256",name:"transferDeadline",type:"uint256"},{internalType:"uint64",name:"swapDeadline",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanSwap.Criteria",name:"criteria",type:"tuple"}],name:"wrapAndSwapETH",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{stateMutability:"payable",type:"receive"}]};var ye={_format:"hh-sol-artifact-1",contractName:"MayanForwarder",sourceName:"src/MayanForwarder.sol",abi:[{inputs:[{internalType:"address",name:"_guardian",type:"address"},{internalType:"address[]",name:"_swapProtocols",type:"address[]"},{internalType:"address[]",name:"_mayanProtocols",type:"address[]"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"UnsupportedProtocol",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"token",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"protocolData",type:"bytes"}],name:"ForwardedERC20",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"protocolData",type:"bytes"}],name:"ForwardedEth",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"SwapAndForwarded",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"tokenIn",type:"address"},{indexed:!1,internalType:"uint256",name:"amountIn",type:"uint256"},{indexed:!1,internalType:"address",name:"swapProtocol",type:"address"},{indexed:!1,internalType:"address",name:"middleToken",type:"address"},{indexed:!1,internalType:"uint256",name:"middleAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"mayanData",type:"bytes"}],name:"SwapAndForwardedERC20",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"amountIn",type:"uint256"},{indexed:!1,internalType:"address",name:"swapProtocol",type:"address"},{indexed:!1,internalType:"address",name:"middleToken",type:"address"},{indexed:!1,internalType:"uint256",name:"middleAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"mayanData",type:"bytes"}],name:"SwapAndForwardedEth",type:"event"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],internalType:"struct MayanForwarder.PermitParams",name:"permitParams",type:"tuple"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"protocolData",type:"bytes"}],name:"forwardERC20",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"protocolData",type:"bytes"}],name:"forwardEth",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"mayanProtocols",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextGuardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"rescueEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"rescueToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bool",name:"enabled",type:"bool"}],name:"setMayanProtocol",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bool",name:"enabled",type:"bool"}],name:"setSwapProtocol",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],internalType:"struct MayanForwarder.PermitParams",name:"permitParams",type:"tuple"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"},{internalType:"address",name:"middleToken",type:"address"},{internalType:"uint256",name:"minMiddleAmount",type:"uint256"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"mayanData",type:"bytes"}],name:"swapAndForwardERC20",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"},{internalType:"address",name:"middleToken",type:"address"},{internalType:"uint256",name:"minMiddleAmount",type:"uint256"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"mayanData",type:"bytes"}],name:"swapAndForwardEth",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"swapProtocols",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}],linkReferences:{},deployedLinkReferences:{}};import{Buffer as Hr}from"buffer";import{Contract as Qt,toBeHex as ge,ZeroAddress as Ht}from"ethers";import{SystemProgram as Fn}from"@solana/web3.js";var Gt={_format:"hh-sol-artifact-1",contractName:"MayanCircle",sourceName:"src/MayanCircle.sol",abi:[{inputs:[{internalType:"address",name:"_cctpTokenMessenger",type:"address"},{internalType:"address",name:"_wormhole",type:"address"},{internalType:"address",name:"_feeManager",type:"address"},{internalType:"uint16",name:"_auctionChainId",type:"uint16"},{internalType:"bytes32",name:"_auctionAddr",type:"bytes32"},{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"CallerAlreadySet",type:"error"},{inputs:[],name:"CallerNotSet",type:"error"},{inputs:[],name:"CctpReceiveFailed",type:"error"},{inputs:[],name:"DeadlineViolation",type:"error"},{inputs:[],name:"DomainAlreadySet",type:"error"},{inputs:[],name:"DomainNotSet",type:"error"},{inputs:[],name:"EmitterAlreadySet",type:"error"},{inputs:[],name:"EthTransferFailed",type:"error"},{inputs:[],name:"InvalidAction",type:"error"},{inputs:[],name:"InvalidAddress",type:"error"},{inputs:[],name:"InvalidAmountOut",type:"error"},{inputs:[],name:"InvalidCaller",type:"error"},{inputs:[],name:"InvalidDestAddr",type:"error"},{inputs:[],name:"InvalidDomain",type:"error"},{inputs:[],name:"InvalidEmitter",type:"error"},{inputs:[],name:"InvalidGasDrop",type:"error"},{inputs:[],name:"InvalidMintRecipient",type:"error"},{inputs:[],name:"InvalidNonce",type:"error"},{inputs:[],name:"InvalidOrder",type:"error"},{inputs:[],name:"InvalidPayload",type:"error"},{inputs:[],name:"InvalidProtocolFee",type:"error"},{inputs:[],name:"InvalidRedeemFee",type:"error"},{inputs:[],name:"InvalidReferrerFee",type:"error"},{inputs:[],name:"MintRecipientAlreadySet",type:"error"},{inputs:[],name:"MintRecipientNotSet",type:"error"},{inputs:[],name:"Paused",type:"error"},{inputs:[],name:"Unauthorized",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint32",name:"sourceDomain",type:"uint32"},{indexed:!1,internalType:"uint64",name:"sourceNonce",type:"uint64"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"OrderFulfilled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint32",name:"sourceDomain",type:"uint32"},{indexed:!1,internalType:"uint64",name:"sourceNonce",type:"uint64"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"OrderRefunded",type:"event"},{inputs:[],name:"auctionAddr",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"auctionChainId",outputs:[{internalType:"uint16",name:"",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"bytes",name:"customPayload",type:"bytes"}],name:"bridgeWithFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint256",name:"redeemFee",type:"uint256"},{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"}],name:"bridgeWithLockedFee",outputs:[{internalType:"uint64",name:"cctpNonce",type:"uint64"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"cctpTokenMessenger",outputs:[{internalType:"contract ITokenMessenger",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint16",name:"",type:"uint16"}],name:"chainIdToEmitter",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"consistencyLevel",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChain",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"}],internalType:"struct MayanCircle.OrderParams",name:"params",type:"tuple"}],name:"createOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint32",name:"",type:"uint32"}],name:"domainToCaller",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"feeManager",outputs:[{internalType:"contract IFeeManager",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint64",name:"",type:"uint64"}],name:"feeStorage",outputs:[{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"redeemFee",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{components:[{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"promisedAmount",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"bytes32",name:"driver",type:"bytes32"}],internalType:"struct MayanCircle.FulfillParams",name:"params",type:"tuple"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"}],name:"fulfillOrder",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"}],name:"getDomain",outputs:[{internalType:"uint32",name:"domain",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isPaused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"keyToMintRecipient",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"localDomain",outputs:[{internalType:"uint32",name:"",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{components:[{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"burnAmount",type:"uint64"},{internalType:"bytes32",name:"burnToken",type:"bytes32"},{internalType:"bytes32",name:"customPayload",type:"bytes32"}],internalType:"struct MayanCircle.BridgeWithFeeParams",name:"bridgeParams",type:"tuple"}],name:"redeemWithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"}],name:"redeemWithLockedFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint32",name:"cctpNonce",type:"uint32"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"}],name:"refineFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"},{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChain",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"}],internalType:"struct MayanCircle.OrderParams",name:"orderParams",type:"tuple"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"uint16",name:"sourceChainId",type:"uint16"},{internalType:"uint8",name:"protocolBps",type:"uint8"}],internalType:"struct MayanCircle.ExtraParams",name:"extraParams",type:"tuple"}],name:"refund",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"rescueEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"rescueToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],name:"setConsistencyLevel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"uint32",name:"domain",type:"uint32"}],name:"setDomain",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"domain",type:"uint32"},{internalType:"bytes32",name:"caller",type:"bytes32"}],name:"setDomainCaller",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"bytes32",name:"emitter",type:"bytes32"}],name:"setEmitter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_feeManager",type:"address"}],name:"setFeeManager",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"address",name:"tokenIn",type:"address"},{internalType:"bytes32",name:"mintRecipient",type:"bytes32"}],name:"setMintRecipient",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"},{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"uint64",name:"cctpNonce",type:"uint64"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"}],internalType:"struct MayanCircle.UnlockFeeMsg",name:"unlockMsg",type:"tuple"}],name:"unlockFee",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm1",type:"bytes"},{internalType:"bytes",name:"encodedVm2",type:"bytes"},{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"uint64",name:"cctpNonce",type:"uint64"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"}],internalType:"struct MayanCircle.UnlockFeeMsg",name:"unlockMsg",type:"tuple"},{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"uint64",name:"cctpNonce",type:"uint64"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"}],internalType:"struct MayanCircle.UnlockRefinedFeeMsg",name:"refinedMsg",type:"tuple"}],name:"unlockFeeRefined",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"wormhole",outputs:[{internalType:"contract IWormhole",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}],linkReferences:{},deployedLinkReferences:{}};import{Buffer as ga}from"buffer";import{PublicKey as $}from"@solana/web3.js";import{Buffer as Z}from"buffer";var G=6;function oe(e){switch(e){case"ethereum":return 0;case"avalanche":return 1;case"optimism":return 2;case"arbitrum":return 3;case"solana":return 5;case"base":return 6;case"polygon":return 7;case"sui":return 8;case"unichain":return 10;case"linea":return 11;case"sonic":return 13;case"hyperevm":return 19;case"monad":return 15;default:throw new Error("unsupported chain for cctp")}}function At(e,t){let n=new $(l.CCTP_CORE_PROGRAM_ID),r=new $(l.CCTP_TOKEN_PROGRAM_ID),[i]=$.findProgramAddressSync([Z.from("message_transmitter")],n),[a]=$.findProgramAddressSync([Z.from("sender_authority")],r),[p]=$.findProgramAddressSync([Z.from("local_token"),e.toBytes()],r),[o]=$.findProgramAddressSync([Z.from("token_messenger")],r),[s]=$.findProgramAddressSync([Z.from("token_minter")],r),c=oe(t),[u]=$.findProgramAddressSync([Z.from("remote_token_messenger"),Z.from(c.toString())],r),[d]=$.findProgramAddressSync([Z.from("__event_authority")],n),[f]=$.findProgramAddressSync([Z.from("__event_authority")],r);return{messageTransmitter:i,senderAuthority:a,remoteTokenMessengerKey:u,tokenMessenger:o,tokenMinter:s,eventAuthToken:f,eventAuthCore:d,localToken:p}}function Vt(e,t,n,r){let i=new $(l.CCTPV2_CORE_PROGRAM_ID),a=new $(l.CCTPV2_TOKEN_PROGRAM_ID),[p]=$.findProgramAddressSync([Z.from("message_transmitter")],i),[o]=$.findProgramAddressSync([Z.from("sender_authority")],a),[s]=$.findProgramAddressSync([Z.from("local_token"),e.toBytes()],a),[c]=$.findProgramAddressSync([Z.from("token_messenger")],a),[u]=$.findProgramAddressSync([Z.from("token_minter")],a),d=oe(t),[f]=$.findProgramAddressSync([Z.from("remote_token_messenger"),Z.from(d.toString())],a),[m]=$.findProgramAddressSync([Z.from("__event_authority")],i),[y]=$.findProgramAddressSync([Z.from("__event_authority")],a),[b]=$.findProgramAddressSync([Z.from("denylist_account"),n.toBytes()],a),[g]=$.findProgramAddressSync([Z.from("denylist_account"),r.toBytes()],a);return{messageTransmitter:p,senderAuthority:o,remoteTokenMessengerKey:f,tokenMessenger:c,tokenMinter:u,eventAuthToken:y,eventAuthCore:m,localToken:s,cctpDenyListAccount:b,realDenyListAccount:g}}function ba(e,t,n,r){let i=ie(Number(n)),a=P(e.fromChain),p=P(e.toChain);if(a!==i)throw new Error(`Signer chain id(${Number(n)}) and quote from chain are not same! ${a} !== ${i}`);let o=e.cheaperChain===e.fromChain;if(o&&r)throw new Error("Bridge lock fee cannot have custom payload");let s=h(t,p),c=w(e.redeemRelayerFee,G),u=w(e.gasDrop,Math.min(L(e.toChain),8)),d=BigInt(e.effectiveAmountIn64),f=oe(e.toChain);if(!e.mctpMayanContract)throw new Error("MCTP contract address is missing");let m=e.mctpMayanContract;if(e.toChain==="solana"&&o)throw new Error("Cannot lock fee for transfer to solana");let y=w(e.bridgeFee,L(e.fromChain));return o&&(y=BigInt(0)),{lockFee:o,tokenIn:e.mctpInputContract,amountIn:d,redeemFee:c,gasDrop:u,destAddr:s,destDomain:f,payloadType:r?wt:Tt,customPayload:r?`0x${ga.from(r).toString("hex")}`:"0x",bridgeFee:y,contractAddress:m}}function Dn(e,t,n,r){let i=ba(e,t,n,r),{contractAddress:a,tokenIn:p,amountIn:o,destAddr:s,lockFee:c,redeemFee:u,gasDrop:d,destDomain:f,customPayload:m,payloadType:y,bridgeFee:b}=i,g=new Qt(a,Gt.abi),T,I;return c?T=g.interface.encodeFunctionData("bridgeWithLockedFee",[p,o,d,u,f,s]):T=g.interface.encodeFunctionData("bridgeWithFee",[p,o,u,d,s,f,y,m]),I=ge(b),{to:a,data:T,value:I,_params:i}}function Ta(e,t,n,r){let i=ie(Number(r)),a=P(e.fromChain),p=P(e.toChain);if(a!==i)throw new Error(`Signer chain id(${Number(r)}) and quote from chain are not same! ${a} !== ${i}`);if(!e.mctpMayanContract)throw new Error("MCTP contract address is missing");let o=e.mctpMayanContract,s=h(t,p),c;n?c=h(n,p):c=h(Fn.programId.toString(),P("solana"));let u=w(e.redeemRelayerFee,G),d=w(e.gasDrop,Math.min(L(e.toChain),8)),f=BigInt(e.effectiveAmountIn64),m=w(e.minAmountOut,Math.min(8,e.toToken.decimals)),y=BigInt(e.deadline64);if(e.toChain==="sui"&&!e.toToken.verifiedAddress)throw new Error("To token verified address is missing for SUI");let b=e.toToken.contract===Ht?h(Fn.programId.toString(),P("solana")):h(e.toChain==="sui"?e.toToken.verifiedAddress:e.toToken.contract,e.toToken.wChainId);return{params:{tokenIn:e.mctpInputContract,amountIn:f,gasDrop:d,destAddr:s,destChain:p,tokenOut:b,minAmountOut:m,deadline:y,redeemFee:u,referrerAddr:c,referrerBps:e.referrerBps||0},bridgeFee:w(e.bridgeFee,L(e.fromChain)),contractAddress:o}}function vn(e,t,n,r){let i=Ta(e,t,n,r),{contractAddress:a,params:p,bridgeFee:o}=i,c=new Qt(a,Gt.abi).interface.encodeFunctionData("createOrder",[p]),u=ge(o);return{to:a,data:c,value:u,_params:i}}async function xn(e,t,n,r,i,a){if(e.type!=="MCTP")throw new Error("Quote type is not MCTP");if(!Number.isFinite(Number(r)))throw new Error("Invalid signer chain id");r=Number(r);let p=i||me,o=new Qt(l.MAYAN_FORWARDER_CONTRACT,ye.abi),s=w(e.bridgeFee,L(e.fromChain)),c=ge(s);if(e.fromToken.contract===e.mctpInputContract)if(e.hasAuction){if(!Number(e.deadline64))throw new Error("MCTP order requires timeout");let u=vn(e,t,n,r),d="forwardERC20",f=[e.fromToken.contract,u._params.params.amountIn,p,u._params.contractAddress,u.data];return{data:o.interface.encodeFunctionData(d,f),to:l.MAYAN_FORWARDER_CONTRACT,value:ge(c),chainId:r,_forwarder:{method:d,params:f}}}else{let u=Dn(e,t,r,a),d="forwardERC20",f=[e.fromToken.contract,u._params.amountIn,p,u._params.contractAddress,u.data];return{data:o.interface.encodeFunctionData(d,f),to:l.MAYAN_FORWARDER_CONTRACT,value:ge(c),chainId:r,_forwarder:{method:d,params:f}}}else{let{minMiddleAmount:u}=e,{swapRouterCalldata:d,swapRouterAddress:f}=await De({referrerAddress:n||void 0,fromToken:e.fromToken.contract,slippageBps:e.slippageBps,forwarderAddress:l.MAYAN_FORWARDER_CONTRACT,amountIn64:e.effectiveAmountIn64,chainName:e.fromChain,middleToken:e.mctpInputContract});if(!u)throw new Error("MCTP swap requires middle amount, router address and calldata");if(e.hasAuction){if(!Number(e.deadline64))throw new Error("MCTP order requires timeout");let m=vn(e,t,n,r);if(!e.minMiddleAmount)throw new Error("MCTP swap requires middle amount");let y=w(e.minMiddleAmount,G);if(e.fromToken.contract===Ht){let b=m._params.params.amountIn;if(b<=s)throw new Error("Amount in is less than bridge fee");s!==BigInt(0)&&(b-=s),c=ge(m._params.params.amountIn);let g="swapAndForwardEth",T=[b,f,d,e.mctpInputContract,y,m._params.contractAddress,m.data];return{data:o.interface.encodeFunctionData(g,T),to:l.MAYAN_FORWARDER_CONTRACT,value:ge(c),chainId:r,_forwarder:{method:g,params:T}}}else{let b="swapAndForwardERC20",g=[e.fromToken.contract,m._params.params.amountIn,p,f,d,e.mctpInputContract,y,m._params.contractAddress,m.data];return{data:o.interface.encodeFunctionData(b,g),to:l.MAYAN_FORWARDER_CONTRACT,value:ge(c),chainId:r,_forwarder:{method:b,params:g}}}}else{let m=Dn(e,t,r,a);if(!e.minMiddleAmount)throw new Error("MCTP swap requires middle amount");let y=w(e.minMiddleAmount,G);if(e.fromToken.contract===Ht){let b=m._params.amountIn;if(b<=s)throw new Error("Amount in is less than bridge fee");s!==BigInt(0)&&(b-=s),c=ge(m._params.amountIn);let g="swapAndForwardEth",T=[b,f,d,e.mctpInputContract,y,m._params.contractAddress,m.data];return{data:o.interface.encodeFunctionData(g,T),to:l.MAYAN_FORWARDER_CONTRACT,value:ge(c),chainId:r,_forwarder:{method:g,params:T}}}else{let b="swapAndForwardERC20",g=[e.fromToken.contract,m._params.amountIn,p,f,d,e.mctpInputContract,y,m._params.contractAddress,m.data];return{data:o.interface.encodeFunctionData(b,g),to:l.MAYAN_FORWARDER_CONTRACT,value:ge(c),chainId:r,_forwarder:{method:b,params:g}}}}}}import{Contract as Er,toBeHex as Dt,ZeroAddress as qt}from"ethers";import{SystemProgram as ti}from"@solana/web3.js";var Bn={_format:"hh-sol-artifact-1",contractName:"MayanSwift",sourceName:"src/MayanSwift.sol",abi:[{type:"constructor",inputs:[{name:"_wormhole",type:"address",internalType:"address"},{name:"_refundVerifier",type:"address",internalType:"address"},{name:"_refundEmitterChainId",type:"uint16",internalType:"uint16"},{name:"_refundEmitterAddr",type:"bytes32",internalType:"bytes32"},{name:"_feeManager",type:"address",internalType:"address"},{name:"_rescueVault",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"receive",stateMutability:"payable"},{type:"function",name:"changeGuardian",inputs:[{name:"newGuardian",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"claimGuardian",inputs:[],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"createOrderWithEth",inputs:[{name:"params",type:"tuple",internalType:"struct OrderParams",components:[{name:"payloadType",type:"uint8",internalType:"uint8"},{name:"trader",type:"bytes32",internalType:"bytes32"},{name:"destAddr",type:"bytes32",internalType:"bytes32"},{name:"destChainId",type:"uint16",internalType:"uint16"},{name:"referrerAddr",type:"bytes32",internalType:"bytes32"},{name:"tokenOut",type:"bytes32",internalType:"bytes32"},{name:"minAmountOut",type:"uint64",internalType:"uint64"},{name:"gasDrop",type:"uint64",internalType:"uint64"},{name:"cancelFee",type:"uint64",internalType:"uint64"},{name:"refundFee",type:"uint64",internalType:"uint64"},{name:"deadline",type:"uint64",internalType:"uint64"},{name:"referrerBps",type:"uint8",internalType:"uint8"},{name:"auctionMode",type:"uint8",internalType:"uint8"},{name:"random",type:"bytes32",internalType:"bytes32"}]},{name:"customPayload",type:"bytes",internalType:"bytes"}],outputs:[{name:"orderHash",type:"bytes32",internalType:"bytes32"}],stateMutability:"payable"},{type:"function",name:"createOrderWithSig",inputs:[{name:"tokenIn",type:"address",internalType:"address"},{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"params",type:"tuple",internalType:"struct OrderParams",components:[{name:"payloadType",type:"uint8",internalType:"uint8"},{name:"trader",type:"bytes32",internalType:"bytes32"},{name:"destAddr",type:"bytes32",internalType:"bytes32"},{name:"destChainId",type:"uint16",internalType:"uint16"},{name:"referrerAddr",type:"bytes32",internalType:"bytes32"},{name:"tokenOut",type:"bytes32",internalType:"bytes32"},{name:"minAmountOut",type:"uint64",internalType:"uint64"},{name:"gasDrop",type:"uint64",internalType:"uint64"},{name:"cancelFee",type:"uint64",internalType:"uint64"},{name:"refundFee",type:"uint64",internalType:"uint64"},{name:"deadline",type:"uint64",internalType:"uint64"},{name:"referrerBps",type:"uint8",internalType:"uint8"},{name:"auctionMode",type:"uint8",internalType:"uint8"},{name:"random",type:"bytes32",internalType:"bytes32"}]},{name:"customPayload",type:"bytes",internalType:"bytes"},{name:"submissionFee",type:"uint256",internalType:"uint256"},{name:"signedOrderHash",type:"bytes",internalType:"bytes"},{name:"permitParams",type:"tuple",internalType:"struct PermitParams",components:[{name:"value",type:"uint256",internalType:"uint256"},{name:"deadline",type:"uint256",internalType:"uint256"},{name:"v",type:"uint8",internalType:"uint8"},{name:"r",type:"bytes32",internalType:"bytes32"},{name:"s",type:"bytes32",internalType:"bytes32"}]}],outputs:[{name:"orderHash",type:"bytes32",internalType:"bytes32"}],stateMutability:"nonpayable"},{type:"function",name:"createOrderWithToken",inputs:[{name:"tokenIn",type:"address",internalType:"address"},{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"params",type:"tuple",internalType:"struct OrderParams",components:[{name:"payloadType",type:"uint8",internalType:"uint8"},{name:"trader",type:"bytes32",internalType:"bytes32"},{name:"destAddr",type:"bytes32",internalType:"bytes32"},{name:"destChainId",type:"uint16",internalType:"uint16"},{name:"referrerAddr",type:"bytes32",internalType:"bytes32"},{name:"tokenOut",type:"bytes32",internalType:"bytes32"},{name:"minAmountOut",type:"uint64",internalType:"uint64"},{name:"gasDrop",type:"uint64",internalType:"uint64"},{name:"cancelFee",type:"uint64",internalType:"uint64"},{name:"refundFee",type:"uint64",internalType:"uint64"},{name:"deadline",type:"uint64",internalType:"uint64"},{name:"referrerBps",type:"uint8",internalType:"uint8"},{name:"auctionMode",type:"uint8",internalType:"uint8"},{name:"random",type:"bytes32",internalType:"bytes32"}]},{name:"customPayload",type:"bytes",internalType:"bytes"}],outputs:[{name:"orderHash",type:"bytes32",internalType:"bytes32"}],stateMutability:"nonpayable"},{type:"function",name:"emitters",inputs:[{name:"",type:"uint16",internalType:"uint16"}],outputs:[{name:"",type:"bytes32",internalType:"bytes32"}],stateMutability:"view"},{type:"function",name:"feeManager",inputs:[],outputs:[{name:"",type:"address",internalType:"contract IFeeManager"}],stateMutability:"view"},{type:"function",name:"getOrders",inputs:[{name:"orderHashes",type:"bytes32[]",internalType:"bytes32[]"}],outputs:[{name:"",type:"tuple[]",internalType:"struct Order[]",components:[{name:"status",type:"uint8",internalType:"enum Status"},{name:"amountIn",type:"uint64",internalType:"uint64"},{name:"destChainId",type:"uint16",internalType:"uint16"}]}],stateMutability:"view"},{type:"function",name:"guardian",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"nextGuardian",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"orders",inputs:[{name:"",type:"bytes32",internalType:"bytes32"}],outputs:[{name:"status",type:"uint8",internalType:"enum Status"},{name:"amountIn",type:"uint64",internalType:"uint64"},{name:"destChainId",type:"uint16",internalType:"uint16"}],stateMutability:"view"},{type:"function",name:"parseFulfillPayload",inputs:[{name:"encoded",type:"bytes",internalType:"bytes"}],outputs:[{name:"fulfillMsg",type:"tuple",internalType:"struct FulfillMsg",components:[{name:"action",type:"uint8",internalType:"uint8"},{name:"orderHash",type:"bytes32",internalType:"bytes32"},{name:"driver",type:"bytes32",internalType:"bytes32"},{name:"promisedAmount",type:"uint64",internalType:"uint64"},{name:"penaltyPeriod",type:"uint16",internalType:"uint16"}]}],stateMutability:"pure"},{type:"function",name:"parseRefundPayload",inputs:[{name:"encoded",type:"bytes",internalType:"bytes"}],outputs:[{name:"refundMsg",type:"tuple",internalType:"struct RefundMsg",components:[{name:"action",type:"uint8",internalType:"uint8"},{name:"orderHash",type:"bytes32",internalType:"bytes32"},{name:"srcChainId",type:"uint16",internalType:"uint16"},{name:"tokenIn",type:"bytes32",internalType:"bytes32"},{name:"trader",type:"bytes32",internalType:"bytes32"},{name:"canceler",type:"bytes32",internalType:"bytes32"},{name:"cancelFee",type:"uint64",internalType:"uint64"},{name:"refundFee",type:"uint64",internalType:"uint64"}]}],stateMutability:"pure"},{type:"function",name:"parseRefundVerifierPayload",inputs:[{name:"encoded",type:"bytes",internalType:"bytes"}],outputs:[{name:"verifier",type:"tuple",internalType:"struct RefundVerifier",components:[{name:"action",type:"uint8",internalType:"uint8"},{name:"verifier",type:"address",internalType:"address"},{name:"emitterChainId",type:"uint16",internalType:"uint16"},{name:"emitterAddr",type:"bytes32",internalType:"bytes32"}]}],stateMutability:"pure"},{type:"function",name:"parseRescuePayload",inputs:[{name:"encoded",type:"bytes",internalType:"bytes"}],outputs:[{name:"rescueMsg",type:"tuple",internalType:"struct RescueMsg",components:[{name:"action",type:"uint8",internalType:"uint8"},{name:"orderHash",type:"bytes32",internalType:"bytes32"},{name:"orderStatus",type:"uint8",internalType:"uint8"},{name:"token",type:"address",internalType:"address"},{name:"amount",type:"uint64",internalType:"uint64"}]}],stateMutability:"pure"},{type:"function",name:"parseUnlockPayload",inputs:[{name:"encoded",type:"bytes",internalType:"bytes"}],outputs:[{name:"unlockMsg",type:"tuple",internalType:"struct UnlockMsg",components:[{name:"action",type:"uint8",internalType:"uint8"},{name:"orderHash",type:"bytes32",internalType:"bytes32"},{name:"srcChainId",type:"uint16",internalType:"uint16"},{name:"tokenIn",type:"bytes32",internalType:"bytes32"},{name:"referrerAddr",type:"bytes32",internalType:"bytes32"},{name:"referrerBps",type:"uint8",internalType:"uint8"},{name:"protocolBps",type:"uint8",internalType:"uint8"},{name:"unlockReceiver",type:"bytes32",internalType:"bytes32"},{name:"driver",type:"bytes32",internalType:"bytes32"},{name:"fulfillTime",type:"uint64",internalType:"uint64"}]}],stateMutability:"pure"},{type:"function",name:"paused",inputs:[],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"refundEmitterAddr",inputs:[],outputs:[{name:"",type:"bytes32",internalType:"bytes32"}],stateMutability:"view"},{type:"function",name:"refundEmitterChainId",inputs:[],outputs:[{name:"",type:"uint16",internalType:"uint16"}],stateMutability:"view"},{type:"function",name:"refundOrder",inputs:[{name:"encodedVm",type:"bytes",internalType:"bytes"},{name:"fast",type:"bool",internalType:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"refundVerifier",inputs:[],outputs:[{name:"",type:"address",internalType:"contract IWormhole"}],stateMutability:"view"},{type:"function",name:"rescue",inputs:[{name:"encodedVm",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"rescueVault",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"setEmitters",inputs:[{name:"chainIds",type:"uint16[]",internalType:"uint16[]"},{name:"addresses",type:"bytes32[]",internalType:"bytes32[]"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setFeeManager",inputs:[{name:"_feeManager",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setPause",inputs:[{name:"_pause",type:"bool",internalType:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setRefundVerifier",inputs:[{name:"encodedVm",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"unlockBatch",inputs:[{name:"encodedVm",type:"bytes",internalType:"bytes"},{name:"indexes",type:"uint16[]",internalType:"uint16[]"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"unlockCompressedBatch",inputs:[{name:"encodedVm",type:"bytes",internalType:"bytes"},{name:"encodedPayload",type:"bytes",internalType:"bytes"},{name:"indexes",type:"uint16[]",internalType:"uint16[]"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"unlockSingle",inputs:[{name:"encodedVm",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"wormhole",inputs:[],outputs:[{name:"",type:"address",internalType:"contract IWormhole"}],stateMutability:"view"},{type:"event",name:"OrderCanceled",inputs:[{name:"key",type:"bytes32",indexed:!1,internalType:"bytes32"},{name:"sequence",type:"uint64",indexed:!1,internalType:"uint64"}],anonymous:!1},{type:"event",name:"OrderCreated",inputs:[{name:"key",type:"bytes32",indexed:!1,internalType:"bytes32"}],anonymous:!1},{type:"event",name:"OrderFulfilled",inputs:[{name:"key",type:"bytes32",indexed:!1,internalType:"bytes32"},{name:"sequence",type:"uint64",indexed:!1,internalType:"uint64"},{name:"netAmount",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"event",name:"OrderRefunded",inputs:[{name:"key",type:"bytes32",indexed:!1,internalType:"bytes32"},{name:"netAmount",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"event",name:"OrderUnlocked",inputs:[{name:"key",type:"bytes32",indexed:!1,internalType:"bytes32"}],anonymous:!1},{type:"error",name:"DuplicateOrder",inputs:[]},{type:"error",name:"EmitterAddressExists",inputs:[]},{type:"error",name:"FeesTooHigh",inputs:[]},{type:"error",name:"InvalidAction",inputs:[]},{type:"error",name:"InvalidBatchIndex",inputs:[]},{type:"error",name:"InvalidBpsFee",inputs:[]},{type:"error",name:"InvalidDestChain",inputs:[]},{type:"error",name:"InvalidEmitterAddress",inputs:[]},{type:"error",name:"InvalidEmitterChain",inputs:[]},{type:"error",name:"InvalidEvmAddr",inputs:[]},{type:"error",name:"InvalidGasDrop",inputs:[]},{type:"error",name:"InvalidOrderStatus",inputs:[]},{type:"error",name:"InvalidPayload",inputs:[]},{type:"error",name:"InvalidPayloadLength",inputs:[]},{type:"error",name:"InvalidSrcChain",inputs:[]},{type:"error",name:"OrderNotExists",inputs:[{name:"orderHash",type:"bytes32",internalType:"bytes32"}]},{type:"error",name:"Paused",inputs:[]},{type:"error",name:"SmallAmountIn",inputs:[]},{type:"error",name:"Unauthorized",inputs:[]}],linkReferences:{},deployedLinkReferences:{}};var Nn={_format:"hh-sol-artifact-1",contractName:"MayanSwift",sourceName:"src/MayanSwift.sol",abi:[{inputs:[{internalType:"address",name:"_wormhole",type:"address"},{internalType:"address",name:"_feeManager",type:"address"},{internalType:"uint16",name:"_auctionChainId",type:"uint16"},{internalType:"bytes32",name:"_auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"_solanaEmitter",type:"bytes32"},{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"DeadlineViolation",type:"error"},{inputs:[],name:"DuplicateOrder",type:"error"},{inputs:[],name:"FeesTooHigh",type:"error"},{inputs:[],name:"InvalidAction",type:"error"},{inputs:[],name:"InvalidAmount",type:"error"},{inputs:[],name:"InvalidAuctionMode",type:"error"},{inputs:[],name:"InvalidBpsFee",type:"error"},{inputs:[],name:"InvalidContractSignature",type:"error"},{inputs:[],name:"InvalidDestChain",type:"error"},{inputs:[],name:"InvalidEmitterAddress",type:"error"},{inputs:[],name:"InvalidEmitterChain",type:"error"},{inputs:[],name:"InvalidEvmAddr",type:"error"},{inputs:[],name:"InvalidGasDrop",type:"error"},{inputs:[],name:"InvalidOrderHash",type:"error"},{inputs:[],name:"InvalidOrderStatus",type:"error"},{inputs:[],name:"InvalidSignature",type:"error"},{inputs:[],name:"InvalidSignatureLength",type:"error"},{inputs:[],name:"InvalidSigner",type:"error"},{inputs:[],name:"InvalidSrcChain",type:"error"},{inputs:[],name:"InvalidWormholeFee",type:"error"},{inputs:[],name:"OrderNotExists",type:"error"},{inputs:[],name:"Paused",type:"error"},{inputs:[],name:"SmallAmountIn",type:"error"},{inputs:[],name:"Unauthorized",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint64",name:"sequence",type:"uint64"}],name:"OrderCanceled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"}],name:"OrderCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint64",name:"sequence",type:"uint64"},{indexed:!1,internalType:"uint256",name:"netAmount",type:"uint256"}],name:"OrderFulfilled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"netAmount",type:"uint256"}],name:"OrderRefunded",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"}],name:"OrderUnlocked",type:"event"},{inputs:[],name:"auctionAddr",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"auctionChainId",outputs:[{internalType:"uint16",name:"",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"bytes32",name:"canceler",type:"bytes32"}],name:"cancelOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"consistencyLevel",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"}],name:"createOrderWithEth",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"bytes",name:"signedOrderHash",type:"bytes"}],name:"createOrderWithSig",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"}],name:"createOrderWithToken",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"feeManager",outputs:[{internalType:"contract IFeeManager",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"fulfillAmount",type:"uint256"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{internalType:"bytes32",name:"recepient",type:"bytes32"},{internalType:"bool",name:"batch",type:"bool"}],name:"fulfillOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"fulfillAmount",type:"uint256"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"bytes32",name:"recepient",type:"bytes32"},{internalType:"bool",name:"batch",type:"bool"}],name:"fulfillSimple",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextGuardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"orders",outputs:[{internalType:"enum MayanSwift.Status",name:"status",type:"uint8"},{internalType:"uint64",name:"amountIn",type:"uint64"},{internalType:"uint16",name:"destChainId",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseFulfillPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"bytes32",name:"driver",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"promisedAmount",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"}],internalType:"struct MayanSwift.FulfillMsg",name:"fulfillMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseRefundPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"},{internalType:"bytes32",name:"canceler",type:"bytes32"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwift.RefundMsg",name:"refundMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseUnlockPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"}],internalType:"struct MayanSwift.UnlockMsg",name:"unlockMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32[]",name:"orderHashes",type:"bytes32[]"}],name:"postBatch",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"refundOrder",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],name:"setConsistencyLevel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_feeManager",type:"address"}],name:"setFeeManager",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"solanaEmitter",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"unlockBatch",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"unlockMsgs",outputs:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"unlockSingle",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"wormhole",outputs:[{internalType:"contract IWormhole",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}],linkReferences:{},deployedLinkReferences:{}};import{Connection as St,Keypair as wa,PublicKey as Q,SystemProgram as ke,SYSVAR_RENT_PUBKEY as Yn,Transaction as Yt,TransactionInstruction as Te,AddressLookupTableAccount as Kn,ComputeBudgetProgram as Ia}from"@solana/web3.js";import{Buffer as we}from"buffer";import{blob as jn,struct as Pt,u8 as Mt}from"@solana/buffer-layout";import{sha256 as ha}from"@noble/hashes/sha2";import Aa from"bs58";import{Buffer as Wn}from"buffer";function Un(e){console.log("new decodeJupiterV6InsArgs called");let t="bb64facc31c4af14",n="d19853937cfed8e9",r=Wn.from(e.subarray(0,8)).toString("hex").toLowerCase(),i=Wn.from(e.subarray(8));if(r===t){let a=i.readBigUInt64LE(0),p=i.readBigUInt64LE(8),o=i.readUInt16LE(16),s=i.readUInt16LE(18);return{in_amount:a,quoted_out_amount:p,slippage_bps:o,platform_fee_bps:s}}else if(r===n){let a=i.readBigUInt64LE(1),p=i.readBigUInt64LE(9),o=i.readUInt16LE(17),s=i.readUInt16LE(19);return{in_amount:a,quoted_out_amount:p,slippage_bps:o,platform_fee_bps:s}}else throw new Error(`Unsupported Jupiter V6 instruction discriminator: ${r}`)}var Ca={};function Sa(e){return Ca[e]??=new St(e),new St(e)}async function _t({trx:e,connection:t,errorChance:n,extraRpcs:r,options:i,rate:a=4}){let p=null,o=0,s,c=[t].concat(r.map(Sa));for(let u=0;u<a;u++){if(p)try{let f=await Promise.any(c.map(m=>m.getSignatureStatus(p)));if(console.log("Transaction status check attempt",u,f?.value),f&&f.value){if(f.value.err){if(o>=n)return{signature:p,serializedTrx:e};o++}else if(f.value.confirmationStatus==="confirmed"||f.value.confirmationStatus==="finalized")return{signature:p,serializedTrx:e}}}catch(f){console.error(f)}let d=c.map(f=>f.sendRawTransaction(e,i));if(console.log("Submitting transaction, attempt",u+1),!p)try{p=await Promise.any(d),console.log("Transaction submitted to fetch signature, signature:",p)}catch(f){console.error("Transaction not submitted to fetch signature, remaining attempts:",a-u-1),s=f;try{console.log("now trying to send to individual connections");let m=await t.sendRawTransaction(e)}catch(m){if(console.error("Simulation individual connections failed",m),console.error("Transaction not submitted, remaining attempts:",a-u-1),console.error(m),m&&typeof m=="object"&&"transactionMessage"in m&&typeof m.transactionMessage=="string"&&m.transactionMessage.indexOf("transaction has already been processed")){if(p)return{signature:p,serializedTrx:e};throw new Error("Transaction has already been processed, but no signature found")}s=m}}await bt(3e3)}if(!p)throw s?(console.error("Failed to submit transaction"),s):new Error("Failed to submit transaction, not landed on any signature");return{signature:p,serializedTrx:e}}function ee(e,t,n,r,i=new Q(l.TOKEN_PROGRAM_ID),a=new Q(l.ASSOCIATED_TOKEN_PROGRAM_ID)){let p=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:ke.programId,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:Yn,isSigner:!1,isWritable:!1}];return new Te({keys:p,programId:a,data:we.from([1])})}var Ln=165;async function Re(e,t,n,r,i,a=new Q(l.TOKEN_PROGRAM_ID)){let p=[],o=await e.getMinimumBalanceForRentExemption(Ln);return p.push(ke.createAccount({fromPubkey:t,newAccountPubkey:i.publicKey,lamports:o,space:Ln,programId:a})),p.push(new Te({keys:[{pubkey:i.publicKey,isWritable:!0,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:Yn,isWritable:!1,isSigner:!1}],programId:a,data:we.from([1])})),p}var Gn=Pt([Mt("instruction"),jn(8,"amount")]);function $n(e,t,n,r,i=new Q(l.TOKEN_PROGRAM_ID)){let a=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!1}],p=we.alloc(Gn.span);return Gn.encode({instruction:4,amount:v(r)},p),new Te({keys:a,programId:i,data:p})}var Vn=Pt([Mt("instruction")]);function tt(e){let t=[{pubkey:e,isSigner:!1,isWritable:!0}],n=we.alloc(Vn.span);return Vn.encode({instruction:17},n),new Te({keys:t,programId:new Q(l.TOKEN_PROGRAM_ID),data:n})}var Hn=Pt([Mt("instruction")]);function Pa(e,t,n,r=new Q(l.TOKEN_PROGRAM_ID)){let i=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1}],a=we.alloc(Hn.span);return Hn.encode({instruction:9},a),new Te({keys:i,programId:r,data:a})}var Qn=Pt([Mt("instruction"),jn(8,"amount")]);function Ae(e,t,n,r,i=new Q(l.TOKEN_PROGRAM_ID)){let a=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1}],p=we.alloc(Qn.span);return Qn.encode({instruction:3,amount:v(r)},p),new Te({keys:a,programId:i,data:p})}var be=new Q("So11111111111111111111111111111111111111112");async function Ss(e,t,n,r){let i=r??new St("https://rpc.ankr.com/solana"),a=B(be,e,!1),{blockhash:p,lastValidBlockHeight:o}=await i.getLatestBlockhash(),s=new Yt({feePayer:e,blockhash:p,lastValidBlockHeight:o}),c=await i.getAccountInfo(a,"finalized");(!c||c.data.length===0)&&s.add(ee(e,a,e,be)),s.add(ke.transfer({fromPubkey:e,toPubkey:a,lamports:w(t,9)})),s.add(tt(a));let u=await n(s);return await _t({trx:u.serialize(),connection:i,errorChance:1,extraRpcs:[]})}async function Ps(e,t,n,r){let i=r??new St("https://rpc.ankr.com/solana"),a=B(be,e,!1),p=wa.generate(),{blockhash:o,lastValidBlockHeight:s}=await i.getLatestBlockhash(),c=new Yt({feePayer:e,blockhash:o,lastValidBlockHeight:s}),u=B(be,p.publicKey,!1);c.add(ee(e,u,p.publicKey,be)),c.add(Ae(a,u,e,w(t,9))),c.add(Pa(u,e,p.publicKey)),c.partialSign(p);let d=await n(c);return await _t({trx:d.serialize(),connection:i,errorChance:1,extraRpcs:[]})}function Ct(e){return new Te({programId:new Q(e.programId),keys:e.accounts.map(t=>({pubkey:new Q(t.pubkey),isSigner:t.isSigner,isWritable:t.isWritable})),data:we.from(e.data,"base64")})}async function Ce(e,t){return(await t.getMultipleAccountsInfo(e.map(r=>new Q(r)))).reduce((r,i,a)=>{let p=e[a];if(i){let o=new Kn({key:new Q(p),state:Kn.deserialize(i.data)});r.push(o)}return r},new Array)}function Se(e,t,n){let r=Ct(e.swapInstruction),i=e.cleanupInstruction?Ct(e.cleanupInstruction):null,a=e.computeBudgetInstructions?e.computeBudgetInstructions.map(Ct):[],p=e.setupInstructions?_a(e.setupInstructions,n).map(Ct):[];return{swapInstruction:r,cleanupInstruction:i,computeBudgetInstructions:a,setupInstructions:p,addressLookupTableAddresses:e.addressLookupTableAddresses}}var Ma=[{programId:ke.programId.toString(),instructionDataHex:"00000000",discriminatorLength:4,accountIndex:0},{programId:l.ASSOCIATED_TOKEN_PROGRAM_ID,instructionDataHex:"01",discriminatorLength:1,accountIndex:0},{programId:l.ASSOCIATED_TOKEN_PROGRAM_ID,instructionDataHex:"",discriminatorLength:0,accountIndex:0}];function _a(e,t){return t?e.map(n=>{let r=Ma.find(i=>i.programId===n.programId&&i.instructionDataHex===we.from(n.data,"base64").subarray(0,i.discriminatorLength).toString("hex")&&n.accounts.length>i.accountIndex);if(r){let i=[...n.accounts];return i[r.accountIndex]={...i[r.accountIndex],pubkey:t.toString()},{...n,accounts:i}}else return n}):e}function X(e){let t=`global:${e}`;return we.from(ha(t)).subarray(0,8)}async function Jn(){let e;try{let t=await Mn();e=new Q(t)}catch{console.log("Relayer not found, using system program"),e=ke.programId}return e}function zn(e,t,n,r){let i=r.jitoAccount||"Cw8CFyM9FkoMi7K7Crf6HNQqf4uEMzpKw6QNghXLvLkY";return new Yt({feePayer:new Q(e),blockhash:t,lastValidBlockHeight:n}).add(ke.transfer({fromPubkey:new Q(e),toPubkey:new Q(i),lamports:r.tipLamports}))}var Zn=["https://mayan-jito.mayan.finance/v1/bundles"];async function ka(e,t){let n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:t});if(n.status!==200&&n.status!==201)throw console.error("Post Jito bundle failed",e,n.status,n.statusText),new Error("Send Jito bundle failed: "+n.status+" "+n.statusText);{let r=await n.json();return console.log("Post Jito bundle result",e,r.result),r.result}}async function jt(e,t,n=!1){try{let r=[];for(let s of e)r.push(s.serialize());let i={jsonrpc:"2.0",id:1,method:"sendBundle",params:[r.map(s=>Aa.encode(s))]},a=t.jitoSendUrl?[t.jitoSendUrl]:Zn,p=JSON.stringify(i);return await Promise.any(a.map(s=>ka(s,p)))}catch(r){if(console.error("Send Jito bundle failed",r),n)throw new Error("Send Jito bundle failed")}}async function Ra(e,t){let r=0;for(;r<5;)try{let i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getBundleStatuses",params:[e]})});if(!i.ok)throw new Error(`HTTP error! Status: ${i.status}`);let a=await i.json();if(a.error)throw new Error(`Error getting bundle statuses: ${JSON.stringify(a.error,null,2)}`);return a.result}catch(i){if(r++,await bt(1e3),r>=5)throw new Error(`Failed to fetch bundle statuses after 5 attempts: ${i.message}`)}}async function Xn(e,t,n,r,i){let p=Date.now();for(;Date.now()-p<9e4&&await i.getBlockHeight()<=n;){await bt(2050);let o=t.jitoSendUrl?[t.jitoSendUrl]:Zn,s=await Promise.any(o.map(c=>Ra([e],c)));if(s&&s.value&&s.value.length>0&&s.value[0]){console.log("===>",s.value[0]);let c=s.value[0].confirmation_status;if(c==="confirmed"||c==="finalized"){let u=await i.getSignatureStatus(r);if(!u||!u.value)continue;if(u.value?.err)throw new Error(`Bundle failed with error: ${u.value.err}`);return}}}throw new Error("Bundle not confirmed, timeout")}async function qn(e){try{await fetch("https://explorer-api.mayan.finance/v3/submit/jito-bundle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bundleId:e})})}catch{}}function Ea(e,t){if(e){if(!e.programId.equals(new Q(l.TOKEN_PROGRAM_ID))&&!e.programId.equals(new Q(l.TOKEN_2022_PROGRAM_ID)))throw new Error("Invalid cleanup instruction:: programId");if(Uint8Array.from(e.data).length!==1)throw new Error("Invalid cleanup instruction:: data");if(Uint8Array.from(e.data)[0]!==9)throw new Error("Invalid cleanup instruction:: data");if(t&&!e.keys[1].pubkey.equals(t))throw new Error("Invalid cleanup instruction:: dest account")}}function Oa(e,t){if(!(e.length<1)){if(e.length>6)throw new Error("Invalid setup instruction:: too many instructions");e.forEach(n=>{if(!n.programId.equals(new Q(l.ASSOCIATED_TOKEN_PROGRAM_ID))&&!n.programId.equals(ke.programId)&&!n.programId.equals(new Q(l.TOKEN_PROGRAM_ID))&&!n.programId.equals(new Q(l.TOKEN_2022_PROGRAM_ID)))throw new Error("Invalid setup instruction:: programId");if(n.programId.equals(new Q(l.ASSOCIATED_TOKEN_PROGRAM_ID))){if(Uint8Array.from(n.data).length===1){if(Uint8Array.from(n.data)[0]!==1)throw new Error("Invalid setup instruction:: data")}else if(Uint8Array.from(n.data).length!==0)throw new Error("Invalid setup instruction:: data")}else if(n.programId.equals(ke.programId)){if(!t)throw new Error("Invalid setup instruction:: unknown transfer");let r=B(be,t,!0);if(n.data.readUint32LE()!==2)throw new Error("Invalid setup instruction:: invalid system program instruction");if(!n.keys[1].pubkey.equals(r))throw new Error("Invalid setup instruction:: invalid wrap transfer dest")}else if(n.data.toString("base64")!=="EQ==")throw new Error("Invalid setup instruction:: invalid token program instruction")})}}function Fa(e,t,n=!1){let r=new Q("JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4");if(!e.programId.equals(r))throw new Error("Invalid swap instruction:: programId");if(e.data.subarray(0,8).toString("hex")===X("shared_accounts_route").toString("hex")){if(!e.keys[6].pubkey.equals(t))throw new Error("Invalid swap instruction shared_accounts_route:: dest account")}else if(e.data.subarray(0,8).toString("hex")===X("shared_accounts_route_v2").toString("hex")){if(!e.keys[5].pubkey.equals(t))throw new Error("Invalid swap instruction shared_accounts_route_v2:: dest account")}else if(e.data.subarray(0,8).toString("hex")===X("route").toString("hex")){if(n){if(!e.keys[4].pubkey.equals(r)||!e.keys[3].pubkey.equals(t))throw new Error("Invalid swap instruction route:: dest account")}else if(!e.keys[4].pubkey.equals(t))throw new Error("Invalid swap instruction route:: dest account")}else if(e.data.subarray(0,8).toString("hex")===X("route_v2").toString("hex")){if(n){if(!e.keys[7].pubkey.equals(r)||!e.keys[2].pubkey.equals(t))throw new Error("Invalid swap instruction route_v2:: dest account")}else if(!e.keys[7].pubkey.equals(t))throw new Error("Invalid swap instruction route_v2:: dest account")}else throw new Error("Invalid swap instruction:: ix id")}function er(e,t){let n=Un(Uint8Array.from(e.data));if(n.in_amount>BigInt(t.effectiveAmountIn64))throw new Error("Invalid swap instruction:: amount in");let r=w(t.minAmountOut,t.toToken.decimals);if(n.quoted_out_amount-n.quoted_out_amount*BigInt(n.slippage_bps)/10000n<r)throw new Error("Invalid swap instruction:: quote expired");if(n.platform_fee_bps!==t.referrerBps)throw new Error("Invalid swap instruction:: platform fee")}function Da(e){e.forEach(t=>{if(!t.programId.equals(Ia.programId))throw new Error("Invalid compute budget instruction:: programId");if(Uint8Array.from(t.data)[0]===3&&t.data.readBigUInt64LE(1)>100000000n)throw new Error("Invalid compute budget instruction:: to high tx fee")})}function ue(e,t,n,r,i=!1){Da(e.computeBudgetInstructions),Oa(e.setupInstructions,n),Fa(e.swapInstruction,t,i),Ea(e.cleanupInstruction,r)}function ve(e,t,n,r,i,a=new Q("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA")){return new Te({keys:[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1}],programId:new Q("B96dV3Luxzo6SokJx3xt8i5y8Mb7HRR6Eec8hCjJDT69"),data:X("transfer_all_and_close")})}function Le(e,t,n,r){let i=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:ke.programId,isSigner:!1,isWritable:!1}],a=8+2+4+n.length,p=we.alloc(a);return p.set(X("create_simple"),0),p.writeUint16LE(r,8),p.writeUint32LE(n.length,10),p.set(n,14),new Te({keys:i,programId:new Q(l.PAYLOAD_WRITER_PROGRAM_ID),data:p})}function Ge(e,t,n){let r=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0}],i=8+2,a=we.alloc(i);return a.set(X("close"),0),a.writeUint16LE(n,8),new Te({keys:r,programId:new Q(l.PAYLOAD_WRITER_PROGRAM_ID),data:a})}function A(e,t=!1){return t?e:new Te({keys:[{pubkey:e.programId,isSigner:!1,isWritable:!1}].concat(e.keys),programId:new Q(l.CPI_PROXY_PROGRAM_ID),data:e.data})}function Pe(e){if(e==="solana")return l.LOOKUP_TABLE_SOLANA;if(e==="fogo")return l.LOOKUP_TABLE_FOGO;throw new Error(`Unsupported chain name for lookup table: ${e}`)}import{Connection as Qa,PublicKey as se,Keypair as Zt,SystemProgram as dt,SYSVAR_CLOCK_PUBKEY as Ya,SYSVAR_RENT_PUBKEY as ja,Transaction as $a,TransactionInstruction as Ja,ComputeBudgetProgram as za,MessageV0 as Mr,VersionedTransaction as _r}from"@solana/web3.js";import{blob as Be,struct as Za,u16 as Xa,u8 as Ze}from"@solana/buffer-layout";import{Buffer as Ne}from"buffer";import{ZeroAddress as Xt}from"ethers";import{PublicKey as R,Keypair as rt,SystemProgram as Ve,SYSVAR_CLOCK_PUBKEY as va,TransactionInstruction as st,ComputeBudgetProgram as xa}from"@solana/web3.js";import{blob as z,struct as ot,u16 as cr,u8 as $t}from"@solana/buffer-layout";import{Buffer as ae}from"buffer";import{PublicKey as Ie}from"@solana/web3.js";import{Buffer as nt}from"buffer";function tr(e,t){let n,r;if(t==="solana")n=new Ie(l.WORMHOLE_PROGRAM_ID),r=new Ie(l.WORMHOLE_SHIM_POST_MESSAGE_PROGRAM_ID);else if(t==="fogo")n=new Ie(l.WORMHOLE_PROGRAM_ID_FOGO),r=new Ie(l.WORMHOLE_SHIM_POST_MESSAGE_PROGRAM_ID);else throw new Error("Unsupported chain for wormhole PDAs: "+t);let i=new Ie(e),[a]=Ie.findProgramAddressSync([nt.from("Bridge")],n),[p]=Ie.findProgramAddressSync([nt.from("emitter")],i),[o]=Ie.findProgramAddressSync([nt.from("Sequence"),p.toBuffer()],n),[s]=Ie.findProgramAddressSync([nt.from("fee_collector")],n),[c]=Ie.findProgramAddressSync([p.toBuffer()],r),[u]=Ie.findProgramAddressSync([nt.from("__event_authority")],r);return{bridgeConfig:a,sequenceKey:o,feeCollector:s,emitter:p,shimEventAuth:u,shimMessage:c}}var nr=ot([z(8,"instruction")]);function at(e,t,n,r,i,a){let p=new R(l.WORMHOLE_PROGRAM_ID),o=new R(l.WORMHOLE_SHIM_POST_MESSAGE_PROGRAM_ID),s=new R(l.TOKEN_PROGRAM_ID),c=new R(l.CCTP_CORE_PROGRAM_ID),u=new R(l.CCTP_TOKEN_PROGRAM_ID),d=new R(l.MCTP_PROGRAM_ID),f=new R(r),m=new R(n),y=B(m,e,!0),b;i&&i>BigInt(0)?b=B(m,f,!1):b=new R(l.MCTP_PROGRAM_ID);let g=At(m,t),T=tr(l.MCTP_PROGRAM_ID,a),I=rt.generate(),S=[{pubkey:e,isWritable:!0,isSigner:!1},{pubkey:y,isWritable:!0,isSigner:!1},{pubkey:f,isWritable:!0,isSigner:!0},{pubkey:b,isWritable:!0,isSigner:!1},{pubkey:m,isWritable:!0,isSigner:!1},{pubkey:g.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:g.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:g.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:g.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:g.localToken,isWritable:!0,isSigner:!1},{pubkey:g.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:g.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:I.publicKey,isWritable:!0,isSigner:!0},{pubkey:u,isWritable:!1,isSigner:!1},{pubkey:c,isWritable:!1,isSigner:!1},{pubkey:T.emitter,isWritable:!1,isSigner:!1},{pubkey:T.bridgeConfig,isWritable:!0,isSigner:!1},{pubkey:T.sequenceKey,isWritable:!0,isSigner:!1},{pubkey:T.feeCollector,isWritable:!0,isSigner:!1},{pubkey:T.shimMessage,isWritable:!0,isSigner:!1},{pubkey:p,isWritable:!1,isSigner:!1},{pubkey:va,isWritable:!1,isSigner:!1},{pubkey:T.shimEventAuth,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:Ve.programId,isWritable:!1,isSigner:!1}],M=ae.alloc(nr.span);return nr.encode({instruction:X("bridge_with_fee_shim")},M),{instruction:new st({keys:S,data:M,programId:d}),signers:[I]}}var rr=ot([z(8,"instruction")]);function ar(e,t,n,r,i){let a=[null,null],p=new R(l.TOKEN_PROGRAM_ID),o=new R(l.ASSOCIATED_TOKEN_PROGRAM_ID),s=new R(l.CCTP_CORE_PROGRAM_ID),c=new R(l.CCTP_TOKEN_PROGRAM_ID),u=new R(l.MCTP_PROGRAM_ID),d=new R(r),f=new R(n),m=B(f,e,!0),y=At(f,t),b=rt.generate(),[g]=R.findProgramAddressSync([ae.from("LOCKED_FEE"),f.toBuffer(),b.publicKey.toBytes()],u),T;i&&i>BigInt(0)?T=B(f,d,!1):T=new R(l.MCTP_PROGRAM_ID);let I=B(f,g,!0);a[0]=ee(d,I,g,f);let S=[{pubkey:e,isWritable:!0,isSigner:!1},{pubkey:m,isWritable:!0,isSigner:!1},{pubkey:d,isWritable:!0,isSigner:!0},{pubkey:T,isWritable:!0,isSigner:!1},{pubkey:g,isWritable:!0,isSigner:!1},{pubkey:I,isWritable:!0,isSigner:!1},{pubkey:f,isWritable:!0,isSigner:!1},{pubkey:y.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:y.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:y.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:y.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:y.localToken,isWritable:!0,isSigner:!1},{pubkey:y.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:y.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:b.publicKey,isWritable:!0,isSigner:!0},{pubkey:c,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:p,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!1,isSigner:!1},{pubkey:Ve.programId,isWritable:!1,isSigner:!1}],M=ae.alloc(rr.span);rr.encode({instruction:X("bridge_locked_fee")},M);let F=new st({keys:S,data:M,programId:u});return a[1]=F,{instructions:a,signer:b}}var ir=ot([z(8,"instruction")]);function sr(e,t,n,r,i){let a=new R(l.TOKEN_PROGRAM_ID),p=new R(l.CCTP_CORE_PROGRAM_ID),o=new R(l.CCTP_TOKEN_PROGRAM_ID),s=new R(l.MCTP_PROGRAM_ID),c=new R(r),u=new R(n),d=B(u,e,!0),f=At(u,t),m=rt.generate(),[y]=R.findProgramAddressSync([ae.from("ORDER_SOLANA_SOURCE"),e.toBuffer()],s),b;i&&i>BigInt(0)?b=B(u,c,!1):b=new R(l.MCTP_PROGRAM_ID);let g=[{pubkey:e,isWritable:!1,isSigner:!1},{pubkey:d,isWritable:!0,isSigner:!1},{pubkey:c,isWritable:!0,isSigner:!0},{pubkey:b,isWritable:!0,isSigner:!1},{pubkey:u,isWritable:!0,isSigner:!1},{pubkey:y,isWritable:!0,isSigner:!1},{pubkey:f.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:f.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:f.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:f.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:f.localToken,isWritable:!0,isSigner:!1},{pubkey:f.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:f.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:m.publicKey,isWritable:!0,isSigner:!0},{pubkey:o,isWritable:!1,isSigner:!1},{pubkey:p,isWritable:!1,isSigner:!1},{pubkey:new R(l.FEE_MANAGER_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:a,isWritable:!1,isSigner:!1},{pubkey:Ve.programId,isWritable:!1,isSigner:!1}],T=ae.alloc(ir.span);return ir.encode({instruction:X("create_order")},T),{instruction:new st({keys:g,data:T,programId:s}),signer:m}}var or=ot([z(8,"instruction"),z(32,"destAddress"),z(8,"amountInMin"),z(8,"gasDrop"),z(8,"feeRedeem"),z(8,"feeSolana"),cr("destinationChain"),z(32,"keyRnd"),$t("mode")]);function it(e){if(e.mode!=="WITH_FEE"&&e.mode!=="LOCK_FEE")throw new Error("Invalid mode: "+e.mode);if(e.customPayload&&e.mode!=="WITH_FEE")throw new Error("Custom payload is only supported in WITH_FEE mode");let t=new R(e.swapperAddress),n=new R(e.relayerAddress),r=new R(e.mintAddress),i=B(r,e.ledger,!0),a=P(e.toChain),p=ae.from(K(h(e.destinationAddress,a))),o=v(e.amountInMin64),s=v(w(e.gasDrop,Math.min(L(e.toChain),8))),c=v(w(e.feeRedeem,G)),u=v(e.feeSolana),d=e.referrerAddress?ae.from(K(h(e.referrerAddress,a))):Ve.programId.toBuffer(),f=[{pubkey:t,isWritable:!0,isSigner:!0},{pubkey:e.ledger,isWritable:!0,isSigner:!1},{pubkey:i,isWritable:!1,isSigner:!1},{pubkey:e.customPayload||new R(l.MCTP_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:Ve.programId,isWritable:!1,isSigner:!1},{pubkey:n,isWritable:!0,isSigner:!0},{pubkey:new R(d),isWritable:!1,isSigner:!1}],m=ae.alloc(or.span);return or.encode({instruction:X("init_bridge_ledger_gasless"),destAddress:p,amountInMin:o,gasDrop:s,feeRedeem:c,feeSolana:u,destinationChain:a,keyRnd:e.randomKey.toBuffer(),mode:e.mode==="WITH_FEE"?1:2},m),new st({keys:f,data:m,programId:new R(l.MCTP_PROGRAM_ID)})}var ur=ot([z(8,"instruction"),z(32,"destAddress"),z(8,"amountInMin"),z(8,"gasDrop"),z(8,"feeRedeem"),z(8,"feeSolana"),cr("destinationChain"),z(32,"keyRnd"),$t("mode"),z(32,"tokenOut"),z(8,"amountOutMin"),z(8,"deadline"),z(32,"refAddress"),$t("feeRateRef")]);function pr(e){let t=new R(e.swapperAddress),n=new R(e.relayerAddress),r=new R(e.mintAddress),i=B(r,e.ledger,!0),a=P(e.toChain),p=ae.from(K(h(e.destinationAddress,a))),o=v(e.amountInMin64),s=v(w(e.gasDrop,Math.min(L(e.toChain),8))),c=v(w(e.feeRedeem,G)),u=v(e.feeSolana),d=ae.from(K(h(e.tokenOut,a))),f=e.referrerAddress?ae.from(K(h(e.referrerAddress,a))):Ve.programId.toBuffer(),m=v(w(e.amountOutMin,Math.min(8,e.tokenOutDecimals))),y=v(e.deadline),b=[{pubkey:t,isWritable:!0,isSigner:!0},{pubkey:e.ledger,isWritable:!0,isSigner:!1},{pubkey:i,isWritable:!1,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:Ve.programId,isWritable:!1,isSigner:!1},{pubkey:n,isWritable:!0,isSigner:!0}],g=ae.alloc(ur.span);return ur.encode({instruction:X("init_order_ledger_gasless"),destAddress:p,amountInMin:o,gasDrop:s,feeRedeem:c,feeSolana:u,destinationChain:a,keyRnd:e.randomKey.toBuffer(),mode:3,tokenOut:d,refAddress:f,amountOutMin:m,deadline:y,feeRateRef:e.feeRateRef},g),new st({keys:b,data:g,programId:new R(l.MCTP_PROGRAM_ID)})}async function lr(e,t,n,r,i,a={}){let p=a?.forceSkipCctpInstructions||!1,o=a?.allowSwapperOffCurve||!1;if(e.toChain==="solana")throw new Error("Unsupported destination chain: "+e.toChain);let s=e.relayer||t,c=[],u=[],d=[],f=[],m=[],y=[],b=[],g=rt.generate(),T=null;c.push(Pe(e.fromChain));let I=new R(l.MCTP_PROGRAM_ID),S=new R(t),M=new R(s),F=rt.generate(),D=e.deadline64?BigInt(e.deadline64):BigInt(0);if(e.hasAuction&&!Number(e.deadline64))throw new Error("Swap mode requires a timeout");let E=e.hasAuction?"LEDGER_ORDER":"LEDGER_BRIDGE",[C]=R.findProgramAddressSync([ae.from(E),S.toBytes(),F.publicKey.toBytes()],I),N=B(new R(e.mctpInputContract),C,!0),O=e.cheaperChain==="solana"?"LOCK_FEE":"WITH_FEE";if(e.toChain==="sui"&&!e.toToken.verifiedAddress)throw new Error("Missing verified address for SUI coin");let W=e.toChain==="sui"?e.toToken.verifiedAddress:e.toToken.contract;if(!W)throw new Error("Missing token out address");if(a.customPayload&&e.hasAuction)throw new Error("Cannot use customPayload with create Mctp swap");let V=null,H=Math.floor(Math.random()*65e3);if(a.customPayload&&(V=R.findProgramAddressSync([ae.from("PAYLOAD"),M.toBuffer(),(()=>{let _=ae.alloc(2);return _.writeUInt16LE(H,0),_})()],new R(l.PAYLOAD_WRITER_PROGRAM_ID))[0],u.push(A(Le(M,V,ae.from(a.customPayload),H)))),e.fromToken.contract===e.mctpInputContract){let _=BigInt(p?e.solanaRelayerFee64:0);if(e.suggestedPriorityFee>0&&u.push(xa.setComputeUnitPrice({microLamports:e.suggestedPriorityFee})),u.push(A(ee(M,N,C,new R(e.mctpInputContract)))),u.push(A(Ae(B(new R(e.mctpInputContract),S,o),N,S,BigInt(e.effectiveAmountIn64)))),e.hasAuction){if(u.push(A(pr({ledger:C,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:F.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:_,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:BigInt(e.effectiveAmountIn64),tokenOut:W,tokenOutDecimals:e.toToken.decimals,referrerAddress:r,amountOutMin:e.minAmountOut,deadline:D,feeRateRef:e.referrerBps||0,relayerAddress:s}),a.skipProxyMayanInstructions)),!p){let{instruction:x,signer:Y}=sr(C,e.toChain,e.mctpInputContract,s,_);u.push(A(x,a.skipProxyMayanInstructions)),d.push(Y)}}else if(u.push(A(it({ledger:C,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:F.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:_,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:BigInt(e.effectiveAmountIn64),mode:O,referrerAddress:r,relayerAddress:s,customPayload:V}),a.skipProxyMayanInstructions)),!p)if(O==="WITH_FEE"){let{instruction:x,signers:Y}=at(C,e.toChain,e.mctpInputContract,s,_,e.fromChain);u.push(A(x,a.skipProxyMayanInstructions)),d.push(...Y)}else{let{instructions:x,signer:Y}=ar(C,e.toChain,e.mctpInputContract,s,_);u.push(A(x[0])),u.push(A(x[1],a.skipProxyMayanInstructions)),d.push(Y)}}else{if(!e.minMiddleAmount)throw new Error("Missing minMiddleAmount for swap");let _=await he({minMiddleAmount:e.minMiddleAmount,middleToken:e.mctpInputContract,userWallet:t,userLedger:C.toString(),slippageBps:e.slippageBps,fromToken:e.fromToken.contract,amountIn64:e.effectiveAmountIn64,depositMode:e.hasAuction?"SWAP":O,fillMaxAccounts:a?.separateSwapTx||!1,tpmTokenAccount:a?.separateSwapTx?g.publicKey.toString():null,referrerAddress:r||null,chainName:e.fromChain}),x=Se(_,i,M);a?.separateSwapTx&&_.maxAccountsFilled?(ue(x,g.publicKey,S),b=await Re(i,M,new R(e.mctpInputContract),S,g),y.push(...x.computeBudgetInstructions),x.setupInstructions&&y.push(...x.setupInstructions),y.push(x.swapInstruction),x.cleanupInstruction&&y.push(x.cleanupInstruction),m.push(...x.addressLookupTableAddresses),u.push(A(ee(M,N,C,new R(e.mctpInputContract)))),u.push(A(ve(S,new R(e.mctpInputContract),g.publicKey,N,M)))):(ue(x,N,S),u.push(...x.computeBudgetInstructions),x.setupInstructions&&u.push(...x.setupInstructions.map(ne=>A(ne))),u.push(x.swapInstruction),x.cleanupInstruction&&u.push(A(x.cleanupInstruction)),c.push(...x.addressLookupTableAddresses));let Y=y.length>0?BigInt(0):BigInt(e.solanaRelayerFee64);if(e.hasAuction){if(u.push(A(pr({ledger:C,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:F.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:Y,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:w(e.minMiddleAmount,G),tokenOut:W,tokenOutDecimals:e.toToken.decimals,referrerAddress:r,amountOutMin:e.minAmountOut,deadline:D,feeRateRef:e.referrerBps||0,relayerAddress:s}),a.skipProxyMayanInstructions)),y.length>0){let{instruction:ne,signer:ce}=sr(C,e.toChain,e.mctpInputContract,s,Y);u.push(A(ne,a.skipProxyMayanInstructions)),d.push(ce)}}else if(u.push(A(it({ledger:C,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:F.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:Y,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:w(e.minMiddleAmount,G),mode:O,referrerAddress:r,relayerAddress:s,customPayload:V}),a.skipProxyMayanInstructions)),y.length>0)if(O==="WITH_FEE"){let{instruction:ne,signers:ce}=at(C,e.toChain,e.mctpInputContract,s,Y,e.fromChain);u.push(A(ne,a.skipProxyMayanInstructions)),d.push(...ce)}else{let{instructions:ne,signer:ce}=ar(C,e.toChain,e.mctpInputContract,s,Y);u.push(A(ne[0])),u.push(A(ne[1],a.skipProxyMayanInstructions)),d.push(ce)}}V&&u.push(A(Ge(M,V,H)));let k=await Ce(c.concat(m),i);if(f=k.slice(0,c.length),y.length>0){let _=k.slice(c.length);T={messageV0:{payerKey:S,instructions:y,addressLookupTableAccounts:_},createTmpTokenAccountIxs:b,tmpTokenAccount:g}}return{instructions:u,signers:d,lookupTables:f,swapMessageV0Params:T}}import{PublicKey as te,Keypair as Ba,SystemProgram as He,TransactionInstruction as Na,ComputeBudgetProgram as Wa}from"@solana/web3.js";import{blob as fe,struct as Ua,u16 as Ka,u8 as kt}from"@solana/buffer-layout";import{Buffer as re}from"buffer";import{ethers as dr,ZeroAddress as ut}from"ethers";function Jt(e,t,n,r,i,a){let p=e.swiftVersion==="V2"?272:239,o=re.alloc(p),s=0;if(e.swiftVersion==="V2"){let E=a?je:Ye;o.writeUInt8(E,s),s+=1}let c=P(e.fromChain),u=re.from(K(h(t,c)));o.set(u,s),s+=32,o.writeUInt16BE(c,s),s+=2;let d=e.fromChain==="sui"?e.swiftVerifiedInputAddress:e.swiftInputContract,f=d===ut?h(He.programId.toString(),P("solana")):h(d,c),m=re.from(K(f));o.set(m,s),s+=32;let y=P(e.toChain),b=re.from(K(h(n,y)));if(o.set(b,s),s+=32,o.writeUInt16BE(y,s),s+=2,e.toChain==="sui"&&!e.toToken.verifiedAddress)throw new Error("Missing verified address for SUI coin");let g=qe(e),T=re.from(K(g));if(o.set(T,s),s+=32,o.writeBigUInt64BE(w(e.minAmountOut,Math.min(e.toToken.decimals,Fe(e.toChain,e.type))),s),s+=8,o.writeBigUInt64BE(w(e.gasDrop,Math.min(L(e.toChain),Fe(e.toChain,e.type))),s),s+=8,!e.cancelRelayerFee64||!e.refundRelayerFee64)throw new Error("Missing relayer fees");o.writeBigUInt64BE(BigInt(e.cancelRelayerFee64),s),s+=8,o.writeBigUInt64BE(BigInt(e.refundRelayerFee64),s),s+=8,o.writeBigUInt64BE(BigInt(e.deadline64),s),s+=8;let I=e.swiftVersion==="V2"?c:y,S=r?re.from(K(h(r,I))):He.programId.toBuffer();o.set(S,s),s+=32,o.writeUInt8(e.referrerBps||0,s),s+=1;let M=e.protocolBps||0;if(o.writeUInt8(M,s),s+=1,!e.swiftAuctionMode)throw new Error("Missing swift auction mode");o.writeUInt8(e.swiftAuctionMode,s),s+=1;let F=re.from(K(i));if(F.length!==32)throw new Error("Invalid random key length");if(o.set(F,s),s+=32,e.swiftVersion==="V2"){let E;a?E=re.from(K(dr.keccak256(re.from(a)))):E=He.programId.toBuffer(),o.set(E,s),s+=32}if(s!==p)throw new Error(`Invalid order data size: ${s}`);let D=dr.keccak256(o);return re.from(K(D))}var mr=Ua([fe(8,"instruction"),fe(8,"amountInMin"),kt("nativeInput"),fe(8,"feeSubmit"),fe(32,"destAddress"),Ka("destinationChain"),fe(32,"tokenOut"),fe(8,"amountOutMin"),fe(8,"gasDrop"),fe(8,"feeCancel"),fe(8,"feeRefund"),fe(8,"deadline"),fe(32,"refAddress"),kt("feeRateRef"),kt("feeRateMayan"),kt("auctionMode"),fe(32,"randomKey")]);function La(e){let{quote:t}=e,n=t.swiftInputContract===ut?be:new te(t.swiftInputContract),r=P(t.toChain);if(r!==t.toToken.wChainId)throw new Error(`Destination chain ID mismatch: ${r} != ${t.toToken.wChainId}`);if(e.customPayload&&!e.customPayloadAccount)throw new Error("Custom payload account is required when custom payload is provided");let i=t.swiftVersion==="V2"?[{pubkey:e.trader,isWritable:!1,isSigner:!1},{pubkey:e.relayer,isWritable:!0,isSigner:!0},{pubkey:e.state,isWritable:!0,isSigner:!1},{pubkey:e.stateAccount,isWritable:!0,isSigner:!1},{pubkey:e.relayerAccount,isWritable:!0,isSigner:!1},{pubkey:e.customPayloadAccount||new te(l.SWIFT_V2_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:new te(l.FEE_MANAGER_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:e.tokenProgramId,isWritable:!1,isSigner:!1},{pubkey:He.programId,isWritable:!1,isSigner:!1}]:[{pubkey:e.trader,isWritable:!1,isSigner:!0},{pubkey:e.relayer,isWritable:!0,isSigner:!0},{pubkey:e.state,isWritable:!0,isSigner:!1},{pubkey:e.stateAccount,isWritable:!0,isSigner:!1},{pubkey:e.relayerAccount,isWritable:!0,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:new te(l.FEE_MANAGER_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:new te(l.TOKEN_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:He.programId,isWritable:!1,isSigner:!1}];i.forEach((u,d)=>{console.log(d,u.pubkey)});let a=re.alloc(mr.span),p=t.swiftVersion==="V2"?P("solana"):r,o=e.referrerAddress?re.from(K(h(e.referrerAddress,p))):He.programId.toBuffer(),s;if(t.fromToken.contract===t.swiftInputContract)s=BigInt(t.effectiveAmountIn64);else{if(!t.minMiddleAmount)throw new Error("Missing min middle amount");s=w(t.minMiddleAmount,t.swiftInputDecimals)}if(t.toChain==="sui"&&!t.toToken.verifiedAddress)throw new Error("Missing verified address for SUI coin");if(!t.cancelRelayerFee64||!t.refundRelayerFee64)throw new Error("Missing relayer fees");let c=qe(t);if(!t.submitRelayerFee64)throw new Error("Missing submit relayer fee");return mr.encode({instruction:X("init_order"),amountInMin:v(s),nativeInput:t.swiftInputContract===ut?1:0,feeSubmit:v(BigInt(t.submitRelayerFee64)),destAddress:re.from(K(h(e.destinationAddress,r))),destinationChain:r,tokenOut:re.from(K(c)),amountOutMin:v(w(t.minAmountOut,Math.min(t.toToken.decimals,Fe(t.toChain,t.type)))),gasDrop:v(w(t.gasDrop,Math.min(L(t.toChain),Fe(t.toChain,t.type)))),feeCancel:v(BigInt(t.cancelRelayerFee64)),feeRefund:v(BigInt(t.refundRelayerFee64)),deadline:v(e.deadline),refAddress:o,feeRateRef:t.referrerBps,feeRateMayan:t.protocolBps,auctionMode:t.swiftAuctionMode,randomKey:e.randomKey.toBuffer()},a),new Na({keys:i,data:a,programId:new te(t.swiftVersion==="V2"?l.SWIFT_V2_PROGRAM_ID:l.SWIFT_PROGRAM_ID)})}async function yr(e,t,n,r,i,a={},p,o){if(e.type!=="SWIFT")throw new Error("Unsupported quote type for Swift: "+e.type);if(e.toChain===e.fromChain)throw new Error("Unsupported same chains: "+e.toChain);if(e.swiftVersion!=="V2"&&(e.toChain==="sui"||e.toChain==="ton"||e.toChain==="fogo"))throw new Error("Swift V2 is required for"+e.toChain);let s=e.swiftVersion,c=a.allowSwapperOffCurve||!1,u=[],d=[],f=[];f.push(Pe(e.fromChain));let m=[],y=[],b=[],g=Ba.generate(),T=null,I=new te(t),S=new te(ht(e));if(!Number(e.deadline64))throw new Error("Swift mode requires a timeout");let M=BigInt(e.deadline64);if(p&&!o)throw new Error("Custom payload account is required when custom payload is provided");let F=Jt(e,t,n,r,S.toBuffer().toString("hex"),p),D=re.alloc(2);D.writeUInt16LE(P(e.toChain));let[E]=e.swiftVersion==="V2"?te.findProgramAddressSync([re.from("STATE_SOURCE"),F,D],new te(l.SWIFT_V2_PROGRAM_ID)):te.findProgramAddressSync([re.from("STATE_SOURCE"),F],new te(l.SWIFT_PROGRAM_ID)),C;e.swiftVersion==="V2"?C=e.swiftInputContractStandard==="spl2022"?new te(l.TOKEN_2022_PROGRAM_ID):new te(l.TOKEN_PROGRAM_ID):C=new te(l.TOKEN_PROGRAM_ID),console.log({tokenProgramId:C});let N=e.swiftInputContract===ut?be:new te(e.swiftInputContract),O=B(N,E,!0,C),W=e.gasless?new te(e.relayer):I,V=B(N,W,!1,C);if(e.fromToken.contract===e.swiftInputContract)e.suggestedPriorityFee>0&&u.push(Wa.setComputeUnitPrice({microLamports:e.suggestedPriorityFee})),u.push(A(ee(W,O,E,N,C))),e.swiftInputContract===ut?u.push(A(He.transfer({fromPubkey:I,toPubkey:O,lamports:BigInt(e.effectiveAmountIn64)})),A(tt(O))):u.push(A(Ae(B(N,I,c,C),O,I,BigInt(e.effectiveAmountIn64),C)));else{if(!e.minMiddleAmount)throw new Error("Missing min middle amount for swap");let k=await he({minMiddleAmount:e.minMiddleAmount,middleToken:e.swiftInputContract,userWallet:t,slippageBps:e.slippageBps,fromToken:e.fromToken.contract,amountIn64:e.effectiveAmountIn64,depositMode:e.gasless?"SWIFT_GASLESS":"SWIFT",fillMaxAccounts:a?.separateSwapTx||!1,tpmTokenAccount:a?.separateSwapTx?g.publicKey.toString():null,referrerAddress:r||void 0,chainName:e.fromChain,userLedger:E.toString()});if(e.swiftVersion!==s)throw new Error("Quote mutation is not allowed");let _=Se(k,i,W);if(a?.separateSwapTx&&k.maxAccountsFilled){if(ue(_,g.publicKey,I),b=await Re(i,W,N,I,g,C),e.swiftVersion!==s)throw new Error("Quote mutation is not allowed");y.push(..._.computeBudgetInstructions),_.setupInstructions&&y.push(..._.setupInstructions),y.push(_.swapInstruction),_.cleanupInstruction&&y.push(_.cleanupInstruction),m.push(..._.addressLookupTableAddresses),u.push(A(ee(W,O,E,N,C))),u.push(A(ve(I,N,g.publicKey,O,W,C)))}else ue(_,O,I),u.push(..._.computeBudgetInstructions),_.setupInstructions&&u.push(..._.setupInstructions.map(x=>A(x))),u.push(_.swapInstruction),_.cleanupInstruction&&u.push(A(_.cleanupInstruction)),f.push(..._.addressLookupTableAddresses)}u.push(A(La({quote:e,state:E,trader:I,stateAccount:O,randomKey:S,relayerAccount:V,relayer:W,destinationAddress:n,deadline:M,referrerAddress:r,tokenProgramId:C,customPayload:p,customPayloadAccount:o?new te(o):void 0}),a.skipProxyMayanInstructions));let H=await Ce(f.concat(m),i);if(d=H.slice(0,f.length),y.length>0){let k=H.slice(f.length);T={messageV0:{payerKey:W,instructions:y,addressLookupTableAccounts:k},createTmpTokenAccountIxs:b,tmpTokenAccount:g}}if(console.log({randomKey:S.toBuffer().toString("hex"),hash:F.toString("hex")}),e.swiftVersion!==s)throw new Error("Quote mutation is not allowed");return{instructions:u,signers:[],lookupTables:d,swapMessageV0Params:T}}import kr from"bs58";import{PublicKey as xe,Keypair as Cr,ComputeBudgetProgram as Va}from"@solana/web3.js";import{Buffer as lt}from"buffer";import{PublicKey as U,Keypair as zt,SystemProgram as Je,TransactionInstruction as Ot,ComputeBudgetProgram as Ga}from"@solana/web3.js";import{blob as J,struct as Ft,u16 as hr,u8 as Rt,u32 as Et}from"@solana/buffer-layout";import{Buffer as pe}from"buffer";var fr=Ft([J(8,"instruction")]);function pt(e,t,n,r,i,a){let p=new U(l.TOKEN_PROGRAM_ID),o=new U(l.CCTPV2_CORE_PROGRAM_ID),s=new U(l.CCTPV2_TOKEN_PROGRAM_ID),c=new U(l.FAST_MCTP_PROGRAM_ID),u=new U(i),d=new U(r),f=B(d,e,!0),m;a&&a>BigInt(0)?m=B(d,u,!1):m=new U(l.FAST_MCTP_PROGRAM_ID);let y=Vt(d,n,e,t),b=zt.generate(),g=[{pubkey:e,isWritable:!0,isSigner:!1},{pubkey:f,isWritable:!0,isSigner:!1},{pubkey:u,isWritable:!0,isSigner:!0},{pubkey:m,isWritable:!0,isSigner:!1},{pubkey:d,isWritable:!0,isSigner:!1},{pubkey:y.realDenyListAccount,isWritable:!1,isSigner:!1},{pubkey:y.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:y.cctpDenyListAccount,isWritable:!1,isSigner:!1},{pubkey:y.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:y.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:y.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:y.localToken,isWritable:!0,isSigner:!1},{pubkey:y.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:y.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:b.publicKey,isWritable:!0,isSigner:!0},{pubkey:o,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:p,isWritable:!1,isSigner:!1},{pubkey:Je.programId,isWritable:!1,isSigner:!1}],T=pe.alloc(fr.span);return fr.encode({instruction:X("bridge")},T),{instruction:new Ot({keys:g,data:T,programId:c}),signers:[b]}}var gr=Ft([J(8,"instruction")]);function br(e,t,n,r,i,a){let p=new U(l.TOKEN_PROGRAM_ID),o=new U(l.CCTPV2_CORE_PROGRAM_ID),s=new U(l.CCTPV2_TOKEN_PROGRAM_ID),c=new U(l.FAST_MCTP_PROGRAM_ID),u=new U(i),d=new U(r),f=B(d,e,!0),m=Vt(d,n,e,t),y=zt.generate(),b;a&&a>BigInt(0)?b=B(d,u,!1):b=new U(l.FAST_MCTP_PROGRAM_ID);let g=[{pubkey:e,isWritable:!1,isSigner:!1},{pubkey:f,isWritable:!0,isSigner:!1},{pubkey:u,isWritable:!0,isSigner:!0},{pubkey:b,isWritable:!0,isSigner:!1},{pubkey:d,isWritable:!0,isSigner:!1},{pubkey:m.realDenyListAccount,isWritable:!1,isSigner:!1},{pubkey:m.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:m.cctpDenyListAccount,isWritable:!1,isSigner:!1},{pubkey:m.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:m.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:m.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:m.localToken,isWritable:!0,isSigner:!1},{pubkey:m.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:m.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:y.publicKey,isWritable:!0,isSigner:!0},{pubkey:o,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:p,isWritable:!1,isSigner:!1},{pubkey:Je.programId,isWritable:!1,isSigner:!1}],T=pe.alloc(gr.span);return gr.encode({instruction:X("create_order")},T),{instruction:new Ot({keys:g,data:T,programId:c}),signer:y}}var Tr=Ft([J(8,"instruction"),J(32,"destAddress"),J(8,"amountInMin"),J(8,"gasDrop"),J(8,"feeRedeem"),J(8,"feeSolana"),Et("destDomain"),J(32,"refAddress"),Rt("feeRateRef"),hr("keyRnd"),J(8,"maxCircleFee"),Et("minFinalityThreshold"),Rt("mode")]);function ct(e){let t=new U(e.swapperAddress),n=new U(e.relayerAddress),r=new U(e.mintAddress),i=B(r,e.ledger,!0),a=P(e.toChain),p=pe.from(K(h(e.destinationAddress,a))),o=v(e.amountInMin64),s=v(w(e.gasDrop,Math.min(L(e.toChain),8))),c=v(e.feeRedeem),u=v(e.feeSolana),d=v(e.maxCircleFee),f=e.referrerAddress?pe.from(K(h(e.referrerAddress,a))):Je.programId.toBuffer(),m=oe(e.toChain),y=[{pubkey:t,isWritable:!0,isSigner:!0},{pubkey:e.ledger,isWritable:!0,isSigner:!1},{pubkey:n,isWritable:!0,isSigner:!0},{pubkey:i,isWritable:!1,isSigner:!1},{pubkey:e.customPayload||new U(l.FAST_MCTP_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:Je.programId,isWritable:!1,isSigner:!1}],b=pe.alloc(Tr.span);return Tr.encode({instruction:X("init_bridge_ledger"),destAddress:p,amountInMin:o,gasDrop:s,feeRedeem:c,feeSolana:u,destDomain:m,refAddress:f,feeRateRef:e.feeRateRef??0,keyRnd:e.randomKey,maxCircleFee:d,minFinalityThreshold:e.minFinalityThreshold,mode:1},b),new Ot({keys:y,data:b,programId:new U(l.FAST_MCTP_PROGRAM_ID)})}var wr=Ft([J(8,"instruction"),J(32,"destAddress"),J(8,"amountInMin"),J(8,"gasDrop"),J(8,"feeRedeem"),J(8,"feeRefund"),J(8,"feeSolana"),Et("destDomain"),hr("keyRnd"),Rt("mode"),J(32,"tokenOut"),J(8,"amountOutMin"),J(8,"deadline"),J(32,"refAddress"),Rt("feeRateRef"),J(8,"maxCircleFee"),Et("minFinalityThreshold")]);function Ir(e){let t=new U(e.swapperAddress),n=new U(e.relayerAddress),r=new U(e.mintAddress),i=B(r,e.ledger,!0),a=P(e.toChain),p=oe(e.toChain),o=pe.from(K(h(e.destinationAddress,a))),s=v(e.amountInMin64),c=v(w(e.gasDrop,Math.min(L(e.toChain),8))),u=v(e.feeRedeem),d=v(e.feeRefund),f=v(e.feeSolana),m=v(e.maxCircleFee),y=pe.from(K(h(e.tokenOut,a))),b=e.referrerAddress?pe.from(K(h(e.referrerAddress,a))):Je.programId.toBuffer(),g=v(w(e.amountOutMin,Math.min(8,e.tokenOutDecimals))),T=v(e.deadline),I=[{pubkey:t,isWritable:!0,isSigner:!0},{pubkey:e.ledger,isWritable:!0,isSigner:!1},{pubkey:n,isWritable:!0,isSigner:!0},{pubkey:i,isWritable:!1,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:Je.programId,isWritable:!1,isSigner:!1}],S=pe.alloc(wr.span);return wr.encode({instruction:X("init_order_ledger"),destAddress:o,amountInMin:s,gasDrop:c,feeRedeem:u,feeRefund:d,feeSolana:f,destDomain:p,keyRnd:e.randomKey,maxCircleFee:m,minFinalityThreshold:e.minFinalityThreshold,mode:2,tokenOut:y,amountOutMin:g,deadline:T,refAddress:b,feeRateRef:e.feeRateRef},S),new Ot({keys:I,data:S,programId:new U(l.FAST_MCTP_PROGRAM_ID)})}async function Ar(e,t,n,r,i,a={}){let p=a?.forceSkipCctpInstructions||!1,o=a?.allowSwapperOffCurve||!1;if(e.toChain==="solana")throw new Error("Unsupported destination chain: "+e.toChain);let s=e.relayer||t,c=[],u=[],d=[],f=[],m=[],y=[],b=[],g=zt.generate(),T=null;c.push(Pe(e.fromChain));let I=new U(l.FAST_MCTP_PROGRAM_ID),S=new U(t),M=new U(s),F=Math.floor(Math.random()*65e3),D=e.deadline64?BigInt(e.deadline64):BigInt(0);if(e.hasAuction&&!Number(e.deadline64))throw new Error("Swap mode requires a timeout");let E=e.hasAuction?"LEDGER_ORDER":"LEDGER_BRIDGE",[C]=U.findProgramAddressSync([pe.from(E),S.toBytes(),(()=>{let k=pe.alloc(2);return k.writeUInt16LE(F,0),k})()],I),N=B(new U(e.fastMctpInputContract),C,!0);if(e.toChain==="sui"&&!e.toToken.verifiedAddress)throw new Error("Missing verified address for SUI coin");let O=e.toChain==="sui"?e.toToken.verifiedAddress:e.toToken.contract;if(!O)throw new Error("Missing tokenOut address in quote");if(e.toChain==="sui")throw new Error("Fast MCTP does not support SUI as destination chain");if(a.customPayload&&e.hasAuction)throw new Error("Cannot use customPayload with create Fast Mctp swap");let W=null,V=Math.floor(Math.random()*65e3);if(a.customPayload&&(W=U.findProgramAddressSync([pe.from("PAYLOAD"),M.toBuffer(),(()=>{let k=pe.alloc(2);return k.writeUInt16LE(V,0),k})()],new U(l.PAYLOAD_WRITER_PROGRAM_ID))[0],u.push(A(Le(M,W,pe.from(a.customPayload),V)))),!e.redeemRelayerFee64)throw new Error("Missing redeem relayer fee in quote");if(e.fromToken.contract===e.fastMctpInputContract){let k=BigInt(p?e.solanaRelayerFee64:0);if(e.suggestedPriorityFee>0&&u.push(Ga.setComputeUnitPrice({microLamports:e.suggestedPriorityFee})),u.push(A(ee(M,N,C,new U(e.fastMctpInputContract)))),u.push(A(Ae(B(new U(e.fastMctpInputContract),S,o),N,S,BigInt(e.effectiveAmountIn64)))),e.hasAuction){if(!e.refundRelayerFee64)throw new Error("Missing refund relayer fee in quote");if(u.push(A(Ir({ledger:C,swapperAddress:t,mintAddress:e.fastMctpInputContract,randomKey:F,toChain:e.toChain,destinationAddress:n,feeSolana:k,feeRedeem:BigInt(e.redeemRelayerFee64),feeRefund:BigInt(e.refundRelayerFee64),gasDrop:e.gasDrop,amountInMin64:BigInt(e.effectiveAmountIn64),tokenOut:O,tokenOutDecimals:e.toToken.decimals,referrerAddress:r,amountOutMin:e.minAmountOut,deadline:D,feeRateRef:e.referrerBps||0,relayerAddress:s,maxCircleFee:BigInt(e.circleMaxFee64),minFinalityThreshold:e.fastMctpMinFinality}),a.skipProxyMayanInstructions)),!p){let{instruction:_,signer:x}=br(C,S,e.toChain,e.fastMctpInputContract,s,k);u.push(A(_,a.skipProxyMayanInstructions)),d.push(x)}}else if(u.push(A(ct({ledger:C,swapperAddress:t,mintAddress:e.fastMctpInputContract,randomKey:F,toChain:e.toChain,destinationAddress:n,feeSolana:k,feeRedeem:BigInt(e.redeemRelayerFee64),gasDrop:e.gasDrop,amountInMin64:BigInt(e.effectiveAmountIn64),referrerAddress:r,relayerAddress:s,customPayload:W,feeRateRef:e.referrerBps||0,maxCircleFee:BigInt(e.circleMaxFee64),minFinalityThreshold:e.fastMctpMinFinality}),a.skipProxyMayanInstructions)),!p){let{instruction:_,signers:x}=pt(C,S,e.toChain,e.fastMctpInputContract,s,k);u.push(A(_,a.skipProxyMayanInstructions)),d.push(...x)}}else{if(!e.minMiddleAmount)throw new Error("Missing min middle amount in quote");let k=await he({minMiddleAmount:e.minMiddleAmount,middleToken:e.fastMctpInputContract,userWallet:t,userLedger:C.toString(),slippageBps:e.slippageBps,fromToken:e.fromToken.contract,amountIn64:e.effectiveAmountIn64,depositMode:e.hasAuction?"FAST_MCTP_ORDER":"FAST_MCTP_BRIDGE",fillMaxAccounts:a?.separateSwapTx||!1,tpmTokenAccount:a?.separateSwapTx?g.publicKey.toString():null,referrerAddress:r||null,chainName:e.fromChain}),_=Se(k,i,M);a?.separateSwapTx&&k.maxAccountsFilled?(ue(_,g.publicKey,S),b=await Re(i,M,new U(e.fastMctpInputContract),S,g),y.push(..._.computeBudgetInstructions),_.setupInstructions&&y.push(..._.setupInstructions),y.push(_.swapInstruction),_.cleanupInstruction&&y.push(_.cleanupInstruction),m.push(..._.addressLookupTableAddresses),u.push(A(ee(M,N,C,new U(e.fastMctpInputContract)))),u.push(A(ve(S,new U(e.fastMctpInputContract),g.publicKey,N,M)))):(ue(_,N,S),u.push(..._.computeBudgetInstructions),_.setupInstructions&&u.push(..._.setupInstructions.map(Y=>A(Y))),u.push(_.swapInstruction),_.cleanupInstruction&&u.push(A(_.cleanupInstruction)),c.push(..._.addressLookupTableAddresses));let x=y.length>0?BigInt(0):BigInt(e.solanaRelayerFee64);if(e.hasAuction){if(!e.refundRelayerFee64)throw new Error("Missing refund relayer fee in quote");if(u.push(A(Ir({ledger:C,swapperAddress:t,mintAddress:e.fastMctpInputContract,randomKey:F,toChain:e.toChain,destinationAddress:n,feeSolana:x,feeRedeem:BigInt(e.redeemRelayerFee64),feeRefund:BigInt(e.refundRelayerFee64),gasDrop:e.gasDrop,amountInMin64:w(e.minMiddleAmount,G),tokenOut:O,tokenOutDecimals:e.toToken.decimals,referrerAddress:r,amountOutMin:e.minAmountOut,deadline:D,feeRateRef:e.referrerBps||0,relayerAddress:s,maxCircleFee:BigInt(e.circleMaxFee64),minFinalityThreshold:e.fastMctpMinFinality}),a.skipProxyMayanInstructions)),y.length>0){let{instruction:Y,signer:ne}=br(C,S,e.toChain,e.fastMctpInputContract,s,x);u.push(A(Y,a.skipProxyMayanInstructions)),d.push(ne)}}else if(u.push(A(ct({ledger:C,swapperAddress:t,mintAddress:e.fastMctpInputContract,randomKey:F,toChain:e.toChain,destinationAddress:n,feeSolana:x,feeRedeem:BigInt(e.redeemRelayerFee64),gasDrop:e.gasDrop,amountInMin64:w(e.minMiddleAmount,G),referrerAddress:r,feeRateRef:e.referrerBps||0,relayerAddress:s,customPayload:W,maxCircleFee:BigInt(e.circleMaxFee64),minFinalityThreshold:e.fastMctpMinFinality}),a.skipProxyMayanInstructions)),y.length>0){let{instruction:Y,signers:ne}=pt(C,S,e.toChain,e.fastMctpInputContract,s,x);u.push(A(Y,a.skipProxyMayanInstructions)),d.push(...ne)}}W&&u.push(A(Ge(M,W,V)));let H=await Ce(c.concat(m),i);if(f=H.slice(0,c.length),y.length>0){let k=H.slice(c.length);T={messageV0:{payerKey:S,instructions:y,addressLookupTableAccounts:k},createTmpTokenAccountIxs:b,tmpTokenAccount:g}}return{instructions:u,signers:d,lookupTables:f,swapMessageV0Params:T}}async function Sr(e,t,n,r,i,a={}){if(e.toToken.contract.toLowerCase()!==l.ARBITRUM_USDC_CONTRACT.toLowerCase()||e.type!=="MCTP"&&e.type!=="FAST_MCTP")throw new Error("Unsupported quote type for USDC deposit: "+e.type);if(!a?.usdcPermitSignature)throw new Error("USDC permit signature is required for this quote");if(!e.hyperCoreParams)throw new Error("HyperCore parameters are required for this quote");if(!Number(e.deadline64))throw new Error("HyperCore deposit requires timeout");let p=a.allowSwapperOffCurve||!1,o=[],s=[],c=[],u=[];u.push(Pe(e.fromChain));let d=[],f=[],m=[],y=Cr.generate(),b=null,g=new xe(t),T=e.relayer||t,I=new xe(e.hyperCoreParams.initiateTokenContract),S=Math.floor(Math.random()*65e3),[M]=xe.findProgramAddressSync([lt.from("PAYLOAD"),g.toBuffer(),(()=>{let H=lt.alloc(2);return H.writeUInt16LE(S,0),H})()],new xe(l.PAYLOAD_WRITER_PROGRAM_ID)),F=It(e,n,a.usdcPermitSignature),D=Cr.generate(),E=new xe(l.MCTP_PROGRAM_ID),C=Math.floor(Math.random()*65e3),N=new xe(l.FAST_MCTP_PROGRAM_ID),O;if(e.type==="MCTP"){let[H]=xe.findProgramAddressSync([lt.from("LEDGER_BRIDGE"),g.toBytes(),D.publicKey.toBytes()],E);O=H}else if(e.type==="FAST_MCTP"){let[H]=xe.findProgramAddressSync([lt.from("LEDGER_BRIDGE"),g.toBytes(),(()=>{let k=lt.alloc(2);return k.writeUInt16LE(C,0),k})()],N);O=H}if(!O)throw new Error("Unsupported quote type for USDC deposit: "+e.type);let W=B(I,O,!0);if(e.fromToken.contract===e.hyperCoreParams.initiateTokenContract){if(e.suggestedPriorityFee>0&&o.push(Va.setComputeUnitPrice({microLamports:e.suggestedPriorityFee})),o.push(A(ee(g,W,O,I))),o.push(A(Ae(B(I,g,p),W,g,BigInt(e.hyperCoreParams.bridgeAmountUSDC64)))),o.push(A(Le(g,M,F,S))),e.type==="MCTP"){o.push(A(it({ledger:O,randomKey:D.publicKey,swapperAddress:g.toString(),mintAddress:I.toString(),mode:"WITH_FEE",feeSolana:BigInt(0),amountInMin64:BigInt(e.hyperCoreParams.bridgeAmountUSDC64),customPayload:M,destinationAddress:l.HC_ARBITRUM_DEPOSIT_PROCESSOR,referrerAddress:r,feeRedeem:0,gasDrop:e.hyperCoreParams.failureGasDrop,toChain:"arbitrum",relayerAddress:T}),a.skipProxyMayanInstructions));let{instruction:H,signers:k}=at(O,"arbitrum",e.hyperCoreParams.initiateTokenContract,T,BigInt(0),e.fromChain);o.push(A(H,a.skipProxyMayanInstructions)),s.push(...k)}else if(e.type==="FAST_MCTP"){o.push(A(ct({ledger:O,randomKey:C,swapperAddress:g.toString(),mintAddress:I.toString(),feeSolana:BigInt(0),amountInMin64:BigInt(e.hyperCoreParams.bridgeAmountUSDC64),customPayload:M,destinationAddress:l.HC_ARBITRUM_DEPOSIT_PROCESSOR,referrerAddress:r,feeRedeem:BigInt(0),gasDrop:e.hyperCoreParams.failureGasDrop,toChain:"arbitrum",relayerAddress:T,feeRateRef:e.referrerBps||0,maxCircleFee:BigInt(e.circleMaxFee64),minFinalityThreshold:e.fastMctpMinFinality}),a.skipProxyMayanInstructions));let{instruction:H,signers:k}=pt(O,g,"arbitrum",e.hyperCoreParams.initiateTokenContract,T,BigInt(0));o.push(A(H,a.skipProxyMayanInstructions)),s.push(...k)}else throw new Error("Unsupported quote type for USDC deposit: "+e.type);o.push(A(Ge(g,M,S)))}else{if(!e.minMiddleAmount)throw new Error("minMiddleAmount is required for swap");let H=await he({minMiddleAmount:e.minMiddleAmount,middleToken:e.hyperCoreParams.initiateTokenContract,userWallet:g.toString(),slippageBps:e.slippageBps,fromToken:e.fromToken.contract,amountIn64:e.effectiveAmountIn64,depositMode:"HC_USDC",fillMaxAccounts:a?.separateSwapTx||!1,tpmTokenAccount:y.publicKey.toString(),referrerAddress:r||void 0,chainName:e.fromChain,userLedger:O.toString(),quoteType:e.type}),k=Se(H,i);if(a?.separateSwapTx&&H.maxAccountsFilled)ue(k,y.publicKey,g),m=await Re(i,g,I,g,y),f.push(...k.computeBudgetInstructions),k.setupInstructions&&f.push(...k.setupInstructions),f.push(k.swapInstruction),k.cleanupInstruction&&f.push(k.cleanupInstruction),d.push(...k.addressLookupTableAddresses);else{ue(k,y.publicKey,g),o.push(...k.computeBudgetInstructions);let ce=await Re(i,g,I,g,y);o.push(...ce.map(_e=>A(_e))),s.push(y),k.setupInstructions&&o.push(...k.setupInstructions.map(_e=>A(_e))),o.push(k.swapInstruction),k.cleanupInstruction&&o.push(A(k.cleanupInstruction)),u.push(...k.addressLookupTableAddresses)}let _=f.length>0?BigInt(0):BigInt(e.solanaRelayerFee64),x=BigInt(e.hyperCoreParams.bridgeAmountUSDC64);f.length>0&&(x=x-BigInt(e.solanaRelayerFee64)),o.push(A(ee(g,W,O,I))),o.push(A(Ae(y.publicKey,W,g,x)));let Y=B(I,g,p),ne=await i.getAccountInfo(Y);if((!ne||!ne.data)&&o.push(A(ee(g,Y,g,I))),o.push(A(ve(g,I,y.publicKey,Y,g))),o.push(A(Le(g,M,F,S))),e.type==="MCTP")o.push(A(it({ledger:O,swapperAddress:g.toString(),mintAddress:I.toString(),randomKey:D.publicKey,mode:"WITH_FEE",feeSolana:_,amountInMin64:x,customPayload:M,destinationAddress:l.HC_ARBITRUM_DEPOSIT_PROCESSOR,referrerAddress:r,feeRedeem:0,gasDrop:e.hyperCoreParams.failureGasDrop,toChain:"arbitrum",relayerAddress:T}),a.skipProxyMayanInstructions));else if(e.type==="FAST_MCTP")o.push(A(ct({ledger:O,randomKey:C,swapperAddress:g.toString(),mintAddress:I.toString(),feeSolana:_,amountInMin64:x,customPayload:M,destinationAddress:l.HC_ARBITRUM_DEPOSIT_PROCESSOR,referrerAddress:r,feeRedeem:BigInt(0),gasDrop:e.hyperCoreParams.failureGasDrop,toChain:"arbitrum",relayerAddress:T,feeRateRef:e.referrerBps||0,maxCircleFee:BigInt(e.circleMaxFee64),minFinalityThreshold:e.fastMctpMinFinality}),a.skipProxyMayanInstructions));else throw new Error("Unsupported quote type");if(o.push(A(Ge(g,M,S))),f.length>0)if(e.type==="MCTP"){let{instruction:ce,signers:_e}=at(O,"arbitrum",e.hyperCoreParams.initiateTokenContract,T,BigInt(0),e.fromChain);o.push(A(ce,a.skipProxyMayanInstructions)),s.push(..._e)}else if(e.type==="FAST_MCTP"){let{instruction:ce,signers:_e}=pt(O,g,"arbitrum",e.hyperCoreParams.initiateTokenContract,T,BigInt(0));o.push(A(ce,a.skipProxyMayanInstructions)),s.push(..._e)}else throw new Error("Unsupported quote type")}let V=await Ce(u.concat(d),i);if(c=V.slice(0,u.length),f.length>0){let H=V.slice(u.length);b={messageV0:{payerKey:g,instructions:f,addressLookupTableAccounts:H},createTmpTokenAccountIxs:m,tmpTokenAccount:y}}return{instructions:o,signers:s,lookupTables:c,swapMessageV0Params:b}}import{PublicKey as ze}from"@solana/web3.js";import{ZeroAddress as Ha}from"ethers";async function Pr(e,t,n,r,i,a={}){if(e.type!=="MONO_CHAIN")throw new Error("Unsupported quote type for mono chain: "+e.type);if(e.fromChain!=="solana")throw new Error("Unsupported destination chain for mono chain: "+e.fromChain);if(e.toChain!=="solana")throw new Error("Unsupported destination chain for mono chain: "+e.toChain);if(e.fromToken.contract===e.toToken.contract)throw new Error("From token and to token are the same: "+e.fromToken.contract);if(n.startsWith("0x"))throw new Error("Destination address should not be EVM address");try{new ze(n)}catch{throw new Error("Invalid destination address: "+n)}let p=[],o=[],s=[],c=new ze(t),u=new ze(n),d=e.toToken.contract===Ha?be:new ze(e.toToken.contract),f=B(d,u,!0,e.toToken.standard==="spl2022"?new ze(l.TOKEN_2022_PROGRAM_ID):new ze(l.TOKEN_PROGRAM_ID)),m=w(e.expectedAmountOut,e.toToken.decimals),y=await he({userWallet:t,destinationWallet:n,slippageBps:e.slippageBps,fromToken:e.fromToken.contract,middleToken:e.toToken.contract,amountIn64:e.effectiveAmountIn64,expectedAmountOut64:String(m),depositMode:"MONO_CHAIN",referrerAddress:r,referrerBps:e.referrerBps||0,chainName:e.fromChain}),b=Se(y,i);return ue(b,f,c,u,c.equals(u)),er(b.swapInstruction,e),p.push(...b.computeBudgetInstructions),b.setupInstructions&&p.push(...b.setupInstructions.map(g=>A(g))),p.push(b.swapInstruction),b.cleanupInstruction&&p.push(A(b.cleanupInstruction)),s.push(...b.addressLookupTableAddresses),s.push(Pe(e.fromChain)),o=await Ce(s,i),{instructions:p,signers:[],lookupTables:o,swapMessageV0Params:null}}var qa=420,Rr=Za([Ze("instruction"),Ze("stateNonce"),Be(8,"amount"),Be(8,"minAmountOut"),Be(8,"deadline"),Be(8,"feeSwap"),Be(8,"feeReturn"),Be(8,"feeCancel"),Be(8,"gasDrop"),Xa("destinationChain"),Be(32,"destinationAddress"),Ze("unwrapRedeem"),Ze("unwrapRefund"),Ze("mayanFeeNonce"),Ze("referrerFeeNonce")]);async function ei(e,t,n,r,i,a={}){let p=Ke(e,r);if(e.fromChain==="hypercore")throw new Error("HyperCore as source chain is not supported in Solana");if(e.toChain==="hypercore"){if(a.customPayload)throw new Error("Custom payload is not supported for HyperCore");return Sr(e,t,n,p,i,a)}if(e.type==="MCTP")return lr(e,t,n,p,i,a);if(e.type==="SWIFT")return yr(e,t,n,p,i,a);if(e.type==="MONO_CHAIN"){if(a.customPayload)throw new Error("Custom payload is not supported for MONO_CHAIN yet");return Pr(e,t,n,p,i,a)}if(e.type==="FAST_MCTP")return Ar(e,t,n,p,i,a);if(a.customPayload)throw new Error("Custom payload is not supported for WH from Solana");let o=[],s=i??new Qa("https://rpc.ankr.com/solana"),c=new se(l.MAYAN_PROGRAM_ID),u=new se(l.TOKEN_PROGRAM_ID),d=new se(t),f=new se(l.AUCTION_PROGRAM_ID);e.suggestedPriorityFee>0&&o.push(za.setComputeUnitPrice({microLamports:e.suggestedPriorityFee}));let m;p?m=new se(p):m=dt.programId;let[y,b]=se.findProgramAddressSync([Ne.from("MAYANFEE")],c),[g,T]=se.findProgramAddressSync([Ne.from("REFERRERFEE"),m.toBuffer()],c),I=Zt.generate(),S=Zt.generate(),[M,F]=se.findProgramAddressSync([Ne.from("V2STATE"),Ne.from(I.publicKey.toBytes()),Ne.from(S.publicKey.toBytes())],c),D=new se(e.fromToken.mint),E=new se(e.toToken.mint),C=B(D,d),N=B(D,M,!0),[[O,W],V,H]=await Promise.all([s.getMultipleAccountsInfo([C,N],"finalized"),s.getMinimumBalanceForRentExemption(qa),Jn()]);(!O||O.data.length===0)&&o.push(ee(d,C,d,D)),(!W||W.data.length===0)&&o.push(ee(d,N,M,D)),e.fromToken.contract===Xt&&(o.push(dt.transfer({fromPubkey:d,toPubkey:C,lamports:BigInt(e.effectiveAmountIn64)})),o.push(tt(C)));let k=BigInt(e.effectiveAmountIn64),_=Zt.generate();o.push($n(C,_.publicKey,d,k)),o.push(dt.transfer({fromPubkey:d,toPubkey:_.publicKey,lamports:V}));let x=[{pubkey:_.publicKey,isWritable:!1,isSigner:!0},{pubkey:I.publicKey,isWritable:!1,isSigner:!0},{pubkey:S.publicKey,isWritable:!1,isSigner:!0},{pubkey:M,isWritable:!0,isSigner:!1},{pubkey:C,isWritable:!0,isSigner:!1},{pubkey:d,isWritable:!1,isSigner:!1},{pubkey:N,isWritable:!0,isSigner:!1},{pubkey:D,isWritable:!1,isSigner:!1},{pubkey:E,isWritable:!1,isSigner:!1},{pubkey:f,isWritable:!1,isSigner:!1},{pubkey:m,isWritable:!1,isSigner:!1},{pubkey:y,isWritable:!1,isSigner:!1},{pubkey:g,isWritable:!1,isSigner:!1},{pubkey:_.publicKey,isWritable:!0,isSigner:!0},{pubkey:H,isWritable:!1,isSigner:!1},{pubkey:Ya,isWritable:!1,isSigner:!1},{pubkey:ja,isWritable:!1,isSigner:!1},{pubkey:u,isWritable:!1,isSigner:!1},{pubkey:dt.programId,isWritable:!1,isSigner:!1}],Y=P(e.toChain);if(Y===1){let Nt=await s.getAccountInfo(new se(n));if(Nt&&Nt.owner&&Nt.owner.equals(u))throw new Error("Destination address is not about token account. It should be a owner address")}let ne=Ne.from(K(h(n,Y)));if(!e.mintDecimals)throw new Error("Mint decimals not provided");let ce=w(e.minAmountOut,e.mintDecimals.to),_e=w(e.swapRelayerFee,e.mintDecimals.from),Zr=w(e.redeemRelayerFee,e.mintDecimals.to),Xr=w(e.refundRelayerFee,e.mintDecimals.from),qr=w(e.gasDrop,In(e.toChain)),ea=e.toToken.contract===Xt,ta=e.fromToken.contract===Xt;if(!Number(e.deadline64))throw new Error("Deadline is not valid");let na=BigInt(e.deadline64),yn=Ne.alloc(Rr.span),ra={instruction:101,stateNonce:F,amount:v(k),minAmountOut:v(ce),deadline:v(na),feeSwap:v(_e),feeReturn:v(Zr),feeCancel:v(Xr),gasDrop:v(qr),destinationChain:Y,destinationAddress:ne,unwrapRedeem:ea?1:0,unwrapRefund:ta?1:0,mayanFeeNonce:b,referrerFeeNonce:T};Rr.encode(ra,yn);let aa=new Ja({keys:x,data:yn,programId:c});return o.push(aa),{instructions:o,signers:[_,I,S],lookupTables:[],swapMessageV0Params:null}}async function iu(e,t,n,r,i,a,p,o,s,c){let u=!!(!e.gasless&&s&&s.tipLamports>0&&s.signAllTransactions),d=[],f,m,y,{instructions:b,signers:g,lookupTables:T,swapMessageV0Params:I}=await ei(e,t,n,r,a,{allowSwapperOffCurve:c?.allowSwapperOffCurve,forceSkipCctpInstructions:c?.forceSkipCctpInstructions,separateSwapTx:u&&s?.separateSwapTx,usdcPermitSignature:c?.usdcPermitSignature,skipProxyMayanInstructions:c?.skipProxyMayanInstructions===!0,customPayload:c?.customPayload});if(e.gasless){f=new se(e.relayer);let{publicKey:E,nonce:C}=await En(e.fromChain,t);d=[dt.nonceAdvance({noncePubkey:new se(E),authorizedPubkey:f}),...b],m=C,y=0}else{f=new se(t),d=b;let E=await a.getLatestBlockhash();m=E.blockhash,y=E.lastValidBlockHeight}let S=new se(t),M=Mr.compile({instructions:d,payerKey:f,recentBlockhash:m,addressLookupTableAccounts:T}),F=new _r(M);F.sign(g);let D;if(u&&!e.gasless){let E=[];if(I){if(!y)throw new Error("lastValidBlockHeight is missing");let V=new $a({feePayer:S,blockhash:m,lastValidBlockHeight:y}).add(...I.createTmpTokenAccountIxs);V.partialSign(I.tmpTokenAccount),E.push(V);let H=Mr.compile({...I.messageV0,recentBlockhash:m});E.push(new _r(H))}let C=zn(t,m,y,s);E.push(F),E.push(C);let N=await s.signAllTransactions(E);D=N[N.length-2];let O=null,W="version"in D;if(W&&D.signatures[0]?O=kr.encode(Uint8Array.from(D.signatures[0])):!W&&D.signatures[0]?.publicKey&&(O=kr.encode(Uint8Array.from(D.signatures[0].signature))),O===null)throw new Error("Failed to get mayan tx hash");if(I){let V=await jt(N,s,!0);return await Xn(V,s,y,O,a),qn(V),{signature:O,serializedTrx:null}}else jt(N,s).then(()=>{console.log("Jito bundle sent")}).catch(()=>{})}else D=await i(F);if(e.gasless){let E=Ne.from(D.serialize()).toString("base64"),{orderHash:C}=await kn(E,e.fromChain);return{signature:C,serializedTrx:null}}return await _t({trx:D.serialize(),connection:a,extraRpcs:p??[],errorChance:2,options:o})}import{Buffer as ni}from"buffer";function Or(e,t,n,r,i,a){let p=ie(Number(i)),o=P(e.fromChain),s=P(e.toChain);if(o!==p)throw new Error(`Signer chain id(${Number(i)}) and quote from chain are not same! ${o} !== ${p}`);if(!e.swiftMayanContract)throw new Error("SWIFT contract address is missing");if(e.toToken.wChainId!==s)throw new Error(`Destination chain ID mismatch: ${s} != ${e.toToken.wChainId}`);if(e.swiftVersion!=="V2"&&e.toChain==="sui")throw new Error("Swift V2 is required for SUI chain");let c=e.swiftMayanContract;if(!Number(e.deadline64))throw new Error("Swift order requires timeout");let u=BigInt(e.deadline64),d=e.swiftInputContract,f=BigInt(e.effectiveAmountIn64),m,y=e.swiftVersion==="V2"?o:s;r?m=h(r,y):m=h(ti.programId.toString(),1);let b="0x"+ht(e).toString("hex");if(e.toChain==="sui"&&!e.toToken.verifiedAddress)throw new Error("Missing verified address for SUI coin");let g=qe(e),T=w(e.minAmountOut,Math.min(e.toToken.decimals,Fe(e.toChain,e.type))),I=w(e.gasDrop,Math.min(L(e.toChain),Fe(e.toChain,e.type)));if(!e.refundRelayerFee64||!e.cancelRelayerFee64)throw new Error("Swift order requires refund and cancel fees");let S=h(n,s);if(!e.swiftAuctionMode)throw new Error("Swift order requires auction mode");let M={payloadType:a?je:Ye,trader:h(t,o),tokenOut:g,minAmountOut:T,gasDrop:I,cancelFee:BigInt(e.cancelRelayerFee64),refundFee:BigInt(e.refundRelayerFee64),deadline:u,destAddr:S,destChainId:s,referrerAddr:m,referrerBps:e.referrerBps||0,auctionMode:e.swiftAuctionMode,random:b};return{contractAddress:c,tokenIn:d,amountIn:f,order:M,customPayload:a?`0x${ni.from(a).toString("hex")}`:"0x"}}async function Fr(e,t,n,r,i,a,p){if(e.type!=="SWIFT")throw new Error("Quote type is not SWIFT");if(!Number.isFinite(Number(i)))throw new Error("Invalid signer chain id");if(!Number(e.deadline64))throw new Error("Swift order requires timeout");i=Number(i);let o=a||me,s=new Er(l.MAYAN_FORWARDER_CONTRACT,ye.abi),{tokenIn:c,amountIn:u,order:d,contractAddress:f,customPayload:m}=Or(e,t,n,r,i,p),y,b=new Er(f,e.swiftVersion==="V2"?Bn.abi:Nn.abi);e.swiftInputContract===qt?y=b.interface.encodeFunctionData("createOrderWithEth",e.swiftVersion==="V2"?[d,m]:[d]):y=b.interface.encodeFunctionData("createOrderWithToken",e.swiftVersion==="V2"?[c,u,d,m]:[c,u,d]);let g,T,I;if(e.fromToken.contract===e.swiftInputContract)e.fromToken.contract===qt?(g="forwardEth",T=[f,y],I=Dt(u)):(g="forwardERC20",T=[c,u,o,f,y],I=Dt(0));else{let{swapRouterCalldata:M,swapRouterAddress:F}=await De({forwarderAddress:l.MAYAN_FORWARDER_CONTRACT,slippageBps:e.slippageBps,referrerAddress:r,fromToken:e.fromToken.contract,middleToken:e.swiftInputContract,chainName:e.fromChain,amountIn64:e.effectiveAmountIn64});if(!e.minMiddleAmount)throw new Error("Swift swap requires middle amount, router address and calldata");let D=e.fromToken.contract,E=w(e.minMiddleAmount,e.swiftInputDecimals);e.fromToken.contract===qt?(g="swapAndForwardEth",T=[u,F,M,e.swiftInputContract,E,f,y],I=Dt(u)):(g="swapAndForwardERC20",T=[D,u,o,F,M,e.swiftInputContract,E,f,y],I=Dt(0))}return{data:s.interface.encodeFunctionData(g,T),to:l.MAYAN_FORWARDER_CONTRACT,value:I,chainId:i,_forwarder:{method:g,params:T}}}function ri(e,t,n){if(!Number.isFinite(Number(n)))throw new Error("Invalid signer chain id");if(!e.submitRelayerFee64)throw new Error("Swift gasless order requires submit relayer fee");if(!e.swiftMayanContract)throw new Error("Swift contract address is missing in quote");let r=BigInt(e.effectiveAmountIn64),i=BigInt(e.submitRelayerFee64);return{domain:{name:"Mayan Swift",chainId:Number(n),verifyingContract:e.swiftMayanContract},types:{CreateOrder:[{name:"OrderId",type:"bytes32"},{name:"InputAmount",type:"uint256"},{name:"SubmissionFee",type:"uint256"}]},value:{OrderId:t,InputAmount:r-i,SubmissionFee:i}}}function Dr(e,t,n,r,i,a,p){if(e.type!=="SWIFT")throw new Error("Quote type is not SWIFT");if(!e.gasless)throw new Error("Quote does not support gasless");if(!Number.isFinite(Number(i)))throw new Error("Invalid signer chain id");if(!Number(e.deadline64))throw new Error("Swift order requires timeout");if(e.fromToken.contract!==e.swiftInputContract)throw new Error("Swift gasless order creation does not support source swap");if(!e.submitRelayerFee64)throw new Error("Swift gasless order requires submit relayer fee");let{tokenIn:o,amountIn:s,order:c,customPayload:u}=Or(e,t,n,r,Number(i),p),d=P(e.fromChain),m=`0x${Jt(e,t,n,r,c.random,p).toString("hex")}`,y=ri(e,m,i);return{swiftVersion:e.swiftVersion,permitParams:a,orderParams:{...c,sourceChainId:d,amountIn:s,tokenIn:o,submissionFee:BigInt(e.submitRelayerFee64)},orderHash:m,customPayload:u,orderTypedData:y}}import{Contract as rn,toBeHex as We,ZeroAddress as tn}from"ethers";import{SystemProgram as nn}from"@solana/web3.js";var en={abi:[{type:"constructor",inputs:[{name:"_cctpTokenMessengerV2",type:"address",internalType:"address"},{name:"_feeManager",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"receive",stateMutability:"payable"},{type:"function",name:"bridge",inputs:[{name:"tokenIn",type:"address",internalType:"address"},{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"redeemFee",type:"uint64",internalType:"uint64"},{name:"circleMaxFee",type:"uint256",internalType:"uint256"},{name:"gasDrop",type:"uint64",internalType:"uint64"},{name:"destAddr",type:"bytes32",internalType:"bytes32"},{name:"destDomain",type:"uint32",internalType:"uint32"},{name:"referrerAddress",type:"bytes32",internalType:"bytes32"},{name:"referrerBps",type:"uint8",internalType:"uint8"},{name:"payloadType",type:"uint8",internalType:"uint8"},{name:"minFinalityThreshold",type:"uint32",internalType:"uint32"},{name:"customPayload",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"cctpTokenMessengerV2",inputs:[],outputs:[{name:"",type:"address",internalType:"contract ITokenMessengerV2"}],stateMutability:"view"},{type:"function",name:"changeGuardian",inputs:[{name:"newGuardian",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"claimGuardian",inputs:[],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"createOrder",inputs:[{name:"tokenIn",type:"address",internalType:"address"},{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"circleMaxFee",type:"uint256",internalType:"uint256"},{name:"destDomain",type:"uint32",internalType:"uint32"},{name:"minFinalityThreshold",type:"uint32",internalType:"uint32"},{name:"orderPayload",type:"tuple",internalType:"struct FastMCTP.OrderPayload",components:[{name:"payloadType",type:"uint8",internalType:"uint8"},{name:"destAddr",type:"bytes32",internalType:"bytes32"},{name:"tokenOut",type:"bytes32",internalType:"bytes32"},{name:"amountOutMin",type:"uint64",internalType:"uint64"},{name:"gasDrop",type:"uint64",internalType:"uint64"},{name:"redeemFee",type:"uint64",internalType:"uint64"},{name:"refundFee",type:"uint64",internalType:"uint64"},{name:"deadline",type:"uint64",internalType:"uint64"},{name:"referrerAddr",type:"bytes32",internalType:"bytes32"},{name:"referrerBps",type:"uint8",internalType:"uint8"}]}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"domainToCaller",inputs:[{name:"",type:"uint32",internalType:"uint32"}],outputs:[{name:"",type:"bytes32",internalType:"bytes32"}],stateMutability:"view"},{type:"function",name:"feeManager",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"fulfillOrder",inputs:[{name:"cctpMsg",type:"bytes",internalType:"bytes"},{name:"cctpSigs",type:"bytes",internalType:"bytes"},{name:"swapProtocol",type:"address",internalType:"address"},{name:"swapData",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"guardian",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"keyToMintRecipient",inputs:[{name:"",type:"bytes32",internalType:"bytes32"}],outputs:[{name:"",type:"bytes32",internalType:"bytes32"}],stateMutability:"view"},{type:"function",name:"nextGuardian",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"paused",inputs:[],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"redeem",inputs:[{name:"cctpMsg",type:"bytes",internalType:"bytes"},{name:"cctpSigs",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"refund",inputs:[{name:"cctpMsg",type:"bytes",internalType:"bytes"},{name:"cctpSigs",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"rescueEth",inputs:[{name:"amount",type:"uint256",internalType:"uint256"},{name:"to",type:"address",internalType:"address payable"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"rescueRedeem",inputs:[{name:"cctpMsg",type:"bytes",internalType:"bytes"},{name:"cctpSigs",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"rescueToken",inputs:[{name:"token",type:"address",internalType:"address"},{name:"amount",type:"uint256",internalType:"uint256"},{name:"to",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setDomainCallers",inputs:[{name:"domain",type:"uint32",internalType:"uint32"},{name:"caller",type:"bytes32",internalType:"bytes32"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setFeeManager",inputs:[{name:"_feeManager",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setMintRecipient",inputs:[{name:"destDomain",type:"uint32",internalType:"uint32"},{name:"tokenIn",type:"address",internalType:"address"},{name:"mintRecipient",type:"bytes32",internalType:"bytes32"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setPause",inputs:[{name:"_pause",type:"bool",internalType:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setWhitelistedMsgSenders",inputs:[{name:"sender",type:"address",internalType:"address"},{name:"isWhitelisted",type:"bool",internalType:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setWhitelistedSwapProtocols",inputs:[{name:"protocol",type:"address",internalType:"address"},{name:"isWhitelisted",type:"bool",internalType:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"whitelistedMsgSenders",inputs:[{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"whitelistedSwapProtocols",inputs:[{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"event",name:"OrderFulfilled",inputs:[{name:"sourceDomain",type:"uint32",indexed:!1,internalType:"uint32"},{name:"sourceNonce",type:"bytes32",indexed:!1,internalType:"bytes32"},{name:"amount",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"event",name:"OrderRefunded",inputs:[{name:"sourceDomain",type:"uint32",indexed:!1,internalType:"uint32"},{name:"sourceNonce",type:"bytes32",indexed:!1,internalType:"bytes32"},{name:"amount",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"error",name:"AlreadySet",inputs:[]},{type:"error",name:"CallerNotSet",inputs:[]},{type:"error",name:"CctpReceiveFailed",inputs:[]},{type:"error",name:"DeadlineViolation",inputs:[]},{type:"error",name:"EthTransferFailed",inputs:[]},{type:"error",name:"InvalidAddress",inputs:[]},{type:"error",name:"InvalidAmountOut",inputs:[]},{type:"error",name:"InvalidGasDrop",inputs:[]},{type:"error",name:"InvalidMintRecipient",inputs:[]},{type:"error",name:"InvalidPayload",inputs:[]},{type:"error",name:"InvalidPayloadType",inputs:[]},{type:"error",name:"InvalidRedeemFee",inputs:[]},{type:"error",name:"InvalidRefundFee",inputs:[]},{type:"error",name:"MintRecipientNotSet",inputs:[]},{type:"error",name:"Paused",inputs:[]},{type:"error",name:"Unauthorized",inputs:[]},{type:"error",name:"UnauthorizedMsgSender",inputs:[]},{type:"error",name:"UnauthorizedSwapProtocol",inputs:[]}]};import{Buffer as ai}from"buffer";function ii(e,t,n,r,i){let a=ie(Number(r)),p=P(e.fromChain),o=P(e.toChain);if(p!==a)throw new Error(`Signer chain id(${Number(r)}) and quote from chain are not same! ${p} !== ${a}`);let s=h(t,o),c=w(e.redeemRelayerFee,G),u=w(e.gasDrop,Math.min(L(e.toChain),8)),d=BigInt(e.circleMaxFee64),f=BigInt(e.effectiveAmountIn64),m=oe(e.toChain),y;if(n?y=h(n,o):y=h(nn.programId.toString(),P("solana")),!e.fastMctpMayanContract)throw new Error("FastMctp contract address is missing");let b=e.fastMctpMayanContract;return{tokenIn:e.fastMctpInputContract,amountIn:f,redeemFee:c,gasDrop:u,destAddr:s,destDomain:m,referrerAddr:y,referrerBps:e.referrerBps||0,payloadType:i?Cn:An,customPayload:i?`0x${ai.from(i).toString("hex")}`:"0x",minFinalityThreshold:Number(e.fastMctpMinFinality),circleMaxFee:d,contractAddress:b}}function vr(e,t,n,r,i){let a=ii(e,t,n,r,i),{contractAddress:p,tokenIn:o,amountIn:s,destAddr:c,redeemFee:u,gasDrop:d,circleMaxFee:f,referrerAddr:m,referrerBps:y,destDomain:b,customPayload:g,minFinalityThreshold:T,payloadType:I}=a,S=new rn(p,en.abi),M,F;return M=S.interface.encodeFunctionData("bridge",[o,s,u,f,d,c,b,m,y,I,T,g]),F=We(0),{to:p,data:M,value:F,_params:a}}function si(e,t,n,r){let i=ie(Number(r)),a=P(e.fromChain),p=P(e.toChain);if(a!==i)throw new Error(`Signer chain id(${Number(r)}) and quote from chain are not same! ${a} !== ${i}`);if(!e.fastMctpMayanContract)throw new Error("Fast MCTP contract address is missing");let o=e.fastMctpMayanContract,s=h(t,p),c;n?c=h(n,p):c=h(nn.programId.toString(),P("solana"));let u=w(e.redeemRelayerFee,G);if(!e.refundRelayerFee64)throw new Error("Refund relayer fee is missing in quote");let d=BigInt(e.refundRelayerFee64),f=BigInt(e.circleMaxFee64),m=w(e.gasDrop,Math.min(L(e.toChain),8)),y=oe(e.toChain),b=BigInt(e.effectiveAmountIn64),g=w(e.minAmountOut,Math.min(8,e.toToken.decimals)),T=BigInt(e.deadline64);if(e.toChain==="sui"&&!e.toToken.verifiedAddress)throw new Error("To token verified address is missing for SUI");let I=e.toToken.contract===tn?h(nn.programId.toString(),P("solana")):h(e.toChain==="sui"?e.toToken.verifiedAddress:e.toToken.contract,e.toToken.wChainId);return{tokenIn:e.fastMctpInputContract,amountIn:b,circleMaxFee:f,destDomain:y,minFinalityThreshold:Number(e.fastMctpMinFinality),orderPayload:{payloadType:Sn,destAddr:s,tokenOut:I,amountOutMin:g,gasDrop:m,redeemFee:u,refundFee:d,deadline:T,referrerAddr:c,referrerBps:e.referrerBps||0},contractAddress:o}}function xr(e,t,n,r){let i=si(e,t,n,r),{contractAddress:a,orderPayload:p,tokenIn:o,amountIn:s,circleMaxFee:c,destDomain:u,minFinalityThreshold:d}=i,m=new rn(a,en.abi).interface.encodeFunctionData("createOrder",[o,s,c,u,d,p]),y=We(0);return{to:a,data:m,value:y,_params:i}}async function Br(e,t,n,r,i,a){if(e.type!=="FAST_MCTP")throw new Error("Quote type is not FAST_MCTP");if(!Number.isFinite(Number(r)))throw new Error("Invalid signer chain id");r=Number(r);let p=i||me,o=new rn(l.MAYAN_FORWARDER_CONTRACT,ye.abi);if(e.fromToken.contract===e.fastMctpInputContract)if(e.hasAuction){if(!Number(e.deadline64))throw new Error("Fast Mctp order requires timeout");let s=xr(e,t,n,r),c="forwardERC20",u=[e.fromToken.contract,s._params.amountIn,p,s._params.contractAddress,s.data];return{data:o.interface.encodeFunctionData(c,u),to:l.MAYAN_FORWARDER_CONTRACT,value:We(0),chainId:r,_forwarder:{method:c,params:u}}}else{let s=vr(e,t,n,r,a),c="forwardERC20",u=[e.fromToken.contract,s._params.amountIn,p,s._params.contractAddress,s.data];return{data:o.interface.encodeFunctionData(c,u),to:l.MAYAN_FORWARDER_CONTRACT,value:We(0),chainId:r,_forwarder:{method:c,params:u}}}else{let{minMiddleAmount:s}=e;if(!s)throw new Error("Fast Mctp swap requires middle amount, router address and calldata");let{swapRouterCalldata:c,swapRouterAddress:u}=await De({forwarderAddress:l.MAYAN_FORWARDER_CONTRACT,fromToken:e.fromToken.contract,middleToken:e.fastMctpInputContract,slippageBps:e.slippageBps,referrerAddress:n||void 0,amountIn64:e.effectiveAmountIn64,chainName:e.fromChain});if(e.hasAuction){if(!Number(e.deadline64))throw new Error("Fast Mctp order requires timeout");let d=xr(e,t,n,r);if(!e.minMiddleAmount)throw new Error("minMiddleAmount is required for Fast MCTP swap");let f=w(e.minMiddleAmount,G);if(e.fromToken.contract===tn){let m="swapAndForwardEth",y=[d._params.amountIn,u,c,e.fastMctpInputContract,f,d._params.contractAddress,d.data];return{data:o.interface.encodeFunctionData(m,y),to:l.MAYAN_FORWARDER_CONTRACT,value:We(d._params.amountIn),chainId:r,_forwarder:{method:m,params:y}}}else{let m="swapAndForwardERC20",y=[e.fromToken.contract,d._params.amountIn,p,u,c,e.fastMctpInputContract,f,d._params.contractAddress,d.data];return{data:o.interface.encodeFunctionData(m,y),to:l.MAYAN_FORWARDER_CONTRACT,value:We(0),chainId:r,_forwarder:{method:m,params:y}}}}else{let d=vr(e,t,n,r,a);if(!e.minMiddleAmount)throw new Error("minMiddleAmount is required for Fast MCTP swap");let f=w(e.minMiddleAmount,G);if(e.fromToken.contract===tn){let m="swapAndForwardEth",y=[d._params.amountIn,u,c,e.fastMctpInputContract,f,d._params.contractAddress,d.data];return{data:o.interface.encodeFunctionData(m,y),to:l.MAYAN_FORWARDER_CONTRACT,value:We(d._params.amountIn),chainId:r,_forwarder:{method:m,params:y}}}else{let m="swapAndForwardERC20",y=[e.fromToken.contract,d._params.amountIn,p,u,c,e.fastMctpInputContract,f,d._params.contractAddress,d.data];return{data:o.interface.encodeFunctionData(m,y),to:l.MAYAN_FORWARDER_CONTRACT,value:We(0),chainId:r,_forwarder:{method:m,params:y}}}}}}import{Contract as sn,toBeHex as mt,ZeroAddress as oi}from"ethers";import{SystemProgram as ui}from"@solana/web3.js";var an={abi:[{type:"constructor",inputs:[{name:"_hcProcessor",type:"address",internalType:"address"},{name:"_usdc",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"function",name:"changeGuardian",inputs:[{name:"newGuardian",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"claimGuardian",inputs:[],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"deposit",inputs:[{name:"tokenIn",type:"address",internalType:"address"},{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"trader",type:"address",internalType:"address"},{name:"gasDrop",type:"uint64",internalType:"uint64"},{name:"bridgeAmount",type:"uint256",internalType:"uint256"},{name:"depositPayload",type:"tuple",internalType:"struct HCDepositInitiator.DepositPayload",components:[{name:"relayerFee",type:"uint64",internalType:"uint64"},{name:"permit",type:"tuple",internalType:"struct IHCBridge.DepositWithPermit",components:[{name:"user",type:"address",internalType:"address"},{name:"usd",type:"uint64",internalType:"uint64"},{name:"deadline",type:"uint64",internalType:"uint64"},{name:"signature",type:"tuple",internalType:"struct IHCBridge.Signature",components:[{name:"r",type:"uint256",internalType:"uint256"},{name:"s",type:"uint256",internalType:"uint256"},{name:"v",type:"uint8",internalType:"uint8"}]}]}]}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"fastDeposit",inputs:[{name:"tokenIn",type:"address",internalType:"address"},{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"trader",type:"address",internalType:"address"},{name:"circleMaxFee",type:"uint256",internalType:"uint256"},{name:"gasDrop",type:"uint64",internalType:"uint64"},{name:"referrerAddress",type:"bytes32",internalType:"bytes32"},{name:"referrerBps",type:"uint8",internalType:"uint8"},{name:"minFinalityThreshold",type:"uint32",internalType:"uint32"},{name:"bridgeAmount",type:"uint256",internalType:"uint256"},{name:"depositPayload",type:"tuple",internalType:"struct HCDepositInitiator.DepositPayload",components:[{name:"relayerFee",type:"uint64",internalType:"uint64"},{name:"permit",type:"tuple",internalType:"struct IHCBridge.DepositWithPermit",components:[{name:"user",type:"address",internalType:"address"},{name:"usd",type:"uint64",internalType:"uint64"},{name:"deadline",type:"uint64",internalType:"uint64"},{name:"signature",type:"tuple",internalType:"struct IHCBridge.Signature",components:[{name:"r",type:"uint256",internalType:"uint256"},{name:"s",type:"uint256",internalType:"uint256"},{name:"v",type:"uint8",internalType:"uint8"}]}]}]}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"fastMCTP",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"guardian",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"mayanCircle",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"nextGuardian",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"setFastMCTP",inputs:[{name:"_fastMCTP",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setMayanCircle",inputs:[{name:"_mayanCircle",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"error",name:"AlreadySet",inputs:[]},{type:"error",name:"InsufficientAmount",inputs:[]},{type:"error",name:"Unauthorized",inputs:[]}]};import{Buffer as Nr}from"buffer";function pi(e,t,n,r){if(!e.hyperCoreParams)throw new Error("HyperCore parameters are missing");if(!e.hyperCoreParams.initiateContractAddress)throw new Error("HyperCore initiate contract address is missing");if(e.type!=="MCTP")throw new Error("Unsupported quote type for HyperCore deposit: "+e.type);let i=new sn(e.hyperCoreParams.initiateContractAddress,an.abi),a=Nr.from(K(r));if(a.length!==65)throw new Error("Invalid USDC permit signature length");let p="0x"+a.subarray(0,32).toString("hex"),o="0x"+a.subarray(32,64).toString("hex"),s=a[64],c,u;return c=i.interface.encodeFunctionData("deposit",[e.hyperCoreParams.initiateTokenContract,BigInt(e.hyperCoreParams.bridgeAmountUSDC64),t,w(e.hyperCoreParams.failureGasDrop,Math.min(L("arbitrum"),8)),BigInt(e.hyperCoreParams.bridgeAmountUSDC64),{relayerFee:w(e.redeemRelayerFee,G),permit:{user:n,usd:BigInt(e.hyperCoreParams.depositAmountUSDC64),deadline:BigInt(e.deadline64),signature:{r:p,s:o,v:s}}}]),u=mt(0),{to:e.hyperCoreParams.initiateContractAddress,data:c,value:u,_params:{amountIn:BigInt(e.hyperCoreParams.bridgeAmountUSDC64),contractAddress:e.hyperCoreParams.initiateContractAddress}}}function ci(e,t,n,r,i){let a=P("arbitrum");if(!e.hyperCoreParams)throw new Error("HyperCore parameters are missing");if(!e.hyperCoreParams.initiateContractAddress)throw new Error("HyperCore initiate contract address is missing");if(e.type!=="FAST_MCTP")throw new Error("Unsupported quote type for HyperCore deposit: "+e.type);let p=new sn(e.hyperCoreParams.initiateContractAddress,an.abi),o=Nr.from(K(i));if(o.length!==65)throw new Error("Invalid USDC permit signature length");let s="0x"+o.subarray(0,32).toString("hex"),c="0x"+o.subarray(32,64).toString("hex"),u=o[64],d;r?d=h(r,a):d=h(ui.programId.toString(),P("solana"));let f,m;return f=p.interface.encodeFunctionData("fastDeposit",[e.hyperCoreParams.initiateTokenContract,BigInt(e.hyperCoreParams.bridgeAmountUSDC64),t,BigInt(e.circleMaxFee64),w(e.hyperCoreParams.failureGasDrop,Math.min(L("arbitrum"),8)),d,e.referrerBps,Number(e.fastMctpMinFinality),BigInt(e.hyperCoreParams.bridgeAmountUSDC64),{relayerFee:w(e.redeemRelayerFee,G),permit:{user:n,usd:BigInt(e.hyperCoreParams.depositAmountUSDC64),deadline:BigInt(e.deadline64),signature:{r:s,s:c,v:u}}}]),m=mt(0),{to:e.hyperCoreParams.initiateContractAddress,data:f,value:m,_params:{amountIn:BigInt(e.hyperCoreParams.bridgeAmountUSDC64),contractAddress:e.hyperCoreParams.initiateContractAddress}}}async function Wr(e,t,n,r,i,a,p,o={}){if(e.toToken.contract.toLowerCase()!==l.ARBITRUM_USDC_CONTRACT.toLowerCase()||e.type!=="MCTP"&&e.type!=="FAST_MCTP")throw new Error("Unsupported quote type for USDC deposit: "+e.type);if(!o?.usdcPermitSignature)throw new Error("USDC permit signature is required for this quote");if(!e.hyperCoreParams)throw new Error("HyperCore parameters are required for this quote");if(p)throw new Error("HyperCore deposit does not support payload");if(!Number.isFinite(Number(i)))throw new Error("Invalid signer chain id");let s=ie(Number(i)),c=P(e.fromChain);if(c!==s)throw new Error(`Signer chain id(${Number(i)}) and quote from chain are not same! ${c} !== ${s}`);let u=a||me,d=new sn(l.MAYAN_FORWARDER_CONTRACT,ye.abi),f;if(!Number(e.deadline64))throw new Error("HyperCore deposit requires timeout");if(e.type==="MCTP")f=pi(e,t,n,o.usdcPermitSignature);else if(e.type==="FAST_MCTP")f=ci(e,t,n,r,o.usdcPermitSignature);else throw new Error("Unsupported quote type for HyperCore deposit: "+e.type);if(e.fromToken.contract.toLowerCase()===e.hyperCoreParams.initiateTokenContract.toLowerCase()){let m="forwardERC20",y=[e.fromToken.contract,BigInt(e.effectiveAmountIn64),u,f._params.contractAddress,f.data];return{data:d.interface.encodeFunctionData(m,y),to:l.MAYAN_FORWARDER_CONTRACT,value:mt(0),chainId:i,_forwarder:{method:m,params:y}}}else{let{swapRouterCalldata:m,swapRouterAddress:y}=await De({fromToken:e.fromToken.contract,middleToken:e.hyperCoreParams.initiateTokenContract,chainName:e.fromChain,amountIn64:e.effectiveAmountIn64,referrerAddress:r,slippageBps:e.slippageBps,forwarderAddress:l.MAYAN_FORWARDER_CONTRACT});if(!e.minMiddleAmount)throw new Error("Fast Mctp swap requires middle amount, router address and calldata");let b=w(e.minMiddleAmount,G);if(e.fromToken.contract===oi){let g="swapAndForwardEth",T=[BigInt(e.effectiveAmountIn64),y,m,e.hyperCoreParams.initiateTokenContract,b,f._params.contractAddress,f.data];return{data:d.interface.encodeFunctionData(g,T),to:l.MAYAN_FORWARDER_CONTRACT,value:mt(BigInt(e.effectiveAmountIn64)),chainId:i,_forwarder:{method:g,params:T}}}else{let g="swapAndForwardERC20",T=[e.fromToken.contract,BigInt(e.effectiveAmountIn64),u,y,m,e.hyperCoreParams.initiateTokenContract,b,f._params.contractAddress,f.data];return{data:d.interface.encodeFunctionData(g,T),to:l.MAYAN_FORWARDER_CONTRACT,value:mt(0),chainId:i,_forwarder:{method:g,params:T}}}}}import{Contract as Kr,toBeHex as vt,ZeroAddress as yt}from"ethers";var Ur={abi:[{type:"constructor",inputs:[{name:"_forwarderAddress",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"receive",stateMutability:"payable"},{type:"function",name:"ForwarderAddress",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"MAX_REFERRER_BPS",inputs:[],outputs:[{name:"",type:"uint8",internalType:"uint8"}],stateMutability:"view"},{type:"function",name:"changeGuardian",inputs:[{name:"newGuardian",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"claimGuardian",inputs:[],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"guardian",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"nextGuardian",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"rescueETH",inputs:[{name:"to",type:"address",internalType:"address"},{name:"amount",type:"uint256",internalType:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"rescueToken",inputs:[{name:"token",type:"address",internalType:"address"},{name:"to",type:"address",internalType:"address"},{name:"amount",type:"uint256",internalType:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"transferEth",inputs:[{name:"to",type:"address",internalType:"address"},{name:"referrerAddr",type:"address",internalType:"address"},{name:"referrerBps",type:"uint8",internalType:"uint8"}],outputs:[],stateMutability:"payable"},{type:"function",name:"transferToken",inputs:[{name:"token",type:"address",internalType:"address"},{name:"amount",type:"uint256",internalType:"uint256"},{name:"to",type:"address",internalType:"address"},{name:"referrerAddr",type:"address",internalType:"address"},{name:"referrerBps",type:"uint8",internalType:"uint8"}],outputs:[],stateMutability:"nonpayable"},{type:"event",name:"EthTransferred",inputs:[{name:"to",type:"address",indexed:!1,internalType:"address"},{name:"amount",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"event",name:"TokenTransferred",inputs:[{name:"token",type:"address",indexed:!1,internalType:"address"},{name:"to",type:"address",indexed:!1,internalType:"address"},{name:"amount",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"error",name:"InvalidReferrerBps",inputs:[]},{type:"error",name:"Unauthorized",inputs:[]}]};function li(e,t,n){let r=w(e.expectedAmountOut,e.toToken.decimals),i=new Kr(e.monoChainMayanContract,Ur.abi),a=n&&e.referrerBps||0,p,o;return e.toToken.contract===yt?p=i.interface.encodeFunctionData("transferEth",[t,n||yt,a]):p=i.interface.encodeFunctionData("transferToken",[e.toToken.contract,r,t,n||yt,a]),e.fromToken.contract===yt?o=vt(e.effectiveAmountIn64):o=vt(0),{to:e.monoChainMayanContract,data:p,value:o,_params:{amountIn:BigInt(e.effectiveAmountIn64),tokenIn:e.fromToken.contract}}}function Lr(e,t,n,r,i){if(e.type!=="MONO_CHAIN")throw new Error("Quote type is not MONO_CHAIN");if(e.fromChain!==e.toChain)throw new Error("Quote chains are not equal");if(e.fromToken.contract.toLowerCase()===e.toToken.contract.toLowerCase())throw new Error(`From token and to token are the same: ${e.fromToken.contract}`);if(!Number.isFinite(Number(r)))throw new Error("Invalid signer chain id");let a=ie(Number(r)),p=P(e.fromChain);if(p!==a)throw new Error(`Signer chain id(${Number(r)}) and quote from chain are not same! ${p} !== ${a}`);r=Number(r);let o=i||me,s=new Kr(l.MAYAN_FORWARDER_CONTRACT,ye.abi),{evmSwapRouterAddress:c,evmSwapRouterCalldata:u}=e;if(!c||!u)throw new Error("Mono chain swap requires router address and calldata");let d=li(e,t,n),f=w(e.minAmountOut,e.toToken.decimals);if(e.fromToken.contract===yt){let m="swapAndForwardEth",y=[d._params.amountIn,c,u,e.toToken.contract,f,e.monoChainMayanContract,d.data];return{data:s.interface.encodeFunctionData(m,y),to:l.MAYAN_FORWARDER_CONTRACT,value:vt(d._params.amountIn),chainId:r,_forwarder:{method:m,params:y}}}else{let m="swapAndForwardERC20",y=[e.fromToken.contract,d._params.amountIn,o,c,u,e.toToken.contract,f,e.monoChainMayanContract,d.data];return{data:s.interface.encodeFunctionData(m,y),to:l.MAYAN_FORWARDER_CONTRACT,value:vt(0),chainId:r,_forwarder:{method:m,params:y}}}}function mi(e,t,n,r,i,a){let p=new on(l.MAYAN_PROGRAM_ID),[o]=on.findProgramAddressSync([Hr.from("MAIN")],p),s=B(new on(e.fromToken.mint),o,!0),c=BigInt(e.effectiveAmountIn64),u=h(s.toString(),1),d=h(l.AUCTION_PROGRAM_ID,1),f;n?f=h(n,1):f=h(di.programId.toString(),1);let m=ie(Number(i)),y=P(e.fromChain),b=P(e.toChain);if(y!==m)throw new Error(`Signer chain id(${Number(i)}) and quote from chain are not same! ${y} !== ${m}`);let g=e.whMayanContract,T={mayanAddr:u,mayanChainId:1,destAddr:h(t,b),destChainId:b,auctionAddr:d,referrer:f,refundAddr:h(r,m)},I=e.toToken.contract===Qr,S={transferDeadline:BigInt(e.deadline64),swapDeadline:BigInt(e.deadline64),amountOutMin:w(e.minAmountOut,Math.min(8,e.toToken.decimals)),gasDrop:w(e.gasDrop,Math.min(8,L(e.toChain))),unwrap:I,customPayload:a?`0x${Hr.from(a).toString("hex")}`:"0x"},M={swapFee:w(e.swapRelayerFee,Math.min(8,e.fromToken.decimals)),redeemFee:w(e.redeemRelayerFee,Math.min(8,e.toToken.decimals)),refundFee:w(e.refundRelayerFee,Math.min(8,e.fromToken.decimals))};if(!e.toToken.realOriginContractAddress||!e.toToken.realOriginChainId)throw new Error("Missing toToken real origin contract address");let F=h(e.toToken.realOriginContractAddress,e.toToken.realOriginChainId),D=w(e.bridgeFee,18);return{amountIn:c,tokenIn:e.fromToken.contract,tokenOut:F,tokenOutWChainId:e.toToken.realOriginChainId,criteria:S,recipient:T,relayerFees:M,contractAddress:g,bridgeFee:D}}async function xt(e,t,n,r,i,a,p,o,s){let c=ie(Number(a)),u=P(e.fromChain);if(u!==c)throw new Error(`Signer chain id(${Number(a)}) and quote from chain are not same! ${u} !== ${c}`);let d=Ke(e,r);if(e.toChain==="hypercore")return Wr(e,t,n,d,a,o,p,s);if(e.type==="MCTP")return xn(e,n,d,a,o,p);if(e.type==="SWIFT")return Fr(e,t,n,d,a,o,p);if(e.type==="SHUTTLE")throw new Error("SHUTTLE quote type is not supported on EVM");if(e.type==="FAST_MCTP")return Br(e,n,d,a,o,p);if(e.type==="MONO_CHAIN")return Lr(e,n,d,a,o);if(e.type!="WH")throw new Error("Unsupported quote type");if(!Number(e.deadline64))throw new Error("WH mode requires a timeout");let{relayerFees:f,recipient:m,tokenOut:y,tokenOutWChainId:b,criteria:g,tokenIn:T,amountIn:I,contractAddress:S,bridgeFee:M}=mi(e,n,d,i,a,p),F=new Gr(l.MAYAN_FORWARDER_CONTRACT,ye.abi),D=new Gr(S,On.abi),E,C,N,O=o||me;if(T===Qr){let V=D.interface.encodeFunctionData("wrapAndSwapETH",[f,m,y,b,g]);E="forwardEth",C=[S,V],N=Vr(I)}else{let V=D.interface.encodeFunctionData("swap",[f,m,y,b,g,T,I]);E="forwardERC20",C=[T,I,O,S,V],N=Vr(M)}let W=F.interface.encodeFunctionData(E,C);return{to:l.MAYAN_FORWARDER_CONTRACT,data:W,value:N,chainId:a,_forwarder:{method:E,params:C}}}async function Pp(e,t,n,r,i,a,p,o,s){if(!i.provider)throw new Error("No provider found for signer");let c=await i.getAddress();if(c.toLowerCase()!==t.toLowerCase())throw new Error("Signer address does not match swapper address");let u=Number((await i.provider.getNetwork()).chainId);if(e.type==="SWIFT"&&e.gasless&&e.toChain!=="hypercore"){let f=Ke(e,r),m=Dr(e,t,n,f,u,a,o),y=await i.signTypedData(m.orderTypedData.domain,m.orderTypedData.types,m.orderTypedData.value);return await _n(m,y),m.orderHash}let d=await xt(e,t,n,r,c,u,o,a,s);if(delete d._forwarder,p?.gasPrice&&(d.gasPrice=p.gasPrice),p?.maxFeePerGas&&(d.maxFeePerGas=p.maxFeePerGas),p?.maxPriorityFeePerGas&&(d.maxPriorityFeePerGas=p.maxPriorityFeePerGas),p?.gasLimit)d.gasLimit=p.gasLimit;else{let f=await i.estimateGas(d);d.gasLimit=String(BigInt(String(f))*BigInt(110)/BigInt(100))}return d.chainId=Lt(e.fromChain),i.sendTransaction(d)}async function Mp(e,t,n,r,i){let a=await n.getAddress(),p=e.toChain==="solana"?"ENsytooJVSZyNHbxvueUeX8Am8gcNqPivVVE8USCBiy5":"0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",o=Number((await n.provider.getNetwork()).chainId);if(e.type==="SWIFT"&&e.gasless)return BigInt(0);let s=await xt(e,t,p,null,a,o,i,r);delete s._forwarder;let c=await n.estimateGas(s);return c=BigInt(String(c)),e.type==="MCTP"||e.type==="SWIFT"?c*BigInt(110)/BigInt(100):c}async function _p(e,t,n,r){let i="0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",a=e.toChain==="solana"?"ENsytooJVSZyNHbxvueUeX8Am8gcNqPivVVE8USCBiy5":"0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",p=e?.fromToken?.chainId;if(e.type==="SWIFT"&&e.gasless)return BigInt(0);let o=await xt(e,i,a,null,i,p,r,n);return delete o._forwarder,t.estimateGas(o)}async function kp(e,t){let n="0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",r=e.toChain==="solana"?"ENsytooJVSZyNHbxvueUeX8Am8gcNqPivVVE8USCBiy5":e.toChain==="sui"?"0xcde6dbe01902be1f200ff03dbbd149e586847be8cee15235f82750d9b06c0e04":"0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",i=Lt(e.fromChain);if(e.type==="SWIFT"&&e.gasless)return{estimateGas:BigInt(0),gasPrice:BigInt(0),requiredNative:BigInt(0)};let a=await xt(e,n,r,null,n,i,t,void 0),{gasPrice:p,estimatedGas:o}=await Rn({from:n,chainId:i,tokenIn:e.fromToken.contract,value:"0x"+BigInt(String(a.value)).toString(16),data:a.data,to:a.to});return{estimateGas:o*BigInt(110)/BigInt(100),gasPrice:p,requiredNative:p*o}}async function Bt(e,t){let n;try{n=await t.getMoveFunctionArgTypes({package:e.package,module:e.module,function:e.function})}catch{throw new Error(`Failed to fetch ${e.package}::${e.module}::${e.function} ArgTypes`)}if(n){if(n[e.argumentIndex]!=="Pure"&&n[e.argumentIndex]?.Object!=="ByImmutableReference")throw new Error(`Argument ${e.argumentIndex} of ${e.module}::${e.function} is not immutable`)}else throw new Error(`Failed to fetch package::${e.module}::${e.function} ArgTypes`)}async function un(e,t){let n=[],r=BigInt(0),i;do{let a=await t.getCoins({...e,owner:e.walletAddress,cursor:i}),p=a.data.filter(o=>BigInt(o.balance)>BigInt(0));if(n=[...n,...p],p.forEach(o=>{r+=BigInt(o.balance)}),a.data.length===0||!a.hasNextPage||!a.nextCursor||r>=e.coinAmount)return{coins:n.sort((o,s)=>Number(BigInt(o.coinObjectId)-BigInt(s.coinObjectId))),sum:r};i=a.nextCursor}while(!0)}async function Ue(e,t){let n;try{n=await t.getObject({id:e,options:{showContent:!0}})}catch(r){throw new Error(`Failed to fetch Mayan Sui package ID: 

 ${r}`)}if(n.data?.content?.fields?.latest_package_id)return n.data.content.fields.latest_package_id;throw new Error("latest_package_id not found in Mayan Sui state object")}async function Me(e,t,n,r,i,a){let p;if(a?.result)p=a.result;else if(a?.objectId)p=i.object(a.objectId);else{let{coins:o,sum:s}=await un({walletAddress:t,coinType:n,coinAmount:e},r);if(s<e)throw new Error(`Insufficient funds to create Coin ${n} with amount ${e}`);o.length>1&&i.mergeCoins(o[0].coinObjectId,o.slice(1).map(u=>u.coinObjectId));let[c]=i.splitCoins(o[0].coinObjectId,[e]);p=c}return p}import{Transaction as ft}from"@mysten/sui/transactions";import{SUI_TYPE_ARG as yi,SUI_CLOCK_OBJECT_ID as fi}from"@mysten/sui/utils";import{SystemProgram as pn}from"@solana/web3.js";import{ZeroAddress as gi}from"ethers";async function Yr(e,t,n,r,i,a,p){if(!e.fromToken.verifiedAddress)throw new Error("from token verified address is not provided");let[o,s]=await Promise.all([Ue(l.SUI_MCTP_STATE,a),e.hasAuction?Ue(l.SUI_MCTP_FEE_MANAGER_STATE,a):null]),c,u,d=null;if(e.fromToken.contract===e.mctpInputContract)c=p?.builtTransaction??new ft,u=await Me(BigInt(e.effectiveAmountIn64),t,e.mctpInputContract,a,c,p?.inputCoin);else{let{tx:y,outCoin:b,whFeeCoin:g}=await $e({amountIn64:e.effectiveAmountIn64,inputCoinType:e.fromToken.contract,middleCoinType:e.mctpInputContract,userWallet:t,withWhFee:e.hasAuction||e.cheaperChain!=="sui",referrerAddress:r,inputCoin:p?.inputCoin,transaction:p?.builtTransaction?await p.builtTransaction.toJSON():void 0,slippageBps:e.slippageBps,chainName:e.fromChain});c=ft.from(y),u=b,d=g?{result:g}:null}if(e.hasAuction){if(!s)throw new Error("Fee manager package ID is not found for swap quote");await wi(e,t,n,r,o,s,a,{inputCoin:{result:u},whFeeCoin:d,builtTransaction:c})}else e.cheaperChain==="sui"?await Ti(e,t,n,o,a,{inputCoin:{result:u},whFeeCoin:d,builtTransaction:c}):await bi(e,t,n,o,i,a,{inputCoin:{result:u},whFeeCoin:d,builtTransaction:c});let f=BigInt(e.effectiveAmountIn64),m=i?Uint8Array.from(i):Uint8Array.from([]);c.moveCall({package:o,module:"init_order",function:"log_initialize_mctp",typeArguments:[e.fromToken.contract],arguments:[c.pure.u64(f),c.object(e.fromToken.verifiedAddress),c.pure.vector("u8",m)]});try{let y;r?y=h(r,P(e.toChain)):y=h(pn.programId.toString(),P("solana")),c.moveCall({package:l.SUI_LOGGER_PACKAGE_ID,module:"referrer_logger",function:"log_referrer",arguments:[c.pure.address(y),c.pure.u8(e.referrerBps||0)]})}catch(y){console.error("Failed to log referrer",y)}return c}async function bi(e,t,n,r,i,a,p){return cn({swapperAddress:t,destinationAddress:n,toChain:e.toChain,effectiveAmountIn64:e.effectiveAmountIn64,minMiddleAmount:e.minMiddleAmount,mctpPackageId:r,fromToken:e.fromToken,mctpInputContract:e.mctpInputContract,gasDrop:e.gasDrop,redeemRelayerFee:e.redeemRelayerFee,mctpVerifiedInputAddress:e.mctpVerifiedInputAddress,mctpInputTreasury:e.mctpInputTreasury,bridgeFee:e.bridgeFee,payload:i,suiClient:a,options:p})}async function Ti(e,t,n,r,i,a){let p=P(e.toChain),o=a?.builtTransaction??new ft,s;if(e.fromToken.contract===e.mctpInputContract)s=BigInt(e.effectiveAmountIn64);else{if(!e.minMiddleAmount)throw new Error("minMiddleAmount is required for bridge locked fee when fromToken is different than mctpInputContract");s=w(e.minMiddleAmount,G)}let c=await Me(BigInt(e.effectiveAmountIn64),t,e.mctpInputContract,i,o,a?.inputCoin),u=h(n,p),d=oe(e.toChain),f=w(e.gasDrop,Math.min(L(e.toChain),8)),m=w(e.redeemRelayerFee,G),[y]=o.moveCall({package:r,module:"bridge_locked_fee",function:"prepare_bridge_locked_fee",typeArguments:[e.mctpInputContract],arguments:[c,o.pure.u64(s),o.pure.address(u),o.pure.u32(d),o.pure.u64(f),o.pure.u64(m)]}),[b,g]=o.moveCall({package:r,module:"bridge_locked_fee",function:"bridge_locked_fee",typeArguments:[e.mctpInputContract],arguments:[o.object(l.SUI_MCTP_STATE),o.object(l.SUI_CCTP_CORE_STATE),o.object(e.mctpVerifiedInputAddress),y]}),[T,I]=o.moveCall({package:l.SUI_CCTP_TOKEN_PACKAGE_ID,module:"deposit_for_burn",function:"deposit_for_burn_with_caller_with_package_auth",typeArguments:[e.mctpInputContract,`${r}::bridge_locked_fee::CircleAuth`],arguments:[g,o.object(l.SUI_CCTP_TOKEN_STATE),o.object(l.SUI_CCTP_CORE_STATE),o.object("0x403"),o.object(e.mctpInputTreasury)]});return o.moveCall({package:r,module:"bridge_locked_fee",function:"store_bridge_locked_fee",typeArguments:[e.mctpInputContract],arguments:[o.object(l.SUI_MCTP_STATE),o.object(e.mctpVerifiedInputAddress),b,I]}),o}async function wi(e,t,n,r,i,a,p,o){let s=P(e.toChain),c=o?.builtTransaction??new ft,u;if(e.fromToken.contract===e.mctpInputContract)u=BigInt(e.effectiveAmountIn64);else{if(!e.minMiddleAmount)throw new Error("minMiddleAmount is required for init order when fromToken is different than mctpInputContract");u=w(e.minMiddleAmount,G)}let[d]=await Promise.all([Me(BigInt(e.effectiveAmountIn64),t,e.mctpInputContract,p,c,o?.inputCoin),Bt({package:a,module:"calculate_mctp_fee",function:"prepare_calc_mctp_fee",argumentIndex:3},p)]),f=e.toToken.contract===gi?h(pn.programId.toString(),P("solana")):h(e.toToken.contract,e.toToken.wChainId),m=w(e.minAmountOut,Math.min(8,e.toToken.decimals)),y=h(n,s),b=oe(e.toChain),g=w(e.gasDrop,Math.min(L(e.toChain),8)),T=w(e.redeemRelayerFee,G),I=BigInt(e.deadline64),S;r?S=h(r,s):S=h(pn.programId.toString(),P("solana"));let M=[c.object(e.mctpVerifiedInputAddress),c.pure.u8(hn),c.pure.address(t),d,c.pure.address(y),c.pure.u16(s),c.pure.address(f),c.pure.u64(m),c.pure.u64(g),c.pure.u64(T),c.pure.u64(I),c.pure.address(S),c.pure.u8(e.referrerBps||0)],[F]=c.moveCall({package:a,module:"calculate_mctp_fee",function:"prepare_calc_mctp_fee",typeArguments:[e.mctpInputContract],arguments:M}),[D]=c.moveCall({package:a,module:"calculate_mctp_fee",function:"calculate_mctp_fee",arguments:[c.object(l.SUI_MCTP_FEE_MANAGER_STATE),F]}),[E]=c.moveCall({package:i,module:"init_order",function:"prepare_initialize_order",typeArguments:[e.mctpInputContract],arguments:[...M.slice(1),c.pure.u32(b),c.pure.u64(u)]}),[C,N]=c.moveCall({package:i,module:"init_order",function:"initialize_order",typeArguments:[e.mctpInputContract],arguments:[c.object(l.SUI_MCTP_STATE),c.object(l.SUI_CCTP_CORE_STATE),c.object(e.mctpVerifiedInputAddress),E,D]}),[O,W]=c.moveCall({package:l.SUI_CCTP_TOKEN_PACKAGE_ID,module:"deposit_for_burn",function:"deposit_for_burn_with_caller_with_package_auth",typeArguments:[e.mctpInputContract,`${i}::init_order::CircleAuth`],arguments:[N,c.object(l.SUI_CCTP_TOKEN_STATE),c.object(l.SUI_CCTP_CORE_STATE),c.object("0x403"),c.object(e.mctpInputTreasury)]}),[V]=c.moveCall({package:i,module:"init_order",function:"publish_init_order",arguments:[c.object(l.SUI_MCTP_STATE),C,W]});return await jr(c,V,p,BigInt(e.bridgeFee),t,o?.whFeeCoin),c}async function jr(e,t,n,r,i,a){let p;if(a?.result)p=a.result;else if(a?.objectId)p=e.object(a.objectId);else if(r>BigInt(0)){let{coins:o,sum:s}=await un({walletAddress:i,coinType:yi,coinAmount:r},n);if(s<r)throw new Error("Insufficient funds to pay Wormhole message fee");o.length>1&&e.mergeCoins(o[0].coinObjectId,o.slice(1).map(u=>u.coinObjectId));let[c]=e.splitCoins(o[0].coinObjectId,[r]);p=c}else{let[o]=e.splitCoins(e.gas,[e.pure.u64(0)]);p=o}return e.moveCall({package:l.SUI_WORMHOLE_PACKAGE_ID,module:"publish_message",function:"publish_message",arguments:[e.object(l.SUI_WORMHOLE_STATE),p,t,e.object(fi)]}),e}async function cn(e){let{swapperAddress:t,destinationAddress:n,mctpPackageId:r,payload:i,suiClient:a,options:p}=e,o=P(e.toChain),s=p?.builtTransaction??new ft,c;if(e.fromToken.contract===e.mctpInputContract)c=BigInt(e.effectiveAmountIn64);else{if(!e.minMiddleAmount)throw new Error("minMiddleAmount is required for bridge with fee when fromToken is different than mctpInputContract");c=w(e.minMiddleAmount,G)}let u=await Me(BigInt(e.effectiveAmountIn64),t,e.mctpInputContract,a,s,p?.inputCoin),d=i?wt:Tt,f=h(n,o),m=oe(e.toChain),y=w(e.gasDrop,Math.min(L(e.toChain),8)),b=w(e.redeemRelayerFee,G),g=i?Uint8Array.from(i):Uint8Array.from([]),[T]=s.moveCall({package:r,module:"bridge_with_fee",function:"prepare_bridge_with_fee",typeArguments:[e.mctpInputContract],arguments:[s.pure.u8(d),u,s.pure.u64(c),s.pure.address(f),s.pure.u32(m),s.pure.u64(y),s.pure.u64(b),s.pure.vector("u8",g)]}),[I,S]=s.moveCall({package:r,module:"bridge_with_fee",function:"bridge_with_fee",typeArguments:[e.mctpInputContract],arguments:[s.object(l.SUI_MCTP_STATE),s.object(l.SUI_CCTP_CORE_STATE),s.object(e.mctpVerifiedInputAddress),T]}),[M,F]=s.moveCall({package:l.SUI_CCTP_TOKEN_PACKAGE_ID,module:"deposit_for_burn",function:"deposit_for_burn_with_caller_with_package_auth",typeArguments:[e.mctpInputContract,`${r}::bridge_with_fee::CircleAuth`],arguments:[S,s.object(l.SUI_CCTP_TOKEN_STATE),s.object(l.SUI_CCTP_CORE_STATE),s.object("0x403"),s.object(e.mctpInputTreasury)]}),[D]=s.moveCall({package:r,module:"bridge_with_fee",function:"publish_bridge_with_fee",arguments:[s.object(l.SUI_MCTP_STATE),I,F]});return await jr(s,D,a,BigInt(e.bridgeFee),t,p?.whFeeCoin),s}import{Transaction as $r}from"@mysten/sui/transactions";import{SystemProgram as Ii}from"@solana/web3.js";async function Jr(e,t,n,r,i,a){if(e.toToken.contract.toLowerCase()!==l.ARBITRUM_USDC_CONTRACT.toLowerCase()||e.type!=="MCTP")throw new Error("Unsupported quote type for USDC deposit: "+e.type);if(!e.hyperCoreParams)throw new Error("HyperCore parameters are required for this quote");if(!a?.usdcPermitSignature)throw new Error("USDC permit signature is required for this quote");if(!Number(e.deadline64))throw new Error("HyperCore deposit requires timeout");let[p]=await Promise.all([Ue(l.SUI_MCTP_STATE,i)]),o,s,c=null;if(e.fromToken.contract===e.hyperCoreParams.initiateTokenContract)o=a?.builtTransaction??new $r,s=await Me(BigInt(e.hyperCoreParams.bridgeAmountUSDC64),t,e.mctpInputContract,i,o,a?.inputCoin);else{let{tx:m,outCoin:y,whFeeCoin:b}=await $e({amountIn64:e.effectiveAmountIn64,inputCoinType:e.fromToken.contract,middleCoinType:e.hyperCoreParams.initiateTokenContract,userWallet:t,withWhFee:!0,referrerAddress:r,inputCoin:a?.inputCoin,transaction:a?.builtTransaction?await a.builtTransaction.toJSON():void 0,chainName:"sui",slippageBps:e.slippageBps});o=$r.from(m);let[g]=o.splitCoins(y,[BigInt(e.hyperCoreParams.bridgeAmountUSDC64)]);o.transferObjects([y],o.pure.address(t)),s=g,c=b?{result:b}:null}let u=It(e,n,a.usdcPermitSignature);await cn({swapperAddress:t,destinationAddress:l.HC_ARBITRUM_DEPOSIT_PROCESSOR,mctpPackageId:p,toChain:"arbitrum",effectiveAmountIn64:e.effectiveAmountIn64,minMiddleAmount:Tn(e.hyperCoreParams.bridgeAmountUSDC64,G),bridgeFee:e.bridgeFee,gasDrop:e.hyperCoreParams.failureGasDrop,fromToken:e.fromToken,mctpInputContract:e.mctpInputContract,mctpInputTreasury:e.mctpInputTreasury,mctpVerifiedInputAddress:e.mctpVerifiedInputAddress,redeemRelayerFee:0,payload:u,suiClient:i,options:{inputCoin:{result:s},whFeeCoin:c,builtTransaction:o}});let d=BigInt(e.effectiveAmountIn64),f=Uint8Array.from(u);if(!e.fromToken.verifiedAddress)throw new Error("From token verified address is required from Sui");o.moveCall({package:p,module:"init_order",function:"log_initialize_mctp",typeArguments:[e.fromToken.contract],arguments:[o.pure.u64(d),o.object(e.fromToken.verifiedAddress),o.pure.vector("u8",f)]});try{let m;r?m=h(r,P("arbitrum")):m=h(Ii.programId.toString(),P("solana")),o.moveCall({package:l.SUI_LOGGER_PACKAGE_ID,module:"referrer_logger",function:"log_referrer",arguments:[o.pure.address(m),o.pure.u8(e.referrerBps||0)]})}catch(m){console.error("Failed to log referrer",m)}return o}import{Transaction as mn}from"@mysten/sui/transactions";import{Buffer as ln}from"buffer";import{SystemProgram as dn,Keypair as hi}from"@solana/web3.js";import{ethers as Ai,ZeroAddress as Ci}from"ethers";async function zr(e,t,n,r,i,a,p){if(!e.fromToken.verifiedAddress||!e.swiftVerifiedInputAddress)throw new Error("from token or swift input verified address is not provided");let[o,s]=await Promise.all([Ue(l.SUI_SWIFT_STATE,a),Ue(l.SUI_SWIFT_FEE_MANAGER_STATE,a)]),c,u;if(e.fromToken.contract===e.swiftInputContract)c=p?.builtTransaction??new mn,u=await Me(BigInt(e.effectiveAmountIn64),t,e.swiftInputContract,a,c,p?.inputCoin);else{let{tx:m,outCoin:y}=await $e({amountIn64:e.effectiveAmountIn64,inputCoinType:e.fromToken.contract,middleCoinType:e.swiftInputContract,userWallet:t,withWhFee:!1,referrerAddress:r,inputCoin:p?.inputCoin,transaction:p?.builtTransaction?await p.builtTransaction.toJSON():void 0,slippageBps:e.slippageBps,chainName:e.fromChain});c=mn.from(m),u=y}await Si(e,t,n,r,o,s,i,a,{inputCoin:{result:u},builtTransaction:c,randomKey:p?.randomKey});let d=BigInt(e.effectiveAmountIn64),f=i?Uint8Array.from(i):Uint8Array.from([]);return c.moveCall({package:o,module:"init_order",function:"log_initialize_order",typeArguments:[e.fromToken.contract],arguments:[c.pure.u64(d),c.object(e.fromToken.verifiedAddress),c.pure.vector("u8",f)]}),c}async function Si(e,t,n,r,i,a,p,o,s){let c=P(e.toChain),u=s?.builtTransaction??new mn,d=e.fromToken.contract===e.swiftInputContract?BigInt(e.effectiveAmountIn64):w(e.minMiddleAmount,e.swiftInputDecimals),[f]=await Promise.all([Me(BigInt(e.effectiveAmountIn64),t,e.swiftInputContract,o,u,s?.inputCoin),Bt({package:a,module:"calculate_swift_fee",function:"prepare_calc_swift_fee",argumentIndex:3},o)]),m=e.toToken.contract===Ci?h(dn.programId.toString(),P("solana")):h(e.toToken.contract,e.toToken.wChainId),y=w(e.minAmountOut,Math.min(8,e.toToken.decimals)),b=h(n,c),g=w(e.gasDrop,Math.min(L(e.toChain),8)),T=BigInt(e.cancelRelayerFee64),I=BigInt(e.refundRelayerFee64),S=BigInt(e.deadline64),M;r?M=h(r,P("sui")):M=h(dn.programId.toString(),P("solana"));let F=p?je:Ye,D;p?D=ln.from(K(Ai.keccak256(ln.from(p)))):D=dn.programId.toBuffer();let E=[u.pure.u8(F),u.pure.address(t),u.object(e.swiftVerifiedInputAddress),f,u.pure.address(b),u.pure.u16(c),u.pure.address(m),u.pure.u64(y),u.pure.u64(g),u.pure.u64(T),u.pure.u64(I),u.pure.u64(S),u.pure.address(M),u.pure.u8(e.referrerBps),u.pure.u8(e.swiftAuctionMode)],[C]=u.moveCall({package:a,module:"calculate_swift_fee",function:"prepare_calc_swift_fee",typeArguments:[e.swiftInputContract],arguments:E}),[N]=u.moveCall({package:a,module:"calculate_swift_fee",function:"calculate_swift_fee",arguments:[u.object(l.SUI_SWIFT_FEE_MANAGER_STATE),C]}),O=s?.randomKey?ln.from(s.randomKey):hi.generate().publicKey.toBuffer(),[W]=u.moveCall({package:i,module:"init_order",function:"prepare_initialize_order",typeArguments:[e.swiftInputContract],arguments:[E[0],E[1],E[3],u.pure.u64(d),...E.slice(4),u.pure.address("0x"+O.toString("hex")),u.pure.address("0x"+D.toString("hex"))]}),[V,H]=u.moveCall({package:i,module:"init_order",function:"initialize_order",typeArguments:[e.swiftInputContract],arguments:[u.object(l.SUI_SWIFT_STATE),u.object(e.swiftVerifiedInputAddress),W,N]});return u}async function Cc(e,t,n,r,i,a,p){let o=Ke(e,r);if(e.toChain==="hypercore"){if(!e.hyperCoreParams)throw new Error("HyperCore parameters are required for this quote");if(!p?.usdcPermitSignature)throw new Error("USDC permit signature is required for this quote");if(e.type!=="MCTP")throw new Error("Unsupported quote type for HyperCore deposit: "+e.type);if(i)throw new Error("Payload is not supported for HyperCore deposit quotes");return Jr(e,t,n,o,a,p)}if(e.type==="MCTP")return Yr(e,t,n,o,i,a,p);throw e.type==="SWIFT"?new Error("SWIFT swaps are not supported to Sui chain yet"):new Error("Unsupported quote type from Sui chain")}export{Cn as FAST_MCTP_PAYLOAD_TYPE_CUSTOM_PAYLOAD,An as FAST_MCTP_PAYLOAD_TYPE_DEFAULT,Sn as FAST_MCTP_PAYLOAD_TYPE_ORDER,hn as MCTP_INIT_ORDER_PAYLOAD_ID,wt as MCTP_PAYLOAD_TYPE_CUSTOM_PAYLOAD,Tt as MCTP_PAYLOAD_TYPE_DEFAULT,ma as PermitTypes,je as SWIFT_PAYLOAD_TYPE_CUSTOM_PAYLOAD,Ye as SWIFT_PAYLOAD_TYPE_DEFAULT,me as ZeroPermit,Ti as addBridgeLockedFeeMoveCalls,bi as addBridgeWithFeeMoveCalls,cn as addBridgeWithFeeMoveCalls2,wi as addInitOrderMoveCalls,l as addresses,Bt as assertArgumentIsImmutable,qn as broadcastJitoBundleId,Pn as checkHyperCoreDeposit,wn as checkSdkVersionSupport,Xn as confirmJitoBundleId,$n as createApproveInstruction,ee as createAssociatedTokenAccountInstruction,Pa as createCloseAccountInstruction,Sr as createHyperCoreDepositFromSolanaInstructions,Jr as createHyperCoreDepositFromSuiMoveCalls,Re as createInitializeRandomTokenAccountInstructions,it as createMctpBridgeLedgerInstruction,at as createMctpBridgeWithFeeInstruction,lr as createMctpFromSolanaInstructions,Yr as createMctpFromSuiMoveCalls,Pr as createMonoChainFromSolanaInstructions,Ge as createPayloadWriterCloseInstruction,Le as createPayloadWriterCreateInstruction,Ae as createSplTransferInstruction,ei as createSwapFromSolanaInstructions,Cc as createSwapFromSuiMoveCalls,yr as createSwiftFromSolanaInstructions,Jt as createSwiftOrderHash,ht as createSwiftRandomKey,tt as createSyncNativeInstruction,ve as createTransferAllAndCloseInstruction,Se as decentralizeClientSwapInstructions,Jn as decideRelayer,Ct as deserializeInstructionInfo,Mp as estimateQuoteRequiredGas,_p as estimateQuoteRequiredGasAprox,kp as estimateQuoteRequiredGasAprox2,un as fetchAllCoins,Ui as fetchAllTokenList,Ue as fetchMayanSuiPackageId,Li as fetchQuote,Ki as fetchTokenList,fa as generateFetchQuoteUrl,Ce as getAddressLookupTableAccounts,w as getAmountOfFractionalAmount,X as getAnchorInstructionData,B as getAssociatedTokenAddress,Gi as getCurrentChainTime,Tn as getDisplayAmount,Rn as getEstimateGasEvm,Lt as getEvmChainIdByName,Or as getEvmSwiftParams,Br as getFastMctpFromEvmTxPayload,L as getGasDecimal,In as getGasDecimalsInSolana,Wr as getHyperCoreDepositFromEvmTxPayload,It as getHyperCoreUSDCDepositCustomPayload,vi as getHyperCoreUSDCDepositPermitParams,zn as getJitoTipTransfer,Pe as getLookupTableAddress,xn as getMctpFromEvmTxPayload,Lr as getMonoChainFromEvmTxPayload,Fe as getNormalizeFactor,da as getPermitDomain,ya as getPermitParams,Ke as getQuoteSuitableReferrerAddress,v as getSafeU64Blob,Oe as getSdkVersion,Mn as getSuggestedRelayer,En as getSvmDurableNonce,De as getSwapEvm,xt as getSwapFromEvmTxPayload,he as getSwapSolana,$e as getSwapSui,Dr as getSwiftFromEvmGasLessParams,Fr as getSwiftFromEvmTxPayload,ri as getSwiftOrderTypeData,qe as getSwiftToTokenHexString,ie as getWormholeChainIdById,P as getWormholeChainIdByName,K as hexToUint8Array,pa as isValidAptosType,h as nativeAddressToHexString,Me as resolveInputCoin,A as sandwichInstructionInCpiProxy,jt as sendJitoBundle,be as solMint,_n as submitSwiftEvmSwap,kn as submitSwiftSolanaSwap,_t as submitTransactionWithRetry,Pp as swapFromEvm,iu as swapFromSolana,Ps as unwrapSol,ue as validateJupSwap,er as validateJupSwapInstructionData,bt as wait,Ss as wrapSol};
